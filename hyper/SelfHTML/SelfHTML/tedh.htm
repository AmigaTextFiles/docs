<html>
<head>
<title>SELFHTML: JavaScript / Anwendungsbeispiele / Aufenthaltsdauer auf Web-Seite anzeigen</title>
<meta name="description" content="(SELFHTML 7.0) JavaScript, das in einem kleinen Feld Minuten und Sekunden anzeigt, die seit dem Aufruf der Seite verstrichen sind.">
<meta name="keywords" content="SELFHTML, JavaScript, Aufenthaltsdauer">
<link rel=stylesheet type="text/css" href="wselfhtm.css">
</head>
<body bgcolor=#ffffff text=#000000 link=#aa5522 vlink=#772200 alink=#000000>

<p><nobr><a class="an" name="top"><img src="x2.gif" width=16 height=13 border=0></a> <a href="selfhtml.htm"><b>SELFHTML</b></a>/<a href="tq.htm" target="_parent">Quickbar</a>&#160;
<img src="x2.gif" width=16 height=13 border=0> <a href="te.htm"><b>JavaScript</b></a>&#160;
<img src="x2.gif" width=16 height=13 border=0> <a href="ted.htm"><b>Anwendungsbeispiele</b></a></nobr></p>
<hr noshade size=1>
<table cellpadding=4 cellspacing=1 width=100%>
<tr>
<td bgcolor=#EEEEEE class="doc" width=110><img src="xweb.gif" width=106 height=109></td>
<td bgcolor=#EEEEEE class="doc" valign=bottom width=100%><h2>Aufenthaltsdauer auf Web-Seite anzeigen</h2></td>
</tr>
<tr>
<td bgcolor=#EEEEEE class="doc" valign=top align=center>
<img src="x5.gif" width=30 height=20 vspace=6 border=0 alt="Diese Seite ist ein Dokument mit Informationstext">
</td>
<td bgcolor=#ffffff valign=top nowrap>

<p>
<img src="xgdown.gif" width=14 height=10 border=0>&nbsp;<a href="#a1"><b>Aufenthaltsdauer auf Web-Seite anzeigen - das Beispiel</b></a>
</p>

</td>
</tr><tr><td colspan=2 bgcolor=#EEEEEE class="doc"><a href="#bottom"><img src="xgdown.gif" width=14 height=10 border=0></a>&#160;</td></tr>
</table>



<h2 class="Sh2"><a class="an" name="a1"><img src="xnetsi2.gif" width=30 height=30 border=0 alt="Netscape2.0"><img src="xmsie3.gif" width=30 height=30 border=0 alt="MS IE 3.0"> Aufenthaltsdauer auf Web-Seite anzeigen - das Beispiel</a></h2>

<p><img src="xview.gif" width=30 height=20 border=0 alt="Beispiel" align=absmiddle> <a href="tedha.htm"><b>Anzeigebeispiel: So sieht's aus</b></a></p>

<p>Das Beispiel auf dieser Seite zeigt in einem kleinen Feld laufend an, wie viele Minuten und Sekunden seit dem Aufruf der Seite verstrichen sind. Gedacht ist die Anzeige des Feldes vor allem f&uuml;r HTML-Dateien, die innerhalb eines Frame-Fensters st&auml;ndig angezeigt bleiben, etwa in einem Frame-Fenster mit einem Logo oder mit Verweisen. In solchen F&auml;llen l&auml;uft die Uhr w&auml;hrend der gesamten Besuchszeit, die der Anwender auf den Seiten verbringt. Man mag das als eine &uuml;berfl&uuml;ssige Spielerei abtun, aber angenommen, es wird etwas angezeigt, wobei der Anwender schnell die teure Online-Zeit vergi&szlig;t, etwa ein Spiel oder ein Chat-Fenster. Dann kann eine solche kleine &quot;Erinnerung&quot; in Form einer laufenden Zeituhr durchaus n&uuml;tzlich sein.</p>

<p><b>Hinweis:</b> Zur besseren Orientierung enth&auml;lt das Beispiel Verweise zu den entsprechenden Erl&auml;uterungen, z.B. <a href="#a1a1"><b>1*</b></a>. Diese Verweise geh&ouml;ren nicht zum Quellcode. Falls Sie das Beispiel in einen Editor kopieren, m&uuml;ssen Sie diese Verweise l&ouml;schen. Andernfalls erhalten Sie JavaScript-Fehlermeldungen.</p>

<h3 class="xmp">Beispiel:</h3>
<table width=100% cellpadding=10><tr><td class="xmpcode" bgcolor=#FFFFE0><pre>
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Seitentitel&lt;/title&gt;
 &lt;script language=&quot;JavaScript&quot;&gt;
  &lt;!--
   <a name="a1a1" href="#a1b1"><b>1*</b></a> Jetzt = new Date();
   var Start = Jetzt.getTime();

   <a name="a1a3" href="#a1b3"><b>3*</b></a> function ZeitAnzeigen() 
   { 
    var absSekunden = Math.round(ZeitBerechnen()); 
    var relSekunden = absSekunden % 60;
    var absMinuten = Math.round((absSekunden-30)/60);
    var anzSekunden =&quot;&quot; + ((relSekunden &gt; 9) ? relSekunden : &quot;0&quot; + relSekunden);
    var anzMinuten =&quot;&quot; + ((absMinuten &gt; 9) ? absMinuten : &quot;0&quot; + absMinuten);
    window.document.Anzeige.Zeit.value = anzMinuten + &quot;:&quot; + anzSekunden;
    window.setTimeout('ZeitAnzeigen()',1000); 

   function ZeitBerechnen()
   { 
    var Immernoch = new Date(); 
    return((Immernoch.getTime() - Start)/1000); 
   }

  //--&gt;
 &lt;/script&gt;
 &lt;/head&gt;
 <a name="a1a3" href="#a1b2"><b>2*</b></a> &lt;body onLoad=&quot;window.setTimeout('ZeitAnzeigen()',1000)&quot;&gt;
&lt;form name=&quot;Anzeige&quot;&gt;
&lt;input size=7 name=&quot;Zeit&quot;&gt;
&lt;/form&gt;
 &lt;/body&gt;
 &lt;/html&gt;
</pre></td></tr></table>


<h3 class="xpl">Erl&auml;uterung:</h3>

<p><img src="xgoup.gif" width=14 height=10 border=0>&nbsp;<a name="a1b1" href="#a1a1"><b>Startzeit ermitteln</b></a><br>
Beim Einlesen der Datei wird zun&auml;chst der aktuelle Zeitpunkt ermittelt. Dieser Zeitpunkt dient als Startzeit der Anzeige. Mit <tt>Jetzt = new Date()</tt> wird ein neues Datumsobjket mit em aktuellen Zeitpunkt in der Variablen <tt>Jetzt</tt> gepsichert. Mit <tt>Jetzt.getTime</tt> wird eine absolute Zahl in Millisekunden ermittelt, die in der Variablen <tt>Start</tt> gespeichert wird.</p>


<p><img src="xgoup.gif" width=14 height=10 border=0>&nbsp;<a name="a1b2" href="#a1a2"><b>Funktion zur Zeitanzeige erstmals aufrufen</b></a><br>
Im einleitenden <tt>&lt;body&gt;</tt>-Tag steht im Beispiel der erste Aufruf der Funktion <tt>ZeitAnzeigen()</tt>, die die Zeit anzeigt und die Anzeige jede Sekunde aktualisiert. Der erste Aufruf erfolgt nach einer Sekunde. Dazu wird der Funktionsaufruf in die <tt>setTimeout()</tt>-Methode mit einer Verz&ouml;gerungszeit von 1000 Millisekunden (1 Sekunde) eingebettet.<br>
Im Dateik&ouml;rper steht dann ein Formular, das nur aus einem einzigen kleinen Eingabefeld besteht. Dieses Eingabefeld wird als Ausgabefeld f&uuml;r die Zeitanzeige zweckentfremdet.</p>


<p><img src="xgoup.gif" width=14 height=10 border=0>&nbsp;<a name="a1b3" href="#a1a3"><b>Zeit anzeigen und Anzeige laufend aktualisieren</b></a><br>
Die Funktion <tt>ZeitAnzeigen()</tt>, die f&uuml;r die laufende Zeitanzeige verantwortlich ist, ruft zun&auml;chst die Unterfunktion <tt>ZeitBerechnen()</tt> auf. Diese Funktion erzeugt bei jedem Aufruf ein neues Datumsobjekt mit dem aktuellen Zeitpunkt. Das Ergebnis wird in der Variablen <tt>Immernoch</tt> gespeichert. Zur&uuml;ckgegeben wird jedoch nicht der aktuelle Zeitpunkt, sondern die Differenz zwischen dem aktuellen Zeitpunkt und dem Startzeitpunkt, der beim Einlesen der Datei ermittelt wurde. Der R&uuml;ckgabewert erfolgt in Sekunden. Da beim Datumsobjekt intern in Millisekunden gerechnet wird, wird der Wert durch 1000 geteilt, um Sekunden zu erhalten. Dabei k&ouml;nnen jedoch Bruchzahlen zustande kommen. Um eine glatte Sekundenzahl zu erhalten, wendet die aufrufende Funktion <tt>ZeitAnzeigen()</tt> die Methode <tt>Math.round()</tt> an.</p>

<p>Die absolute Anzahl der vergangenen Sekunden steht dann in der Variablen <tt>abSekunden</tt>. Von dem darin gespeicherten Wert werden alle folgenden Werte abgeleitet. Mit <tt>Math.round((absSekunden-30)/60)</tt> wird ermittelt, wie viele Minutzen die Sekundenzahl bereits imliziert. Wenn die Sekundenzahl beispielsweise 200 lautet, sind darin 3 Minuten (180 Sekunden) enthalten. Dieser Wert wird in der Variablen <tt>absMinuten</tt> gespeichert. Der Restwert an Sekunden, also bei 200 und 180 etwa der Wert 20, wird mit der Modulo-Division <tt>absSekunden % 60</tt> in der Variablen <tt>relSekunden</tt> gespeichert. Im Beispiel 200 steht dann also in <tt>absMinuten</tt> der Wert 3 und in <tt>relSekunden</tt> der Wert 20.</p>

<p>Um die Anzeige der Minuten und Sekunden f&uuml;r die Ausgabe ordentlich zu formatieren, werden Zeichenketten erzeugt, die in den Variablen <tt>anzSekunden</tt> und <tt>anzMinuten</tt> gespeichert werden. Wenn eine Minuten- oder Sekundenzahl einstellig ist, bekommt sie eine 0 vorangestellt.</p>

<p> Mit der Zuweisung an <tt>window.document.Anzeige.Zeit.value</tt> wird die ermittelte und formatierte Zeit anschlie&szlig;end in das Formularfeld geschrieben, das zur Zeitanzeige dient. Damit die Zeitanzeige weiterl&auml;uft, ruft sich die Funktion <tt>ZeitAnzeigen()</tt> am Ende mit einer Verz&ouml;gerungszeit von 1000 Millisekunden selbst wieder auf. Dadurch wird der gesamte Vorgang wiederholt.</p>

<table cellpadding=4 cellspacing=1 width=100%>
<tr><td colspan=2 bgcolor=#EEEEEE class="doc">
<a href="#top"><img src="xgoup.gif" width=14 height=10 border=0></a>
</td></tr>
<tr><td bgcolor=#EEEEEE class="doc" align=right width=110>weiter:<a href="tedi.htm"><img src="xgnext.gif" width=10 height=10 border=0 hspace=10></a></td>
<td bgcolor=#ffffff><img src="x3.gif" width=15 height=10 border=0> <a href="tedi.htm"><b>Verweisliste als Auswahlliste</b></a>
</td></tr>
<tr>
<td bgcolor=#EEEEEE class="doc" align=right width=110>zur&uuml;ck:<a href="tedg.htm"><img src="xgprev.gif" width=10 height=10 border=0 hspace=10></a></td>
<td bgcolor=#ffffff width=100%><img src="x3.gif" width=15 height=10 border=0> <a href="tedg.htm"><b>Dynamische grafische Buttons</b></a>
</td>
</tr>
<tr><td colspan=2 bgcolor=#EEEEEE class="doc">&#160;</td></tr>
</table>
<hr noshade size=1>
<p><nobr><img src="x2.gif" width=16 height=13 border=0> <a href="selfhtml.htm"><b>SELFHTML</b></a>/<a href="tq.htm" target="_parent">Quickbar</a>&#160;
<img src="x2.gif" width=16 height=13 border=0> <a href="te.htm"><b>JavaScript</b></a>&#160;
<img src="x2.gif" width=16 height=13 border=0> <a href="ted.htm"><b>Anwendungsbeispiele</b></a></nobr></p>
<p><nobr><a class="an" name="bottom">&copy; 1998</A> <img src="xgmail.gif" width=15 height=10 border=0>&nbsp;<a href="mailto:muenz@csi.com">Stefan M&uuml;nz, muenz@csi.com</a></nobr></p>


</body>
</html>