; $VER: Install_France_Guide 2.1ßeta4 (25.11.97) écrit par Gérard Cornu pour "Saint Jérôme le Gueux",
;                                             alias "l'Homme qui a vu l'Ours" ;-)
;
; Thanks to "io" and "Thomas Floyd" for the bug reports ;)
; Merci à "io" et "Thomas Floyd" pour le rapport de bug ;)  
;
;
;-- Language specific string definitions --------------------------------------

; hd space needed for France Guide, in Kilo bytes
(set space_needed 5800) 
                                                                               
; ENGLISH (or close enough ;-) (by Gérard Cornu) ------------------------- 
(procedure P_english (
   
   (set README_FILE "ReadMe")

   (set MSG_NO_SPACE (cat "There isn't enough disk space on %s, %s needs %ld KB and there is only"
                          " %ld KB free. You will have to free up over %ld KB on %s.\n\n"))

   (set MSG_NO_SPACE_0 (cat " If you just want to install %s in RAM: and you have more than %ld"
                            " free RAM, you'll have to delete the corresponding lines in the"
                            " install script.\n(The RAM: disk is always full ;-)"))
   
   (set MSG_BAD_KICK "%s needs at least System 2.0\n(3.x preferable !)")

   (set MSG_NOT_3.0  (cat  "\n\nI just found out that you are not using system 3.x."
                           " %s can be used on your system, with AmigaGuide©, but you won't be able to"
                           " display the maps directly from %s.\n\n"
                           "Click on \"Help...\" to get some infos about a work around."))
                           
   (set MSG_HELP_NOT_3.0 (cat "You just have to replace, in the France.Guide file the\n\n"
                           "  LINK Cartes/....iff/MAIN}\n\n"
                           "parts, by\n\n"
                           "  SYSTEM \"PPShow Cartes:....iff\"}\n\n"
                           "Then you'll have to assign Cartes: to the directory where you"
                           " installed France Guide with Cartes appended to it, ie:\n\n"
                           "assign Cartes:  My_HD:My_directory/France/Cartes\n\n"
                           "Of course, you may replace PPShow by your prefered"
                           " picture viewer. Please note that the quotes below are important.\n\n"
                           "Two find and replace in your text editor will accomplish this:\n\n"               
                           "Find:\n\n"
                           "LINK Cartes/\n\n"
                           "Replace by:\n\n"
                           "SYSTEM \"PPShow Cartes:\n\n"
                           "Then find:\n\n"
                           ".iff/MAIN}\n\n"
                           " and replace by:\n\n"
                           ".iff\"}\n\n"
                           "Yet again, the quotes are note here for decorative purpose ;-)\n\n"
                           "The directory containing the picture viewer, PPShow in our"
                           " example, must be in your command path."))

   (set MSG_DESTINATION (cat  "Where would you like to install %s?\n"
                           "A drawer named \"France\" will be created there and"
                           " all files needed by %s will be copied into this \"France\" drawer."))

   (set MSG_DEARCHIVING "\n\nDe-archiving %s\nto your\n%s\ndirectory\n\n\nBe patient...")

   (set MSG_PROB_LHX "Problem unarchiving \"France.lha\", abrting.")

   (set MSG_FONT        (cat  "\n\n\n%s is supplied with an Helvetica font in 9 points size,"
                           " optimized by myself. Would you like to copy it to your"
                           " \"Fonts:\" directory?"))

   (set MSG_HELP_FONT      (cat  "For optimum comfort, your screen should be set at least"
                           " to 640 x 512, 8 colo(u)rs.\n\n"
                           "The supplied font (Helvetica 9) is perfect for a 17\""
                           " or bigger screen.\n\n"
                           "Once you have installed it, remove the '@remark ' in front of"
                           " '@Font helvetica.font 9', at the beginning of France.Guide"))

   (set MSG_COPY_FONT      "Copy font")
   

   (set MSG_FIXFONTS "\n\n\"Sys:System/FixFonts\" is currently updating your \"Fonts:\" directory.")

   (set MSG_PATH        (cat  "\n\nFor %s to work properly, the path where you just installed %s"
                           " must be included in the \"AmigaGuide/Path\" system environment"
                           " variable.\n\n"
                           " Would you like me to modify (or create, if necessary) this"
                           " environment variable?"))

   (set MSG_HELP_PATH      (cat  "If you choose to \"skip this part\", you'll have to do it"
                           " manually. For more infos about this environment variable, click"
                           " on the \"Help\" gadget while you are using AmigaGuide (or MultiView)."))

   (set MSG_APPENDING_PATH (cat  "Updating your \"ENV:AmigaGuide/Path\" environment variable"
                           " and copying it to \"ENVARC:AmigaGuide/Path\"."))

   (set MSG_SKIP           "Skip this part")

   (set MSG_YES            "Yes")

   (set MSG_CLEANUP "\n\nDo you want me to cleanup after myself?\n\n ;-)")
   
   (set MSG_HELP_CLEANUP (cat "I will delete the files that were only needed for the installation."
                              "\n\nBut after the installation is done, you'll have to delete the main"
                              " (empty) directory, as I am currently inside it ;-)"))
                              
   (set MSG_DOING_CLEANUP (cat "Cleaning up...\n\n"
                               "But after the installation is done, you'll have to delete the main"
                               " (empty) directory\n\n;-)"))

   (set MSG_THANKS "\n\nThank you for having installed %s!")

))

; Français (ou presque ;-) (par Gérard Cornu) ------------------------------

(procedure P_français (
   
   (set README_FILE "Lise_&_Moi")

   (set MSG_NO_SPACE (cat "Il n'y a pas assez d'espace disque libre sur %s, %s a besoin"
                          " de %ld Ko et il n'y a que %ld Ko de libre. Vous devez libérer"
                          " plus de %ld Ko sur %s.\n\n"))

   (set MSG_NO_SPACE_0 (cat "Si vous voulez installer %s en RAM:, et que vous avez plus de"
                           " %ld Ko de RAM libre, vous devrez effacer les lignes concernées"
                           " dans le script d'installation.\n(Le disque RAM: est toujours plein ;-)"))

   (set MSG_BAD_KICK "%s nécessite au minimum le système 2.0\n(3.x de préférence !)") 

   (set MSG_NOT_3.0        (cat  "\n\nIl semblerait que votre machine n'utilise pas le"
                              " système 3.x. %s peut fonctionner sur"
                              " votre système, avec AmigaGuide©, mais vous ne pourrez pas afficher les"
                              " cartes directement depuis %s.\n\n"
                              " Cliquez sur \"Aide...\" pour les modifications"
                              " à apporter de façon à voir les cartes comme sous"
                              " le système 3.x, (ou presque ;-)")) 

   (set MSG_HELP_NOT_3.0   (cat  "Il suffit simplement de remplacer, dans le fichier"
                              " France.guide, les\n\n"
                              "    LINK Cartes/....iff/MAIN}\n\n"
                              "par des\n\n"
                              "    SYSTEM \"PPShow Cartes:....iff\"}\n\n"
                              "Ensuite il vous faudra assigner Cartes: au répertoire où"
                              " vous aurez installé France Guide, terminé par Cartes, par exemple:\n\n"
                              "assign Cartes:  Disque:Répertoire/France/Cartes\n\n"
                              "Vous pouvez évidemment remplacer PPShow par votre"
                              " afficheur d'images préféré. Notez que les guillemets ci-dessous"
                              " ont leur importance.\n\n"
                              "Deux chercher/remplacer dans votre éditeur de texte y parviendront:\n\n"
                              "Chercher:\n\n"
                              "LINK Cartes/\n\n"
                              "Remplacer par:\n\n"
                              "SYSTEM \"PPShow Cartes:\n\n"
                              "Puis, chercher:\n\n"
                              ".iff/MAIN}\n\n"
                              "et remplacer par:\n\n"
                              ".iff\"}\n\n"
                              "Encore une fois les guillemets ne sont pas là uniquement pour"
                              " décorer ;-).\n\n"
                              "Le répertoire qui contient l'afficheur d'images,\n"
                              "PPShow dans notre exemple, doit bien sûr être\n"
                              "dans votre chemin de commandes (\"Path\")."))

   (set MSG_DESTINATION    (cat  "Où désirez-vous installer l'ensemble %s?\n"
                              "Un répertoire \"France\" y sera créé, et l'ensemble"
                              " des fichiers nécessaires à %s sera copié dans ce répertoire"
                              " \"France\".")) 

   (set MSG_DEARCHIVING "\n\nExtraction de %s\nvers votre répertoire\n%s\n\n\nSoyez patient(e)...")

   (set MSG_PROB_LHX "Problème en tentant de désarchiver \"France.lha\", abandon.")

   (set MSG_FONT           (cat  "\n\n\n%s est fournie avec une font, Helvetica en 9 points,"
                              " optimisée par mes soins. Voulez-vous la copier dans"
                              " votre répertoire \"Fonts:\"?"))

   (set MSG_HELP_FONT      (cat  "Pour un confort optimal, votre écran doit être au"
                              " minimum en 640 x 512, 8 couleurs.\n\n"
                              "La police de caractère fournie (Helvetica 9) est parfaite"
                              " pour un écran 17 pouces ou supérieur.\n\n"
                              "Une fois la fonte installée, enlevez le '@remark ',"
                              " devant '@Font helvetica.font 9', au début de France.Guide"))

   (set MSG_COPY_FONT         "Copier la font")

   (set MSG_FIXFONTS "\n\n\"Sys:System/FixFonts\" est en train de mettre à jour votre répertoire \"Fonts:\"")

   (set MSG_PATH           (cat  "\n\nAfin que %s fonctionne correctement"
                              " il est nécessaire que le chemin où vous venez d'installer %s soit"
                              " inclus dans la variable d'environnement système \"AmigaGuide/path\".\n\n"
                              "Voulez-vous que je modifie (ou crée, si nécessaire)"
                              " cette variable d'environnement?"))

   (set MSG_HELP_PATH      (cat  "Si vous choisissez de \"Passer cette partie\", il vous faudra le"
                              " faire manuellement. Pour plus d'infos sur cette variable"
                              " d'environnement, cliquez sur le bouton \"Aide\""
                              " lorsque vous êtes dans AmigaGuide (ou Multiview)."))

   (set MSG_APPENDING_PATH (cat  "Mise à jour de votre variable d'environnement"
                              " \"ENV:AmigaGuide/Path\" et copie dans \"ENVARC:AmigaGuide/Path\"."))

   (set MSG_SKIP              "Passer cette partie")

   (set MSG_YES               "Oui")

   (set MSG_CLEANUP "\n\nVoulez-vous que je fasse le ménage?\n\n ;-)")
   
   (set MSG_HELP_CLEANUP (cat "Je vais effacer les fichiers qui n'étaient utiles que pour l'installation."
                              "\n\nMais une fois l'installation terminée il vous restera à effacer le répertoire"
                              " principal (vide), puisque j'y suis en ce moment ;-)"))
                              
   (set MSG_DOING_CLEANUP (cat "Je fais l'ménage...\n\nUne fois l'installation terminée ils vous"
                               " restera à effacer le répertoire principal (vide)\n\n;-)"))
   
   (set MSG_THANKS "\n\n\nMerci d'avoir installé %s!")
))

; DEUTSCH (translation by Andreas Regul) -----------------------------
(procedure P_deutsch (

   (set README_FILE "Lies_Mich")

   (set MSG_NO_SPACE (cat "Nicht genug freier Speicherplatz auf %s, %s benötigt %ld KB, es sind jedoch nur"
                          " %ld KB frei. Sie müssen weitere %ld KB freimachen auf %s.\n\n"))

   (set MSG_NO_SPACE_0 (cat " Wenn %s nur auf der RAM-Disk installiert werden soll und Sie mindestens %ld"
                            " freie RAM-Kapazität besitzen, müssen die entsprechenden Zeilen im Installations-"
                            " Skript entfernt werden.\n(Die RAM-Disk ist ja immer voll ;-)"))

   (set MSG_BAD_KICK "%s benötigt mindestens System 2.0\n(3.x bevorzugt !)")

   (set MSG_NOT_3.0  (cat  "\n\nSie verwenden nicht system 3.x."
                           " %s kann auf Ihrem System mit AmigaGuide© verwendet werden, es ist jedoch nicht"
                           " möglich, Karten direkt aus %s heraus zu starten.\n\n"
                           "Wählen Sie \"Help...\", um weitere Infos hierzu zu erhalten."))

   (set MSG_HELP_NOT_3.0 (cat "Sie müssen in der Datei France.Guide alle Zeilen mit\n\n"
                           "  LINK Cartes/....iff/MAIN}\n\n"
                           "durch\n\n"
                           "  SYSTEM \"PPShow Cartes:....iff\"}\n\n"
                           "ersetzen. Danach muß ein Assign Cartes: auf das Verzeichnis eingerichtet"
                           " werden, wo sich France.guide mit den zugehörigen Karten befindet. Beispiel:\n\n"
                           "assign Cartes:  My_HD:My_directory/France/Cartes\n\n"
                           "Natürlich können Sie PPShow durch Ihren bevorzugten Bildanzeiger ersetzen."
                           " Bitte beachten Sie, daß die Anführungszeichen wichtig sind.\n\n"
                           "Mit zwei Suchen/Ersetzen-Befehle im Editor wird die Veränderung wie folgt durchgeführt:\n\n"
                           "Suchen:\n\n"
                           "LINK Cartes/\n\n"
                           "Ersetzen durch:\n\n"
                           "SYSTEM \"PPShow Cartes:\n\n"
                           "Danach suchen:\n\n"
                           ".iff/MAIN}\n\n"
                           " und ersetzen durch:\n\n"
                           ".iff\"}\n\n"
                           "Wichtig: Die Anführungsstriche sind nicht zu Dekorationszwecken vorhanden ;-)\n\n"
                           "Das Verzeichnis des Bildanzeigers, PPShow in diesem Beispiel,"
                           " muß im Befehlspfad Ihres Amiga enthalten sein."))

   (set MSG_DESTINATION (cat  "Wo soll %s installiert werden ?\n"
                           "Ein Verzeichnis \"France\" wird dort erzeugt und alle von"
                           " %s benötigten Dateien dorthin kopiert."))

   (set MSG_DEARCHIVING "\n\nEntpacke %s\nin das Verzeichnis\n%s\n\n\nBitte etwas Geduld...")

   (set MSG_PROB_LHX "Problem beim Entpacken von \"France.lha\", Abbruch.")

   (set MSG_FONT        (cat  "\n\n\n%s enthält einen Helvetica-Zeichensatz in 9 Punkt Größe,"
                           " verbessert von mir selber. Soll er in das Verzeichnis"
                           " \"Fonts:\" kopiert werden ?"))

   (set MSG_HELP_FONT      (cat  "Zur optimalen Wiedergabe sollte der Bildschirm auf mindestens"
                           " 640 x 512 Pixel und 8 Farben eingestellt sein.\n\n"
                           "Der beiliegende Zeichensatz (Helvetica 9) ist günstig für 17\""
                           " Bildschirme oder größere.\n\n"
                           "Wenn er installiert wurde, muß '@remark ' vor"
                           " '@Font helvetica.font 9' in der Datei France.Guide entfernt werden."))

   (set MSG_COPY_FONT      "Kopiere Zeichensatz")


   (set MSG_FIXFONTS "\n\n\"Sys:System/FixFonts\" aktualisiert Ihr \"Fonts:\"-Verzeichnis.")

   (set MSG_PATH        (cat  "\n\nDamit %s einwandfrei läuft, muß der Pfad, in dem %s"
                           " gerade installiert wurde, in der Umgebungsvariable \"AmigaGuide/Path\""
                           " ergänzt werden.\n\n"
                           " Soll diese Änderung automatisch durchgeführt werden ? (Die Umgebungsvariable"
                           " wird erzeugt, falls sie noch nicht vorhanden sein sollte)"))

   (set MSG_HELP_PATH      (cat  "Wenn Sie \"skip this part\" gewählt haben, müssen Sie die Ergänzung"
                           " selber durchführen. Nähere Informationen zu dieser Umgebungsvariable finden"
                           " Sie unter \"Help\", wenn Sie AmigaGuide (oder MultiView) verwenden."))

   (set MSG_APPENDING_PATH (cat  "Ergänze die \"ENV:AmigaGuide/Path\" Umgebungsvariable"
                           " und kopiere sie nach \"ENVARC:AmigaGuide/Path\"."))

   (set MSG_SKIP           "Überspringen")

   (set MSG_YES            "Ja")

   (set MSG_CLEANUP "\n\nSoll nach der Installation aufgeräumt werden ?\n\n ;-)")

   (set MSG_HELP_CLEANUP (cat "Alle Dateien, die nur während der Installation benötigt wurden, werden gelöscht."
                              "\n\nAllerdings müssen Sie das Verzeichnis selber löschen, da sich das"
                              " Installationsskript im selben befindet ;-)"))

   (set MSG_DOING_CLEANUP (cat "Räume auf...\n\n"
                               "Löschen Sie nach der Installation das leere"
                               " Verzeichnis\n\n;-)"))

   (set MSG_THANKS "\n\nVielen Dank für die Installation von %s!")

))

;------------------------------------------------------------------------------


; extracting archive command line
(set lhx_cmd "lhx -a -k e ")

; what are we speaking around here, not much ;^)
(if (= @language "english")  (P_english))
(if (= @language "français") (P_français))
(if (= @language "deutsch")  (P_deutsch))

; Choose default tool for guide, depending on user's OS version
(set osversion  (/ (getversion) 65536))
(if (>= osversion 39)
   (set guide_reader "MultiView") 
   (set guide_reader "AmigaGuide")
)
(set installed "")

(welcome)

(if (< osversion 37)
   (abort (MSG_BAD_KICK @app-name))
)

(if (< osversion 39)
   (message (MSG_NOT_3.0 @app-name @app-name) (help MSG_HELP_NOT_3.0))
)   

(set dest_dir
   (askdir (prompt (MSG_DESTINATION @app-name @app-name))
           (help @askdir-help)
           (default "Help:")
           (newpath)
   )
)

; France Guide now needs a bit of room, so shall we have a look...
(set free_space (/ (getdiskspace dest_dir) 1024))
(set to_be_freed (- space_needed free_space))

(if (< free_space space_needed)
   (if (= free_space 0) ; special message if free_space = 0: maybe want to install in RAM
      (abort ((cat (MSG_NO_SPACE dest_dir @app-name space_needed free_space to_be_freed dest_dir) 
                   (MSG_NO_SPACE_0  @app-name space_needed)))
      ) ; else normal message
      (abort (MSG_NO_SPACE dest_dir @app-name space_needed free_space to_be_freed dest_dir))
   )
)   

; the following is needed for the lhx command, Installer
; don't put a '/' if it's a dir (?!)
   (set @default-dest dest_dir)
   (set install_dir dest_dir)
   (if (<> ":" (substr @default-dest (- (strlen @default-dest) 1) 1))
      (set dest_dir (cat dest_dir "/"))
   )   

(working (MSG_DEARCHIVING @app-name dest_dir))
(if (<> (run (cat "/" lhx_cmd " /France " dest_dir)) 0)
   (abort MSG_PROB_LHX)
)   

(set @default-dest (tackon dest_dir "France"))

(copyfiles (source (cat "/" README_FILE))
           (dest @default-dest)
           (infos)
           (files)
           (nogauge)
)           

(set installed "YES")

(set font
   (askbool (prompt (MSG_FONT @app-name))
            (help MSG_HELP_FONT)
            (choices MSG_COPY_FONT MSG_SKIP)
   )
)   

(if (= font 1)
   (
      (copyfiles (source "/fonts")
                 (dest "Fonts:")
                 (all)
      )
      (if (exists "Sys:System/FixFonts" (noreq))
         (  
            (working MSG_FIXFONTS)
            (run "Sys:System/FixFonts")
         )
      )            
   )
)                 

(set dopath
   (askbool (prompt (MSG_PATH @app-name @app-name))
            (help MSG_HELP_PATH)
            (choices MSG_YES MSG_SKIP)
   )
)               

(if (= 1 dopath)
   (
      (working MSG_APPENDING_PATH)

      (if (exists "ENV:AmigaGuide/Path" (noreq)) 
         (textfile (dest "ENV:AmigaGuide/Path")
                   (append (getenv "AmigaGuide/Path"))
                   (append (cat " \"" @default-dest "\""))
         )
         
         (if (= 0 (exists "ENV:AmigaGuide" (noreq)))
            (
               (makedir "ENV:AmigaGuide")
               (textfile (dest "ENV:AmigaGuide/Path")
                     (append (cat "\"" @default-dest "\"")))
            )
         )
            
      )
      (copyfiles (source "ENV:AmigaGuide/Path")
                 (dest "ENVARC:AmigaGuide")
                 (files)
                 (nogauge)
      )
   )
)         

(if (exists (cat @default-dest ".info") (noreq))
   (
      (tooltype   (dest @default-dest) (noposition))
      (set installed "YES")         
   )
)

(if (exists (tackon @default-dest "France.guide.info") (noreq))
   (
      (tooltype   (dest (tackon @default-dest "France.guide"))
                  (setdefaulttool guide_reader))
      (set installed "YES")         
   )
)

(if (exists (tackon @default-dest (cat README_FILE ".info")) (noreq))
   (
      (tooltype   (dest (tackon @default-dest README_FILE))
                  (noposition) (setdefaulttool guide_reader))
      (set installed "YES")         
   )
)

(set cleanup
   (askbool (prompt (MSG_CLEANUP))
            (help MSG_HELP_CLEANUP)
            (choices MSG_YES MSG_SKIP)
   )
)               

(if (= cleanup 1)
   (
      (working MSG_DOING_CLEANUP)
      (run "run >NIL: delete >NIL: //France_Guide#? ALL FORCE QUIET")
   )   
)

(if (= installed "YES") 
   (exit (MSG_THANKS @app-name))
   (exit)
)   
