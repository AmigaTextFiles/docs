@database MountGuide
@Author "Peter Hutchison"
@$VER: MountGuide 1.0 (11/5/00)
@node main

                @{u}Руководство по Mountlist для Amiga@{uu}
                        @{u}Peter Hutchison@{uu}
                  @{u}Перевод Владимира Яворского@{uu}
                           @{u}7/5/2000@{uu}


             @{" 1 " link What} Что такое Mountlist?

             @{" 2 " link Look} Как выглядит Mountlist?

             @{" 3 " link Describe} Описание Mountlist'ов Workbench

             @{" 4 " link Attrib} Атрибуты Mountlist

             @{" 5 " link Programs} Список полезных Программ

             @{" 6 " link Author} Об Авторе


@endnode
@node What 

@{b}@{u}1. Что такое Mountlist?@{uu}@{ub}

	Mountlist - это простой текстовый файл, описывающий конфигурацию и
        определение устройства, подключенного к Amiga. Он точно определяет,
        что это за устройство, какой файловой системой или хендлером
        управляется, его размер, и другую информацию для правильной работы.

 	Каждое устройство имеет имя, по которому оно доступно для программ
        AmigaOS, а также двоеточее в конце имени. 
        Например: DF0: - Disk Floppy 0 (внутренний дисковвод),
        	  RAM: - Ram Drive,
		  SPEAK: - речевое устройство.

	Команда MOUNT (AmigaDOS) использует mountlist'ы для монтирования 
        устройств на этапе запуска или во время работы Amiga.

Пр:  MOUNT AUX: from DEVS:Mountlist
     MOUNT DEVS:DosDrivers/Aux

Вы можете воспользоваться командой ASSIGN для просмотра устройств, а также
для их демонтажа, использую параметр DISMOUNT.

Пр:  ASSIGN AUX: DISMOUNT

@endnode
@node Look

@{b}@{u}Как выглядит Mountlist?@{uu}@{ub}

	Типичный Mountlist состоит из нескольких строк - коментария, как
        в Cи (/* ...... */), одной или более строк-дескрипторов и, обычно,
        заканчивается решёткой (#).

/* EXA: Пример Mountlist'а */

attribute1 = value1
attribute2 = value2
attribute3 = value3
attribute4 = value4
...
#

Смотрите @{"Список Атрибутов" link Attrib}.
Величины могут быть десятичными или шестнадцатиричными числами, строками, или
именем файла, и т.д.

@endnode
@node Describe

@{u}@{b}3. Описание Mountlist'ов Workbench@{ub}@{uu}

	Workbench поставляется с определенными mountlist'и. До Workbench 2.0
	они все были собраны в одном файле в Devs:, названном Mountlist,
        все записи следывали одна за другой и разделялись решёткой.

	Начиная с Workbench 2.1, Mountlist'ы были разделены на файлы и 
        помещены в новую директорию , названную Devs:DosDrivers. Это позволило
        добавлять и убирать устройства гораздо проще.


@{u}3.1 PIPE Mountlist@{uu}

/* $VER: PIPE 40.1 (31.8.93)              - Имя и версия
 *
 * Queue-Handler mount entry              - Описание
 */

Handler = L:Queue-Handler                 - Имя хендлера
StackSize = 3000                          - Требоваемый размер стека
Priority = 5                              - Приоритет Устройства (высокий)
GlobVec = -1                              - Вектор

@{u}3.2 CD0 CDRom Mountlist@{uu}

/* $VER: CD0 40.6 (31.8.93)               - Имя и версия
*
 * CD-ROM file system entry               - Описание
 *
 * Этот файл включает файловую систему CD-ROM, которая позволяет вам считывать
 * стандартные ISO-9660 CD-ROM диски с помощью Amiga с SCSI или IDE контроллером.
 *
 * Строка "Unit" определяет адрес SCSI CD-ROM. Дисковводы часто имеют
 * unit 2, который стоит по умолчанию. Проверте документацию к вашему
 * CD-ROM дисковводу для нахождения правильного адреса SCSI.
 * Помните, что многие из них позволяют изменять это число с помощью джамперов.
 */

FileSystem = L:CDFileSystem         - Имя Файловой Системы (ISO9660)
Flags      = 0                      - Флаги (нет)
Surfaces   = 1                      - Число поверхностей
SectorsPerTrack = 1                 - Число секторов на дорожке
SectorSize = 2048                   - Число байт в секторе (2K)
Mask       = 0x7ffffffe             - Маска типа памяти
MaxTransfer= 0x100000               - Размер блока данных для переноса
Reserved   = 0                      - Число зарезервированных дорожек
Interleave = 0                      - Число чередующихся дорожек
LowCyl     = 0                      - Нижний цилиндр или номер дорожки
HighCyl    = 0                      - Верхний цилиндр или номер дорожки
Buffers    = 5                      - Число буферов памяти для данных
BufMemType = 0                      - Тип памяти для буфера
StackSize  = 1000                   - Размер стека
Priority   = 10                     - Приоритет (очень высокий)
GlobVec    = -1                     - Вектор
DosType    = 0x43443031             - Имя идентификатора в ASCII (в нашем
				      случае это `CD01`).

/* Поля Драйвера и Unit'а определены в tooltypes в иконке CD0.
 * 
 * Device = scsi.device             - Имя драйвера
 * Unit   = 2                       - Unit контроллера
 */

@{u}3.3 Auxillary Device@{uu}

/* $VER: AUX 40.1 (31.8.93)         - Имя и версия
 *
 * Aux-Handler mount entry          - Описание
 */

Handler   = L:Aux-Handler           - Имя хендлера
StackSize = 1000                    - Стек
Priority  = 5                       - Приоритет (высокий)

@{u}3.4 PC Disk Device@{uu}

/* $VER: PC0 40.1 (31.8.93)         - Имя и версия
 *
 * CrossDOS file system entry       - Описание
 *
 * Этот файл включает CrossDOS во встроенном дисковводе обычно DF0:. PC1 
 * соответственно для DF1. Создавая копию из этого файла и изменяя строку
 * Unit, вы можете включать CrossDOS на других дисковводах. Например, изменяя
 * Unit на 2, вы создадите mountlist, который включит CrossDOS на DF2.
 */

FileSystem  = L:CrossDOSFileSystem  - Имя файловой системы (FAT)
Device      = mfm.device            - Имя драйвера
Flags       = 1                     - Флаг 1
Surfaces    = 2                     - Число поверхностей
SectorsPerTrack = 9                 - Число секторов
SectorSize  = 512                   - Размер сектора
Reserved    = 1                     - Число зарезервированных дорожек
Interleave  = 0                     - Число чередующихся дорожек
LowCyl      = 0                     - Нижняя дорожка
HighCyl     = 79                    - Верхняя дорожка
Buffers     = 5                     - Размер буфера
BufMemType  = 0                     - Тип памяти для буфера
StackSize   = 600                   - Размер стека
Priority    = 10                    - Приоритет
GlobVec     = -1                    - Глобальный вектор
DosType     = 0x4D534400            - Идентификатор (`MSD\0`)


/* Поле Unit определено в tooltypes в иконке PC0.
 *
 * Unit = 0                         - unit (DF0:)
 */

@{u}3.5 Recoverable RAM Device@{uu}

/* $VER: RAD 40.1 (31.8.93)               - Имя и версия
 *
 * Recoverable RAM disk mount entry       - Описание
 *
 * Вы можете создать альтернативные исправимые RAM диски.
 *
 * Размер такого RAM диска контролируется величиной строки HighCyl.
 * Увеличивая это значение на 1 расходует 11K памяти. Поэтому начальная
 * величина - 79 и соответствует 880K.
 */

Device          = ramdrive.device         - Имя драйвера (в ПЗУ)
Unit            = 0                       - unit
Flags           = 0                       - Флаги
Surfaces        = 2                       - Число поверхностей
SectorsPerTrack = 11                      - Число секторов
SectorSize      = 512                     - Размер сектора
Reserved        = 2                       - Число зарезервированных дорожек
Interleave      = 0                       - Число чередующихся дорожек
Buffers         = 5                       - Число буферов
BufMemType      = 1                       - Тип памяти для буфера (Chip)

/* Поля LowCyl и HighCyl контролируются tooltypes в иконке RAD.
 *
 * LowCyl   = 0                           - Нижняя дорожка
 * HighCyl  = 79                          - Верхняя дорожка
 *                                          (изменить для уменьшения или
 *                                          увеличения ёмкости - 880K)
 */

@endnode
@node Attrib

@{b}@{u}4.0 Атрибуты Mountlist@{uu}@{ub}

Buffers           - Число буферов памяти, нужных для передачи данных от устройства
                    в Amiga. 1 Буфер = 512 байт (приблизительно)
BufMemType        - Тип памяти для буферов. 0=Любая, 1=Chip.
Control           - Определяет параметры для драйвера или хендлера.
Device            - Имя драйвера, который может быть в ПЗУ (нет пути) или на
                    диске (обычно Devs:). Оно может быть перегружено ToolType.
DosType           - Четырёхбайтовый Идентификатор, обычно шестнадцатиричное,
                    начинающееся на 0x
                    См. @{"список" link DosType} общих DosTypes.
FileSystem        - Имя Файловой Системы, нужной для доступа к данным на диске,
                    которая может быть в ПЗУ (нет пути) или на диске
		    (обычно L:)
                    Используется для дисков или CD устройств.
Flags             - Флаги для драйверов. Зависят от самих устройств.
GlobVec           - Глобальный вектор для задачи. См. @{"описание" link Vector}.
Handler           - Имя Хендлера устройства, обычно в ПЗУ (нет пути) или на 
                    диске (L:). Используется для специальных устройств, как
                    speech, pipe и других.
HighCyl           - Номер верхнего цилиндра или дорожки на диске. Гибкие диски
                    имеют 79.
Interleave        - Число чередующихся дорожек. Зависит от устройства.
		    Обычно 0.
LowCyl            - Номер нижнего цилиндра или дорожки. Обычно 0.
Mask              - Маска памяти. Обычно базируется на последнем адресе
		    используемой памяти. Большенство стандартных устройств
		    Amiga используют Chip, устройства третьих фирм могут
                    пользоваться любым типом памяти.
                    @{"Подробнее о Маске" link DMAMask}.
MaxTransfer       - Максимальный размер блока данных, пересылаемый за один раз.
                    Для SCSI устройств, это не имеет значения, IDE устройства
                    могут не справиться на больших значениях. Используйте
                    0x1FE00 (128K) для безопасности.
                    Это значение НЕ ВЛИЯЕТ на производительность!
Mount             - Немедленное монтирование (1) или позже (0).
Priority          - Приритет для задачи устройства.
Reserved          - Число зарезервированных дорожек или цилиндров. Для Amiga
                    дисков и венчестеров - 2 для Boot-Блока или RDB.
SectorPerBlock    - Для старых устройств (обычно 1). Устарелая запись.
SectorsPerTrack   - Число секторов на дорожке.
SectorSize        - Размер сектора в байтах (увеличение по 512 байт)
StackSize         - Размер стека (увеличение по 1024 байт)
Startup           - Специальные параметры для хендлера или драйвера.
Surfaces          - Число поверхностей. Например, CD имеют 1 поверхность, а
                    диски могут иметь две и более. Тоже, что и число головок.
Unit              - Если устройство поддерживает больше одного unit'а, тогда
                    это его номер. Например, Floppy дисковводы имеют 0-3,
                    IDE поддерживают 0-3, а SCSI - 0-7. Обычно это значение
                    перегружается Unit Tooltype.

Более подробно в Rom Kernel Manuals: Expansion library и FileSystem Resources.

@endnode
@node DMAMask

@{b}@{u}4.1 Маска Памяти для DMA @{uu}@{ub}

	Маска памяти указывает, какой участок памяти может использовать
устройство. С помощью ShowConfig вы можете посмотреть участки адресов
доступной памяти. Выберете максимальный адрес нужного участка.

1. DMAMask должна начинаться на 1, 3, 7 или F. Если нет то подходящее выше.
2. Все остальные цыфры замените на F.
3. Последнюю - F на C.
4. Искомая величина.

Это важно. Если вы используете MapROM, вам следует проверить маску с помощью
ShowConfig, содержащую 7, которую нужно заменить.

Следующая таблица даёт несколько примеров :

      Адрес    |   DMAMask
   ------------+------------
    0x001FFFFF | 0x001FFFFC
    0x005FFFFF | 0x007FFFFC
    0x07FCFFFF | 0x07FFFFFC
    0x07FFFFFF | 0x07FFFFFC

@endnode
@node DosType

@{u}@{b}4.2 DOSTypes или Идентификаторы@{ub}@{uu}

	DosType - это четыре символа для файловой системы или устройства,
        оно часто записано как шестнадцатиричное число.

Идентификатор	Имя         Расшифровка
0x41465301  	AFS\1       Advanced File System
0x43443031  	CD0\0       CD ROM File System (WB3.1)
0x43444653  	CDFS       CD File System (AmiCDFS)
0x444F5300  	DOS\0       Old File System (OFS)
0x444F5301  	DOS\1       Fast File System for WB1.3 (FFS)
0x444F5302  	DOS\2       Old File System Intl (FFS)
0x444F5303  	DOS\3       Fast File System Intl for WB1.3 (FFS)
0x444F5304  	DOS\4       Old File System Intl, Dir Caching
0x444F5305  	DOS\5       Fast File System Intl, Dir Caching
0x4D414300  	MAC\0       Macintosh File System (HFS)
0x4D534400  	MSD\0       MessyDos File System (PC-Task hardfile)
0x4D534800  	MSH\0       MessyDos File System (CrossDos)
0x50445300  	PDS\0       Professional File System (Direct SCSI)
0x50465301  	PFS\1       Professional File System (Normal)
0x53465300  	SFS\0       Smart File System

@endnode
@node Vector

@{u}@{b}4.3 Глобальные Вектора@{ub}@{uu}

Значение Смысл
 0    	Стандартный вектор, используется для хендлеров, написанных на BCPL.
         Запускные пакеты передаются через регистр.
-1      Нет вектора, используется для хендлеров на C и ASM.
         Процесс должен ждать запускного пакета.
-2      Тоже, что и -3, кроме хендлеров на BCPL.
-3      Нет вектора, используется для хендлеров на C и ASM.
         Отличее от -1 то, что хендлер может производить ввод/вывод DOS до 
         возвращения запускного пакета.  В этом случае,  хендлер обязан
         проверять, что только он один загружен, для обеспечения правильного
         арбитража по доступу к полю dol_Task структуры DosList.
         Для GlobVec=-1,  всё это делается самой DOS.


@endnode
@node programs

@{u}@{b}5.0 Список полезных Программ для Mountlist'ов@{ub}@{uu}

Утилиты Workbench

HDToolbox       - Программа подготовки диска. Используйте `Change Drive Type`
                  и Define New, затем Read Configuration для получения размера
                  и другой информации о диске.

Утилиты Aminet

disk/misc/DoMount       - Создаёт собственный scsi mountlist
disk/misc/mount_msdos   - Как определить MS DOS портиции
disk/misc/MountDOS100   - Чтение/Просмотр и монтировка MSDOS портиций
disk/misc/MountInfo     - Просмотр mountlist'ов для авто-монтирующихся устройств
disk/misc/NewZipMount   - ZIP mount скрипты
disk/misc/Zip_Mount12   - ZIP пособие и mac, ibm mountlist'ы
disk/salv/GenML13       - Генерирует строки mountlist'а
util/wb/MountRemHD      - Для Syquest EZ

@endnode
@node Author

@{u}@{b}6.Автор@{ub}@{uu}

Peter Hutchison

Это пособие было написано для Amiga Сообщества. Mountlist'ы, до сих пор, ещё
никогда как следует не описывались. Утилиты писались, но детали были спрятаны.
А создавать Mountlist'ы сложно без информации на руках. Я надеюсь это пособие
позволит пользователям писать Mountlist'ы и Драйверы Dos с уверенностью.

Email: pjhutch@blizzard.u-net.com

Web: http://www.blizzard.u-net.com/

Все мои руководства есть на Aminet и на моей web-страничке в HTML и AmigaGuide
форматах. Скачивайте и используйте на здоровье!

Перевод: Владимир Яворский
         РОССИЯ, г.Белгород ул.Б-Хмельницкого-60 кв.1
         тел: (0722)-26-38-12
         Email: united-arts@yandex.ru

@endnode
