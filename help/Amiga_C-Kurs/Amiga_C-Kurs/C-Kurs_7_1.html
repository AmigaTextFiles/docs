<html>
<head>
<title>Amiga C Kurs f&uuml;r Einsteiger</title>
<META NAME="description" CONTENT="Amiga C Kurs f&uuml;r Einsteiger">
<META NAME="keywords"    CONTENT="C, Amiga, Programmierung, Kurs, Einsteiger, StormC">
<META NAME="author"      CONTENT="Norman Walter">

<script language="JavaScript" src="JavaScript/C-Kurs_Kapitel.js" type="text/javascript">
</script>

</head>
<body bgcolor="black" link="#DDDDDD" vlink="#BBBBBB">
<center>
<TABLE>
<TD VALIGN="TOP" ALIGN="TOP" WIDTH="140">
<CENTER>
<A HREF="index.html" NAME="Home"><IMG SRC="Home.png" ALT="Home" BORDER="0"></A><BR>
<A HREF="download.html" NAME="Downloads"><IMG SRC="Download.png" ALT="Downloads" BORDER="0"></A><BR>
<A HREF="Links.html" NAME="Links"><IMG SRC="Links.png" ALT="Links" BORDER="0"></A><BR>
<a href="cgi-bin/GB_SHOW.cgi" method="POST"><img SRC="guestbook.png" BORDER=0 alt="Guestbook"></a>
<p>
<A HREF="http://www.norman-interactive.com/email_feedback.html">
<IMG SRC="@.png" Border="0" Alt="e-mail"><BR><small>e-mail</small></A><BR>
<p>

<img src="C-Kurs/C-Kurs_sm.png" alt="Amiga C Kurs f&uuml;r Einsteiger" vspace="20"><BR>

<NOSCRIPT>
<font color="red">
Diese Seite ben&ouml;tigt JavaScript.
Entweder Ihr Browser unterst&uuml;tzt kein JavaScript, oder Sie haben es deaktiviert.
</font>
</NOSCRIPT>

<SCRIPT LANGUAGE="JavaScript">
<!--

  erzeuge_Kapitel(7);

//-->
</SCRIPT>

<p>
</CENTER>
</TD>
<TD VALIGN="TOP" ALIGN="TOP" WIDTH="400" HEIGHT="600">
<center>
<p>
<BR>
<font color="white">

<img src="C-Kurs/C-Kurs.png" alt="Amiga C Kurs f&uul,r Einsteiger"><BR>
</center>
<p>
<font color="gray"><H2>Shared Libraries</H2></font><BR>
<p>
Bislang haben wir in diesem Kurs ausschlie&szlig;lich Programme nach
ANSI C Standard gesehen, die sich unter jedem beliebigen Betriebssystem
compilieren lassen. Da wir einen Amiga C Kurs machen, wollen wir uns
nun ein wenig mit der AmigaOS API besch&auml;ftigen.
<p>
Eine API (Application Programming Interface) ist die Menge der von einem
Betriebssystem bzw. von Bibliotheken bereitgestellten Funktionen.
<p>
Das AmigaOS ist ein sogenanntes Microkernel Betriebssystem. Das bedeutet,
das eigentliche Betriebssystem (der sogenannte Kernel) &uuml;bernimmt nur rudiment&auml;re
Funktionen, wie z.B. das Task-Management. Der Kernel des AmigaOS ist Exec.
Alle anderen Funktionen f&uuml;r Aufgaben wie z.B. Zugriff auf Dateien, Grafik, Sound,
Netzwerk usw. werden &uuml;ber sogenannte Shared Libraries bereitgestellt.
Diese Shared Libraries (= Bibliotheken) werden, wenn sie sich nicht im
Kickstart-Rom befinden, bei Bedarf von Festplatte nachgeladen.
Dies hat den Vorteil, da&szlig; das Betriebssystem sehr resourcensparend und
flexibel ist. Es werden auch viele Shared Libraries f&uuml;r verschiedene
Aufgabenbereiche von Fremdherstellern angeboten. Wie Sie wahrscheinlich
schon wissen, befinden sich diese Shared Libraries auf Ihrer Systempartition
im Verzeichnis <TT>SYS:Libs/</TT>.
<p>
<center>
<TABLE border="0" bgcolor="white">
<CAPTION>
Shared Libraries (Beispiele)
</CAPTION>
<TR bgcolor="gray">
<TD><b>Name</b></TD>
<TD><b>Aufgabe</b></TD>
</TR>
<TR>
<TD>datatypes.library</TD>
<TD>Ein- und Ausgabe von Multimedia-Dateien</TD>
</TR>
<TR>
<TD>diskfont.library</TD>
<TD>Schriften von Disk nachladen</TD>
</TR>
<TR>
<TD>dos.library</TD>
<TD>Amiga Disk Operating System</TD>
</TR>
<TR>
<TD>expansions.library</TD>
<TD>Einbindung von Hardware-Erweiterungen</TD>
</TR>
<TR>
<TD>gadtools.library</TD>
<TD>GUI Toolkit</TD>
</TR>
<TR>
<TD>graphics.library</TD>
<TD>Verschiedene Grafikfunktionen</TD>
</TR>
<TR>
<TD>icon.library</TD>
<TD>Funktionen f&uuml;r die Verarbeitung von Piktogrammen</TD>
</TR>
<TR>
<TD>intuition.library</TD>
<TD>Verwaltung von Screens und Fenstern</TD>
</TR>
</TABLE>

<BR>
<p>
</center>
<p>
Wenn wir die Funktionen einer solchen Shared Library benutzen wollen,
gehen wir wie folgt vor:
Zuerst definieren wir eine <a href="C-Kurs_4_2.html">Zeigervariable auf eine Struktur</a>
vom Typ Library. Anschlie&szlig;end &ouml;ffnen wir die entspechende Library mit Hilfe der
Amiga-Systemfunktion <TT>OpenLibrary</TT>. Die Funktion <TT>OpenLibrary</TT>
gibt, falls die angegebene Library erfolgreich ge&ouml;ffnet wurde, einen Zeiger
auf diese, andernfalls (falls die Library nicht ge&ouml;ffnet werden konnte),
<TT>NULL</TT> zur&uuml;ck.
<p>
Der Syntax der Funktion <TT>OpenLibrary</TT> ist:<BR>
<pre>
  <i>Zeiger</i> = OpenLibrary([<i>Name</i>], [<i>Version</i>]);
</pre>
<BR>
<p>
<i>Name</i> ist der Name der zu &ouml;ffnenden Library. Im Parameter
<i>Version</i> kann man angeben, welche Versionsnummer (als LONG-Wert)
die Library mindestens haben soll. Ist die Versionsnummer der Library
auf Disk kleiner wie der angegebene Wert, gibt die Funktion einen Zeiger
auf <TT>NULL</TT> zur&uuml;ck. Wenn die Versionsnummer egal ist, gibt
man hier den Wert <TT>0L</TT> an.
<p>
Zus&auml;tzlich m&uuml;ssen, wie bei allen Funktionen, die
<a href="C-Kurs_1_10.html">Funktionsprototypen</a> der von der Bibliothek
bereitgestellten Funktionen vor der ersten Verwendung bekannt sein.
Dazu bindet man die zur Bibliothek zugeh&ouml;rigen Header-Dateien mit der
Pr&auml;prozessordirektive <a href="C-Kurs_2_3.html">#include</a> ein.
<p>
Vor Beendigung des Programms sollte man die ge&ouml;ffneten Funktionen mit
Hilfe der Funktion <TT>CloseLibrary</TT> wieder schlie&szlig;en. Dabei ist
allerdings Vorsicht geboten: Der Versuch eine Library zu schlie&szlig;en,
welche nicht zuvor erfolgreich ge&ouml;ffnet wurde, f&uuml;hrt zum Absturz des
Programms.
<p>
Listing 7.1 zeigt anhand eines einfachen Beispiels den Umgang mit
Shared Libraries:

<p>
<center>
<TABLE border="0" cellpadding="5" cellspacing="0" bgcolor="#AAAAAA"><TR>
<TD>
<!-- begin of C code -->
<font color="#FFFFFF">
/*&nbsp;&nbsp;&nbsp;Listing&nbsp;7.1<br>
&nbsp;*&nbsp;&nbsp;&nbsp;Hello,&nbsp;Amiga<br>
&nbsp;*/<br></font>
<br>
<font color="#008822"><b>//&nbsp;Amiga&nbsp;System&nbsp;Includes<br></b></font>
#include&nbsp;&lt;proto/exec.h&gt;<br>
#include&nbsp;&lt;proto/dos.h&gt;<br>
<br>
<font color="#AA00FF"><b>int</b></font>&nbsp;main(<font color="#AA00FF"><b>void</b></font>)<br>
{<br>
&nbsp;&nbsp;<font color="#008822"><b>//&nbsp;Zeiger&nbsp;auf&nbsp;eine&nbsp;Library<br></b></font>
&nbsp;&nbsp;<font color="#AA00FF"><b>struct</b></font>&nbsp;<font color="#45FF65">Library</font>&nbsp;*DOSBase;<br>
<br>
&nbsp;&nbsp;<font color="#008822"><b>//&nbsp;Library&nbsp;&ouml;ffnen<br></b></font>
&nbsp;&nbsp;<font color="#AA00FF"><b>if</b></font>((DOSBase&nbsp;=&nbsp;<font color="#FFFFAA">OpenLibrary</font>(<font color="#EEDD05">"dos.library"</font>,0L))&nbsp;!=&nbsp;NULL)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008822"><b>//&nbsp;Text&nbsp;ausgeben.&nbsp;L&auml;nge:&nbsp;13&nbsp;Zeichen<br></b></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#FFFFAA">Write</font>(<font color="#FFFFAA">Output</font>(),&nbsp;<font color="#EEDD05">"Hello,&nbsp;Amiga\n"</font>,&nbsp;13);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008822"><b>//&nbsp;Library&nbsp;wieder&nbsp;schlie0en<br></b></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#FFFFAA">CloseLibrary</font>(DOSBase);<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;<font color="#AA00FF"><b>return</b></font>&nbsp;0;<br>
}<br>

<!-- end of C code -->

</TD>
</TR>
</TABLE>
</center>
<BR>
<p>

Im obigen Beispiel geben wir einen kurzen Text String auf der Konsole
aus.
<p>
Bitte beachten Sie die <a href="C-Kurs_1_5.html"><TT>if</TT></a> Verzweigung: Die Funktion <TT>Write</TT>
aus der <TT>dos.library</TT> kann nur benutzt werden, nachdem wir die Bibliothek
zuvor erfolgreich ge&ouml;ffnet haben. Deshalb fragen wir zuvor ab, ob der von
<TT>OpenLibrary</TT> zur&uuml;ckgegebene Zeiger ungleich <TT>NULL</TT> ist.
Vor dem Beenden des Programms schlie&szlig;en wir die <TT>dos.library</TT> mit Hilfe
von <TT>CloseLibrary</TT> wieder. Der Aufruf von <TT>CloseLibrary</TT> steht
dabei innerhalb des zur <a href="C-Kurs_1_5.html"><TT>if</TT></a> Konstruktion
zugeh&ouml;rigen Anweisungsblocks. Deshalb wird <TT>CloseLibrary</TT>
auch nur dann aufgerufen, wenn die Library zuvor erfolgreich ge&ouml;ffnet wurde.
Alternativ h&auml;tten wir die <TT>dos.library</TT> auch mit Hilfe der folgenden
Konstruktion schlie&szlig;en k&ouml;nnen:

<p>
<center>
<TABLE border="0" cellpadding="5" cellspacing="0" bgcolor="#AAAAAA"><TR>
<TD>
<!-- begin of C code -->
&nbsp;<font color="#AA00FF"><b>if</b></font>&nbsp;(DOSBase&nbsp;!=&nbsp;NULL)&nbsp;<font color="#FFFFAA">CloseLibrary</font>(DOSBase);<br>

<!-- end of C code -->

</TD>
</TR>
</TABLE>
</center>
<BR>
<p>

Hier fragen wir ab, ob der von <TT>OpenLibrary</TT> gelieferte Zeiger
ungleich <TT>NULL</TT> ist. Wenn der Zeiger <TT>NULL</TT> ist, bedeutet
dies, da&szlig; die Library nicht ge&ouml;ffnet (oder bereits geschlossen) wurde.
<p>
Alternativ h&auml;tten wir dies auch wie folgt formulieren k&ouml;nnen:

<p>
<center>
<TABLE border="0" cellpadding="5" cellspacing="0" bgcolor="#AAAAAA"><TR>
<TD>
<!-- begin of C code -->
&nbsp;<font color="#AA00FF"><b>if</b></font>&nbsp;(DOSBase)&nbsp;<font color="#FFFFAA">CloseLibrary</font>(DOSBase);<br>

<!-- end of C code -->

</TD>
</TR>
</TABLE>
</center>
<BR>
<p>

Ein Zeiger als Argument einer <TT>if</TT> Verzweigung wird in der Programmiersprache C
als <TT>FALSE</TT> (= falsch) ausgewertet, wenn dieser der <TT>NULL</TT> Zeiger ist,
ansonsten wird der Ausdruck <TT>TRUE</TT> (= wahr). Im Falle unseres kleinen Beispielprogramms
w&uuml;rde das bedeuten, da&szlig; die obige <TT>if</TT> Konstruktion genau dann als wahr gewertet wird,
wenn die Funktion <TT>OpenLibrary</TT> unsere Systembibliothek erfolgreich ge&ouml;ffnet hat.
<p>
Allerdings halte ich pers&ouml;nlich die erste Formulierung f&uuml;r Anf&auml;nger besser,
da unsere zweite Version zu Missverst&auml;ndnissen f&uuml;hren k&ouml;nnte. Die Funktion
<TT>OpenLibrary</TT> gibt einen <a href="C-Kurs_4_2.html">Zeiger auf eine Struktur</a>
und nicht etwa <TT>TRUE</TT>, <TT>FALSE</TT> oder gar <TT>int</TT> zur&uuml;ck.
Machen Sie sich in diesem Zusammenhang bitte klar, da&szlig; ein Zeiger auf <TT>NULL</TT>
nicht das selbe ist wie der <TT>int</TT> Wert <TT>0</TT>.
<p>
</font>
</center>
</TD>
</TABLE>

</body>
</html>
