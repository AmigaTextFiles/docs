
From: Ron Flory <rjflory@feist.com>
Newsgroups: comp.os.linux.m68k
Subject: My version of m68k install FAQ (rev 1)
Date: Fri, 14 Mar 1997 21:48:10 -0600
Organization: Feist Connections
Lines: 1299
Message-ID: <332A1BFA.65BE@feist.com>
NNTP-Posting-Host: mark104.fn.net
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="------------118216B228CB"
X-Mailer: Mozilla 3.01 (WinNT; I)

This is a multi-part message in MIME format.

--------------118216B228CB
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Attached is revision 1 of my version of a (growing) m68k Linux 
install FAQ.

 The purpose of this posting is to permit others to review this
work.  As always, I appreciate any ideas and/or corrections.

ron

--------------118216B228CB
Content-Type: text/plain; charset=us-ascii; name="M68k-faq.txt"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline; filename="M68k-faq.txt"

From: Ron Flory (rjflory@feist.com)
Subj: m68k (Amiga) install mini-FAQ (Major Rev I)
Date: 14 march 1997

                  ------------------

 This is the second generation of this document.  The first 
version was intended to be a simple explanation of all the
things I had to find out on my own before I could get m68k 
running.  This version is intended to be a little more 
informative, and due to some good feedback, is more in line
with the m68k mind-set.  

 I have wiped-clean an re-installed Linux from scratch on my 
machine MANY times to help ensure I encounter the same kind 
of problems a first-timer would.

                  ------------------

 This 'mini-FAQ' is designed to help others who are trying to
get into Linux on the Amiga, although Atari folks can benefit 
from some of this information.  The current install FAQ is over 
a year old and has become a bit dated; even so you should still
get a copy because it contains so much really helpful info.


 The official, up-to-date m68k Linux FAQ can be found at:

   http://www.clark.net/pub/lawrencc/linux/faq/faq.html


 The old (but -very- helpful) install-FAQ can be found at:

   http://www.informatik.uni-oldenburg.de/~amigo/InstGuide


 An Atari oriented install-FAQ can be found at:

   http://www.dadacomm.com/linux-m68k/howto.txt


 The usenet (news) feed for m68k Linux is:

   comp.os.linux.m68k


 [ Is there a PPP/SLIP install guide for Amiga ?? ]


 Read the official m68k Linux FAQ, the original m68k Linux 
Install FAQ, then fully read this (not so) mini-faq before 
touching your machines.  They may not make much sense just yet,
but there will be fewer surprises later on.

 I've been a systems developer on several platforms for over 15
years and find the Amiga to be among the better ones.  However,
with the fall of Commodore etc., Linux seems to be a good 
second choice for an operating system, particularly if you just 
happen to have a spare A2000 laying around (like I do).

 This install process is not a trivial undertaking so I assume 
you have at least a little knowledge of computers; Amiga, 
AmigaDos and Linux in particular.  I bit of hardware experience 
is also a plus...

 This mini-FAQ will build upon the content of the original m68k 
Linux Install-FAQ, so you should refer to it from time-to-time 
when questions arise.  Although I should make this a stand 
alone document, removing references to the original install-FAQ, 
I don't have the time for this just yet (maybe this summer).

 I assume you will be installing Linux onto a functional 
AmigaDos system, with a hard disk dedicated to Linux.  You can 
partition a single disk to hold both AmigaDos and Linux, but 
even I'm too prone to typos' to risk such an adventure.  (yes, 
I actually did wipe out my primary disk, but a tape restore had
me back online in 15 minutes).

 Some of the methods and opinions presented here may appear less 
than optimal to a seasoned kernel hacker, but some advanced 
issues are too confusing to a person who is just starting out.  
I am NOT a Linux guru, but I know enough to get things online, 
if I have broken some secret Linux taboo, please let me know- 
not to publicly crucify me, but so that I may learn a better 
way, and pass it on....  

 Ron Flory (rjflory@ifrsys.com, rjflory@feist.com)
 Kechi, Ks, USA


============================================================
============================================================
========================= The System =======================
============================================================
============================================================

 My main Amiga experience is with A500 and A2000 systems,
although I'm told Linux will run on the A3000 and A4000 series
as well.  For a list of system requirements, please check-out:

   ------------------------------------------------------

   http://www.clark.net/pub/lawrencc/linux/faq/faq-3.html

   ------------------------------------------------------

 My 'spare' system is a 12meg '030 based A2000 with a GVP disk
controller, and an Ariadne ethernet card.

 I find an old 150-meg disk drive to be more than sufficient
to hold the base m68k Linux package (add another 150-meg if you 
want to experiment with the X11 system).  You should be able to 
find a cheap used drive if you currently have only one hard disk 
on your system.

 It is helpful to have other Amiga and Linux systems present on
your network.  You never know when you will need a specific 
file, and its a lot easier to ftp from another system than to 
shutdown and restart each time you need to copy a file.  Also, 
there are several files missing in the m68k distribution that 
are most easily copied from an i386 Linux machine sitting next-
door.  If you don't have an i386 Linux machine, find a buddy 
that does.  


============================================================
============================================================
==================== Getting The Files =====================
============================================================
============================================================

 On the machine on which you are going to install m68k Linux 
create a directory called 'linux'.  Mine is DH0:linux.  Place 
all the downloaded files into this directory.

 If you do not have a CDROM with all the necessary files, you'll
need to FTP them from one of the m68k Linux mirror-sites.  Refer
to this list for the site nearest you:

   ------------------------------------------------------

   http://www.clark.net/pub/lawrencc/linux/faq/faq-7.html

   ------------------------------------------------------

 The section of interest is "7.6 FTP Sites".  I've found the 
tsx.mit.edu site to be reliable, so that's the one I use.


 Using a web browser:   ftp://tsx.mit.edu/pub/linux/680x0/

   Note: browsers sometimes have trouble determining
         whether or not to display a file to the screen
         or save it to disk.  Sometimes an old-fashioned
         shell (text-based) FTP session works best.

            -- or --

 Using a shell FTP, access:   tsx.mit.edu
                  login as:   anonymous
                  password:   <your email address>

   Then enter command:

                  cd  pub/linux/680x0
                  lcd <full path of local temp directory>
                  bin
                  prompt 0          (works on -most- systems)

   ---------------------------------------------------

 'cd' to the 'tools/amiga' directory.  You will need a few 
helper programs present on the AmigaDos side.  Copy these files
to your local machine:

   Current directory is /pub/linux/680x0/tools/amiga

      gzip-1.1.2.lha                      297 Kb
      ixemul.library                      144 Kb

      Note: I'm not sure where ixemul is actually used, but go
            ahead and get it anyway.


 'cd' back to the 'watchtower' directory.  you will need to
download all the files in this directory.  This will take quite
a while so make sure you have a fast/clean modem connection and
several hours to kill.

   Current directory is /pub/linux/680x0/watchtower

      CONTENTS                            256 bytes
      watchtower-2-root.CONTENTS.gz         5 Kb
      watchtower-2-root.tar.gz           1738 Kb
      watchtower-2-usr.CONTENTS.gz         49 Kb
      watchtower-2-usr.tar.gz           12963 Kb
      watchtower-2-usrdoc.CONTENTS.gz      21 Kb
      watchtower-2-usrdoc.tar.gz         7783 Kb
      watchtower-2-var.CONTENTS.gz          1 Kb
      watchtower-2-var.tar.gz              66 Kb
      watchtower-2.INSTALL                  2 Kb
      watchtower-2.NEWS                   666 bytes
      watchtower-2.PACKAGES                 1 Kb
      watchtower-2.README                   2 Kb


 Here is where you need to decide which version you want to use.
Even numbers like 2.0.x indicate a stable version whereas odd 
values such as 2.1.x are experimental.  Stick with the stable 
versions unless you are a kernel hacker.  Generally you will 
want to use the most recent version, unless you've seen traffic 
on the newsgroups that indicate a problem with a particular 
version that might affect your system.


 'cd' back to the 'v2.0' directory.  I've had good luck with 
version 2.0.29 (and I've heard of problems with 2.0.28), so 
we'll download the files for 2.0.29:

   Current directory is /pub/linux/680x0/v2.0

      -- all Announce files --

      vmlinux-2.0.29-Amiga.tar.gz         567 Kb


 If you want to install the sources so that you can recompile 
the kernal, or your own C/C++ files you'll need:

   Current directory is /pub/linux/680x0/v2.0

      linux-2.0.29.tar.gz                6092 Kb


 'cd' into the 'boot' directory.  At this point you don't need
the LILO files, but keep them in mind because you might want to
get fancy and boot directly into Linux someday.

   Current directory is /pub/linux/680x0/v2.0/boot

      amiboot-4.0.README                    6 Kb
      amiboot-4.0.gz                       14 Kb


 'cd' back to the 'filesys' directory.  You will need these
files:

   Current directory is /pub/linux/680x0/v2.0/filesys

      filesys-ELF-2.0.x-1400K-2.README      1 Kb 
      filesys-ELF-2.0.x-1400K-2.gz        544 Kb 
      filesys-ELF-2.0.x-1400K-2.list.gz     2 Kb 


 The 1400k filesystem is recommended for future compatibility,
but it is missing the very convenient <tab> command-completion
and the command history buffer features present in the other
filesystem.


=========================================================
=========================================================
==================== Disk Prep ==========================
=========================================================
=========================================================

 This is the stage of installation where you need to be very,
very careful.  Take time to double-check every keystroke and 
mouse-click, otherwise you may format your AmigaDos partition.  
If this happens you'll have to re-install AmigaDos before you 
can get back to where you started from.

   ***********************************************************
   * Make sure you have a set of bootable floppy disks with  *
   * all the tools (programs) you need to repair any damage  *
   * you do here.  This includes disk/tape setup and restore *
   * programs.  Have you done a FULL backup ???  (today?)    *
   ***********************************************************

 Many *nix folks use several partitions- one for each major 
directory.  This is the best way for an experienced user to 
setup their system, but right now I'm just going to use a single 
directory structure, which is -much- easier for beginners.  

 The downside of using a single partition is potential file 
security and OS update issues, whereas the downside of using 
separate partitions for each key directory is if you choose too 
small a size for one of them.  Right now lets just get this 
critter on the air...

 You will need at least two (2) partitions:

   Name                    Purpose
  ------         ------------------------------------

   swap           (Linux virtual-memory swap space)
   /              (root filesystem)


 First decide how much swap-space you want.  We usually choose a
size that is about twice the amount of ram in the machine- 16meg
is a nice round number.

 If you have the option, place 'swap' on a different physical 
disk than your 'linux' partitions.  This will minimize head 
thrashing and increase system performance when swapping is used.

CAUTION: I have heard that creating a swap partition on the 
         Atari, though possible requires special knowledge.  If
         you are using an Atari and don't know how to change the 
         partition ID's, do not create a swap partition.  Linux
         will create a runtime swapfile for you on the existing 
         filesystem if it needs one.


   ---------------------------------------------------------

 You will need to use 'HDToolBox' which is found in the 'Tools'
drawer of your boot AmigaDos drive.

   -  Select the disk unit that will become your Linux drive.
      (Do not select your AmigaDos drive unless you know what
       you are doing...).

    If the selected disk does not properly reflect the drive 
   actually present, you need to update the table by performing 
   the following:

   -  Click on 'change drive type'.
   -  Ensure the box at the top properly describes the type
      of interface you have (i.e. SCSI).
   -  Click on 'define new'.
   -  Click on 'read configuration'.
   -  Read the requester box.  Nod your head and click 'OK'.

      All the numeric boxes should update.

   -  Keep in mind that some controllers don't work if
      reselection is used.  You may have to come back here
      and toggle the 'reselection' box someday.

   -  Record the number of 'blocks per cylinder', you MAY
      need it later.

   -  Click on 'cancel'
   -  Click on 'cancel'

         Note: you may want to 'save' the changes above if the
               screen does not properly reflect the identity of
               your Linux disk drive.


        -------------------------------------------------

 Now, you need to create the disk partitions for Linux:

 You should now be at the main HDToolbox screen.

   -  Select the disk unit that will become your Linux drive.
   -  Click on 'partition drive'
   -  Click on 'Advanced Options'  (to enable them).

   -  Delete any previous partitions (that you do not want).

       Make sure you are altering the proper disk.  If you are
      installing Linux on a single disk system, you will have
      to resize the existing partitions to make room for Linux.
      This is a destructive operation which will require you to
      re-install AmigaDos.  This is why I seriously advise you
      provide Linux with its own separate hard disk.

   -  Create the first partition (on the left side), and call
      it 'swap'.  I made mine 16-meg in size.
   -  Make sure the 'bootable' box is NOT enabled.
   -  Record the 'Total Cyl:', you MAY need it later.
   -  Click on 'change'.  Disable the 'automount' gadget.
   -  Click on 'OK'.

   -  Create the second partition.  Make it as large as the 
      rest of the disk.  Call it 'linux' and make sure it is 
      NOT bootable.
   -  Record the 'Total Cyl:' , you MAY need it later.
   -  Click on 'change'.  Disable the 'automount' gadget.
   -  Click on 'OK'.
   -  Click on 'OK'.


 You should now be at the main HDToolbox screen again.

   -  Click on 'Save Changes To Drive'.  It doesn't hurt to
      double-check everything before you commit these changes 
      to disk.  Take a minute and do so now.

   -  Click on 'exit'

   -  Your system -may- restart.


 My disk has 182 blocks per cyl.  My 'swap' partition was 189 
blocks long, yielding a swap partition of 17199 k-bytes.  My 
'linux' partition was 3410 blocks long, yielding 317863 k-bytes.

   Note: You do not really have to concern yourself with these
         lengths because Linux can determine these values
         automatically by looking at the partition headers.


===============================================================
===============================================================
================== Prepare for Installation ===================
===============================================================
===============================================================

 If you are like me, all these files have been downloaded onto
a machine other than the Amiga where m68k Linux will be
installed.  If so, you'll need to copy all the Linux files to
your Amiga.  Hopefully you have an ethernet card and AmiTcp
(or Miami), otherwise a serial connection and Twin-Express may 
help out.

   -  On the machine on which you are going to install m68k 
      Linux create a directory called 'linux'. 
       (remember, DH0:linux).
   -  Open a shell.
   -  Go To directory :linux

   -  extract the AmigaDos executable version of 'gzip' from 
      the gzip-1.1.2.lha archive.  I assume you have the 'lha'
      program.  If not, look into one of the aminet archives.

      ===============================================
         lha x gzip-1.1.2.lha
      ===============================================

   -  Go to directory gzip-1.1.2/amiga
   -  Copy the appropriate gzip executable (68000 or 68020) to
      a directory in your path, or just copy it to :linux/gzip
   -  Return to directory :linux.  (cd :linux)


 Ok, here's the only really ugly part for people trying to 
install Linux m68k on an AmigaDos machine.  The 'vmlinux' file 
is a gzipped 'tar' archive, which means that we need an Amiga 
version of 'tar' to extract the contents.  Well, I've never seen
an Amiga executable version of this program.  The only solution 
I've been able to find is to FTP the vmlinux-2.0.29-Amiga.tar.gz  
image file to a Unix/Linux machine, extract the contents, and 
FTP the resulting 'vmlinux' file back to my local machine.

 One solution is to use a nearby Linux machine on your network.

 A final desperate solution is to use a 'shell account' on your 
Internet Service Providers computer.  Most ISP's will allow you 
to FTP and TELNET onto their computer, and use a small amount 
of disk space.  As a last resort try to FTP 
'vmlinux-2.0.29-Amiga.tar.gz' into YOUR area of the ISP disk, 
then run:

   =====================================================
   gzip -c -d vmlinux-2.0.29-Amiga.tar.gz | tar xvf -
   =====================================================

 The file we need here is 'vmlinux', so FTP this file back to 
the DH0:linux directory of the machine you are going to install
m68k Linux on.

 Make sure the file  vmlinux  is located in your  :linux
AmigaDos directory.

   (( I'm glad that's over ))


Then extract the 'amiboot' program:

   =====================================================
   gzip -d amiboot-4.0.gz
   =====================================================

 If you want to, simply copy amiboot-4.0 to amiboot, its easier 
to type.


===============================================================
===============================================================
======================= A Kernel Dry Run ======================
===============================================================
===============================================================

 --OK--, now its time to see if m68k Linux will run on your
machine.  One way is to type all the commands and parameters
manually, or place them in a disk file called 'bootargs'.  I've 
chosen to create the following script file (that can be invoked 
with a icon) named 'install':

   ===============================================
      cd dh0:linux

      amiboot -k vmlinux 
              -r dh0:linux/filesys-ELF-2.0.x-1400k-2.gz
              root=/dev/ram video=ntsc
   ===============================================

   NOTE: All text following 'amiboot' is on the same line.
         European folks may want to specify 'video=pal'.

 If you decide to use a scriptfile, set the "SCRIPT" flag of the 
'install' script using the PROTECT command.


 Now is time for the big test.  Before you do this make sure you
have shut down any TCP/IP protocol programs FIRST, or the Linux 
loader will lock-up.  Now simply type 'install' (without the 
quotes of course).

   ===============================================
      install
   ===============================================

 If all has gone well, there will be a lot of disk activity 
without error messages, then the screen will go white for a 
while.  The screen will then go black and emit a page or two of
information.  This information is designed to help you determine
what hardware has been detected, and whether or not it is 
operating correctly.

   Simply login as 'root' (no password).


 Its a good idea to look into all the startup logging messages
generated by the kernal.  Most of them went by so fast that we
could not read them.  Sometimes (for some reason, not always) 
there is a copy of this information stored in the ram-
filesystem.  To view this information (and you should try), 
enter:

   ========================================
      cat /proc/kmsg 

         or

      cat /proc/kmsg > /tmp/kmsg
   ========================================

 If /proc/kmsg is empty (often the case) you will have to 
control-c out of this and go on to the next step, otherwise you
can view this copy of the logfile with 'vi' (vi /tmp/kmsg).  


===============================================================
===============================================================
===================== Setup the Filesystem ====================
===============================================================
===============================================================

 If all went well you are currently running under a Linux m68k 
RAM filesystem.

 I'm assuming you have a SCSI based machine.  Under Linux the 
first SCSI disk is called /dev/sdax, where 'x' refers to the 
partition number, starting with 1.

    For example, the first partition of the first SCSI drive is
   /dev/sda1 and the second partition of that drive is called 
   /dev/sda2, etc.

    Also, the first partition of the second SCSI drive is
   /dev/sdb1 and the second partition of that drive is called 
   /dev/sdb2, etc.

    IDE drives are identified in a similar manner, with 
   /dev/hda1 being the first partition of the first drive.


 So here's the layout of my machine:

   AmigaDos:   /dev/sda1      (1st drive, 1st part)
   Linux swap: /dev/sdb1      (2nd drive, 1st part)
   Linux:      /dev/sdb2      (2nd drive, 2nd part)


 To initialize the new disk partition(s):
   
   To create the 'swap' partition:

      ================================================
         /sbin/mkswap /dev/sdb1
         /sbin/swapon /dev/sdb1
      ================================================

    the length of 'swap' will be determined by the
   information written in the partition tables.


   To create the 'linux' partition:

      ================================================
         /sbin/mke2fs /dev/sdb2
      ================================================

    the length of 'linux' will be determined by the
   information written in the partition tables.

 Most other Linux distributions perform a 'sync' and system 
restart at this point, but I'm told its unnecessary with
this one.  

   If you wish to restart the system, enter:

   ===============================================
      /sbin/shutdown -r now ; exit
   ===============================================
   
    When it asks 'Why', type pretty much anything, and press
   enter, then wait for the system to restart.   Your system 
   should reboot back to AmigaDos.  Open a command shell and 
   go to the :linux directory.  Execute the 'install' script 
   (the one we created earlier) to reload a RAM-based m68k
   Linux session.

    When things stop moving, again login as 'root'.  If RAM is
   scarce on your machine, activate the swap partition using 
   the '/sbin/swapon' command the same way you did above.


===========================================================
===========================================================
================== Unpack the Filesystem ==================
===========================================================
===========================================================

 This part of the process will take some time.  We first need 
to mount our primary Linux disk partition:

   ===============================
      mount -t ext2 /dev/sdb2 /mnt
   ===============================

 '/mnt' is an alias for the location where we are going to
build the actual disk-based filesystem.

 If you are using several partitions (instead of the simplistic
single partition I'm using here) you also need to mount them
at this time.

 We need a second mountpoint to access all those files we
copied into our AmigaDos :linux directory, so create a new
subdirectory in your RAM-based Linux filesystem, then mount
it:

   ==================================
      mkdir /mnt2
      mount -t affs /dev/sda1 /mnt2
   ==================================

 You can verify this is your AmigaDos disk by doing a directory 
of /mnt2:

   =========================================================
      ls /mnt2
   =========================================================


 First go to the root of our new Linux disk partition:

   =========================================================
      cd /mnt
   =========================================================


 Next we need to extract the 'root' filesystem from the
'tar' archive on AmigaDos :linux directory:

   ============================================================
   gzip -c -d /mnt2/linux/watchtower-2-root.tar.gz | tar xvf -
   ============================================================

 This takes a while, but not too long...


 Next extract the 'usr' partition:

   ============================================================
   gzip -c -d /mnt2/linux/watchtower-2-usr.tar.gz | tar xvf -
   ============================================================

 Now this does take a quite a while...  Take a few minutes and 
look over the next section.

 After a few minutes the screen will go blank.  This is simply a
screen saver, you may wake up the screen by pressing the ALT 
key.

 Depending on the filesystem you are using, you might get a 
'Broken pipe' message right after 'usr/var' is extracted, This
is not a real error, ignore it.


 Next extract the 'var' partition:

   ============================================================
   gzip -c -d /mnt2/linux/watchtower-2-var.tar.gz | tar xvf -
   ============================================================

 This one is quick.


 If you want all the 'man' pages, you should also install the
'usrdoc' archive.  I advise that you do this unless disk space
is an issue.

 ==============================================================
 gzip -c -d /mnt2/linux/watchtower-2-usrdoc.tar.gz | tar xvf -
 ==============================================================


===============================================================
===============================================================
====================== Customize fstab ========================
===============================================================
===============================================================

 Before you attempt to run a disk-based Linux, you will have to 
change the contents of one of the disk files.  The 'fstab' file
tells Linux where to find the filesystems and partitions you
have created for it.

 The two fstab issues are:

   -  describing the 'swap' partition (if you have one).
   -  describing the 'linux' partition(s).

 Note that you must use the same /dev/sdxx or /dev/hdxx device 
entries that apply to your Linux disk drives.

 The editor included as part of Linux is 'vi'.  If you don't
know how to use vi and want to do more than described here, find 
a Linux manual and read up on 'vi'.


 (Note: I'm not a 'vi' expert, but here goes...)

 'vi' is an old-style screen-based text editor that recognizes 
cursor keys, several command codes and a number of special 
escape-sequences.  The minimal set of commands we need to edit
fstab are:

   a        enter INSERT mode at end of line under cursor.
   i        enter INSERT mode at current cursor position.
   arrows   move the cursor around the user text area.
   Escape   exit INSERT mode and enter COMMAND mode.
   :q!      when in COMMAND mode, quit without saving changes.
   :wq      when in COMMAND mode, write changes and quit.
   x        when in COMMAND mode, delete character under cursor.
   dd       when in COMMAND mode, delete the line under cursor.

 'vi' is always in one of two states, COMMAND or INSERT mode. In
order to enter new text you must be in INSERT mode.  To exit or
save changes you must be in COMMAND mode.  At any time you can 
return to COMMAND mode by pressing the Escape key.  If you are 
already in COMMAND mode, the bell will beep (or your screen will
flash white).

 Edit the current 'fstab' located on your hard disk:

   ============================================================
      cd /mnt/etc
      vi fstab
   ============================================================
 
 Note: all lines preceded with a # are comments.

 Cursor down to the entry '/dev/sda6' that describes the 
location of the Linux 'root' directory.  It is very likely that
your root directory is different than this.  Place the cursor 
over the first character that needs to be changed ('a' in my 
case) and press 'x' for each character that needs to be deleted.

   so  "/dev/sda6  "  becomes  "/dev/SD  "

 Now make sure the cursor is directly over the first blank 
character where you need to insert new text and press 'i'.  You 
are now in INSERT mode.  Enter the correct characters to make
this entry describe the location of your linux directory.  Press
Escape to return to COMMAND mode.  If you made an error, use 
these same steps to correct it.  If you really hosed things up
(as in FUBAR), press Escape and enter :q!  (this will abort the
edit session so you can start over).

 A word of caution: vi has a quirk of moving the cursor back 1
space to the left when you exit INSERT mode.  Don't let this 
bite you.  Also, the backspace-delete key does not seem to work.

 Use the cursor keys to make any additional changes.  When you 
are done, you write your changes to disk and exit by pressing
Escape followed by  :wq  .  (extra spaces to prevent confusion).


 Now that you are a 'vi' expert, you may make some of these
changes:

    If you are using an amiga, or you have properly setup an 
   Atari swapfile, you need to add the following entry to 
   /mnt/etc/fstab:

      /dev/sdb1    swap      swap    defaults   0 0


    My 'root' filesystem entry looks like this:

      /dev/sdb2    /       ext2   defaults   0 1


    Most of the other entries should be commented-out, except 
   for /dev/fd0, which is your floppy disk.

    Note that this fstab is setup to assume (if activated) that
   /c would be an MsDos partition.  This is a valid assumption 
   for some Amiga folks and all Atari people, but I don't have 
   (or want) an MsDos partition, I usually make my /c partition
   an alias for my primary AmigaDos affs disk, which is 
   /dev/sda1:

      /dev/sda1    /c      affs   defaults

   Note: you do not have to do this now, it may be done later,
         (manually).

 Save your changes and exit vi. (remember, Escape :wq ).


   **************************************************
   *****                                        *****
   ***** OK, here we are at the moment of truth *****
   *****                                        *****
   **************************************************

 We have things setup to the point where we should be able to
boot a 'live' disk-based Linux system. 

 Shutdown this ram-based version of Linux and reboot:

   ==========================================
      shutdown -r now ; exit
   ==========================================

 The system should unmount the various file systems, and
eventually reboot the system into AmigaDos (assuming you are
setup to boot into AmigaDos by default).


===============================================================
===============================================================
============= Your First Disk-Based Linux Boot ================
===============================================================
===============================================================

 Now we need to setup for easy startup of Linux from AmigaDos.
Open a command shell, and go to your :linux directory.

 We could manually type the commands to start Linux from now 
on, but I'm lazy and believe the machine should do this kind of
drudgery.  You may use a feature of the amiboot program where
startup options may be read from the file 'bootargs', but I 
still have to switch back and forth between ram/disk file
systems (to test this FAQ for example) far too often to lock 
myself down to one or the other mode.

 Another method is to create a script-file called 'boot' that 
looks very much like the 'install' script we made earlier:

   ==================================================
      cd dh0:linux
      amiboot -k vmlinux root=/dev/sdb2 video=ntsc
   ==================================================

    If you use the scriptfile method, Set the "SCRIPT" flag of 
   the 'boot' script using the PROTECT command.

   European folks may want to specify 'video=pal'.


 Now is time for the big test.  Before you do this make sure
you have shut down any TCP/IP protocol programs FIRST, or
the Linux loader will lock-up.  Now simply type 'boot'
(without the quotes of course).

   ===============================================
      boot
   ===============================================

 If all has gone well, there will be a lot of disk activity 
without error messages, then the screen will go white for a 
while.  A little later the screen will go black and start
producing a page or so of familiar messages regarding the 
hardware and filesystems it has found.  Finally a Linux signon 
screen should appear.

 If things did not go well then there are several possibilities:

   1. You have hardware that is not recognized.
   
          If you cannot do a normal 'shutdown', perform a 
         control-Lamiga-Ramiga restart, reboot and start a ram-
         based linux session, watching very closely for error 
         messages during the boot process.  Hopefully this will 
         give you a hint.


   2. You made an error in your /mnt/etc/fstab file.

          This one normally results in an error message 
         regarding the root filesystem.  Reboot into a ram-based
         Linux and fix /mnt/etc/fstab using 'vi'.  Double check
         all your entries again.


   3. You did not properly gzip/tar the root/usr/var/ file-
      systems.

          This should not happen if you did not receive any 
         error messages during the gzip/tar process (and you
         extracted the files to the proper location).  Boot up 
         under a ram-based linux session, mount /mnt, do a 
         cd /mnt and see if all the familiar directories are 
         present.


   4. Something else (god, I hate this one....).

          For this one you will most likely have to send cries
         for help across the usenet.  If you do this make sure
         you can fully describe your system, the files you've 
         installed and when (and where) the process goes sour.


 If you need to change fstab or any other aspect of the 
Linux files simply perform another RAM-base startup (using
the 'install' script, if you went that route).


 Ok, if you got to the signon prompt simply login as 'root'
(password is 'linux').

   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
      Note: your root password is 'linux'
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!


=============================================================
=============================================================
=================== Changing root Password ==================
=============================================================
=============================================================

 It is a very good idea to change your root password from 
something anyone can guess to something only you could guess.
Remember that anyone able to determine you have a m68k 
installation will know your default password.

 The only problem is that you can't change your password (yet)
because a key file is currently missing.  Just do this:

   ===========================
      cd /etc
      cp passwd passwd.OLD
   ===========================

 Now you should change the root password using the 'passwd'
command.  Editing this file with 'vi' is not recommended,   
especially since the password fields are encrypted.

 CAUTION: Once you change the root password, MAKE SURE you can 
          login to another console (after using left-alt-F2) 
          with the new password, otherwise you will be quite 
          locked-out.  It is possible to re-boot under a ram-
          based system and fix the passwd file by supplying an
          empty password field, but I would rather avoid this 
          joy.


==============================================================
==============================================================
====================== Adding New users ======================
==============================================================
==============================================================

 I'm not sure why, but I got the feeling that m68k Linux people 
don't seem to think running as root all the time is dangerous 
(it IS, and all other distributions always prompt you to create 
a personal user account so that you'll use it as often as 
possible instead of root).

 The problem is that a key script file 'adduser' is not present.
To get this file you will need access to another Linux machine,
(yes, an intel machine will work just fine).  You need to copy
/usr/sbin/adduser from some other system to your /usr/sbin 
directory.  Make sure it is readable and executable by root (by 
using the 'chmod' command [chmod 0700 /usr/sbin/adduser] ).

 Once 'adduser' is on your machine, simply enter:

   ===============================
      adduser <new-user-name)
      passwd  <new-user-name)
   ===============================


 Now there are a few problems I've encountered with m68k Linux
when not running as root.

   -  'vi' cannot be used, it complains about /tmp being r/o.
   -  'vi' cannot be used, it aborts with 'ex output' error.


============================================================
============================================================
=================== Setting Up the Sources =================
============================================================
============================================================

 If you wish to compile the kernel, or any C/C++ programs of 
your own that use system calls or defines you must extract the 
sources/includes and fix a 'softlink'.  If you have no 
interest in such things (yet) you can simply skip this section, 
it won't affect the normal operation of Linux.

 While running disk-based Linux, go to directory /usr.
Currently the /usr/src directory is a softlink.  This is not
good (as far as I can tell) so do this:

   ((( assuming your AmigaDos partition is Linux drive /c )))

   =========================================================
      cd /usr
      rm src
      mkdir src
      cd src

      gzip -c -d /c/linux/linux-2.0.29.tar.gz | tar xvf -

      ln -s -v /usr/src/linux-2.0.29 /usr/src/linux
   =========================================================

 This also will take a little while.


==============================================================
==============================================================
=============== Setting up the (local) Network ===============
==============================================================
==============================================================

 Ah, now here's a fun section (!).  If you have a network card
you have to manually alter Linux files to recognize it.  I have
an Ariadne card, so I'll explain how I got it working.

            -------------------------------------

 I do not use PPP on my m68k machine since I can access other
systems on my local network, but if you do want to use PPP you
must use an IP and/or netmask as supplied by your Internet
Service Provider (ISP).  Since I am not using PPP, I can offer 
no help in this area.

            -------------------------------------

 If are using a local ethernet connection you need to choose a 
network address and mask.  A general rule is that networks 
starting with 10.x.x.x are considered 'local'.  Since my 
network is purely local, I've chosen the address range of 
10.1.1.x for my network, yielding a netmask of 255.255.255.0.

 In the file /etc/hosts :

   *  There are several entries specifying the addresses of
      'other' machines.  You must leave the entries for 
      'localhost' and 'broadcast' alone, but you can deactivate
      any of the other entries by placing a # in front of them 
      if you wish.  You must insert an entry for your machine.  
      Since my secondary Amiga is called 'sidekick', my entry 
      looks like:

         10.1.1.14 sidekick.rjf.net sidekick

       The middle part is a fully-qualified address, chose one 
      of a similar for format your system (x.y.z) .  Make sure
      you provide BOTH aliases.

       You should also add the name of any nearby local
      systems.  My P6-200 NT Fileserver is called 'borg'
      (representing the evil Msoft empire, of course...):

         10.1.1.15 borg


 In the file /etc/netconfig change:

   from:    host watchtower
   to:      host sidekick.rjf.net

   from:    iface eth0 myhost 255.255.255.0 10.0.32.255 up
   to:      iface eth0 sidekick 255.255.255.0 10.1.1.255 up

       And under the section 'Routes' (there is already a 
      loopback  entry), add the following line:

   route -net 10.1.1.0 netmask 255.255.255.0 dev eth0


 If you plan on using a nameserver, you will need to activate
the 'ns' entry.


==============================================================
==============================================================
======================= Final Checkout =======================
==============================================================
==============================================================

 If you have gotten to this point, and things are still working
then its time to shutdown the machine, and restart using the 
new configuration.

 enter:

   =====================================
      shutdown -r now ; exit
   =====================================

 When the system powers back up in AmigaDos mode, go to your
:linux directory and type 'boot'.  Linux should startup, and
init the ethernet card (if present).

 Login as root, using the proper password.

 If you have a local machine on your network you should verify
your local network setups by 'ping'ing a nearby machine.  In
my case I'd say:

   ===============
      ping borg
   ===============

 This should quickly be followed by an endless series of lines
indicating 64 bytes from the physical address of the target
machine.  This is GOOD (i.e. you are online).

 Use control-c to exit.


==============================================================
==============================================================
============== How to NFS Mount another Machine ==============
==============================================================
==============================================================

 Although not quite as fast as FTP, NFS (Network File System) 
is a very convenient method of transferring files between 
computers.  Using this protocol I can directly send files 
between any of my machines (be they Linux (any flavor), NT, or
Win95).  

 In general, you should NFS mount (or grant mount rights to)
only machines you own, or trust.  This is a security opening if
not very carefully managed.


   ----------------------------------------------
   ---- Changes to the machine to be mounted ----
   ----------------------------------------------

   Append to /etc/exports:    (on i486 machine 'spareparts')

      / sidekick (rw,no_root_squash)  
      / borg (rw,no_root_squash)
      / avatar (rw,no_root_squash)
      / peace (rw,no_root_squash)

    This will allow my A2000 (sidekick) or my NT machine (borg)
   among others, to mount the root '/' directory of my i486 
   Linux machine 'spareparts'.

   CAUTION: Only use the 'no_root_squash' if you truly trust the
            connecting machine (and probably only if you have a
            'closed' network).  This option permits root 
            privilege-level access to your machine.


   ------------------------------------------------------
   ---- Changes to the machine which mounts another -----
   ------------------------------------------------------

   Append to /etc/fstab:      (on m68k machine 'sidekick')

      spareparts:/ /Spareparts nfs noauto,user,rw,exec,suid,dev
      borg:/       /Borg       nfs noauto,user,rw,exec,suid,dev


      Create mountpoint(s):

      ==========================================
         mkdir /Spareparts
         chmod 0777 /Spareparts

         mkdir /Borg
         chmod 0777 /Borg
      ==========================================

 Assuming the 'Spareparts' machine has been setup (as above) to 
grant NFS mount rights to your machine (Sidekick in my case),
you need to mount the remote filesystem like so:

   ==========================================
      mount -t nfs sidekick:/ /Sidekick
   ==========================================

 I made a simple script file containing the above command that 
can only be invoked by a root user (normal users may use 'suid'
if they know the root password).

   
 I have yet to successfully mount my m68k machine from an i486
machine (I am still experimenting with the RPC daemons).  My
connection requests have been rejected, or the machine crashes
when the RPC daemons are loaded.  If the situation improves I'll
update this section, or the section on network setup.


==============================================================
==============================================================
============== Using an Icon to start Linux ==================
==============================================================
==============================================================

 When the system powers up in AmigaDos mode, you might
consider making an icon in your ramdisk so you can simply
double-click on a quick ramdisk icon to restart
Linux.

 What I have done is to create an image of all the icons that
I'd like to be in my ramdisk drawer in a directory on my
AmigaDos boot disk.  I called it 'ram_image'.  Simply copy
any icons/programs you would like to appear the -very-
fast ramdisk into this directory.  To make things show up
in the ramdisk icon you need to add the following to your
'user-startup' file:

   ===============================================
      copy >nil: dh0:ram_image all ram: clone
   ===============================================

 Within dh0:ram_image I created a script file called 'linux'.
I then created a (project) icon that uses 'iconx' to execute
the contents of 'linux'.  The ram_image/linux file contains
simply:

   ===============================================
      cd dh0:linux
      boot
   ===============================================

 Now all I have to do to startup Linux is double-click on the
ramdisk then double-click on the 'linux' icon.


=============================================================
=============================================================
=========================== Closing =========================
=============================================================
=============================================================

 Please let me know about any errors or other misunderstanding.
I'll post this to the m68k Linux newsgroup from time-to-time.
I do not have (or want) a home page.

ron


--------------118216B228CB--

.
