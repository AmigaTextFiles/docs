
                    The Frequency Counter, (100Hz to 10MHz).
                    ----------------------------------------

  Technical Specifications:-
  --------------------------

  (Note:- A500+ and A600 specifications in brackets.)

  Calibrated Ranges.............  Low=100Hz to 100KHz, High=10KHz to 10MHz.
                                  (100Hz to 25KHz and 10KHz to 2.5MHz.)
  Working Limits................  70Hz to 11.5MHz in two ranges.
                                  (70Hz to 3.5MHz.)
  Accuracy......................  Better than + or - 5Hz on the lowest range,
                                  + or - 500Hz on the highest range.
  Frequency Drift...............  Entirely dependant on the individual AMIGA
                                  in use.
  Temperature Drift.............  Entirely dependant on the individual AMIGA
                                  in use.
  Sensitivity...................  Low range, TTL level only, 50% duty cycle
                                  square wave only.
                                  High range, TTL level only, minimum pulse
                                  width 50nS.
  Input Impedance...............  Always better than 1.2 KilOhms, in
                                  parallel with approximately 50pF, via
                                  series limiting resistors and clamping
                                  diodes.
  Gate Time.....................  About 1 second.
  Resolution....................  6 digits only.
  Maximum Safe Input............  15 Volts Peak to Peak, any waveform,
                                  clamped to the +ve and -ve rails through
                                  diodes and series resistors.
  Maximum Safe Input Duration...  10 Seconds.
  Other Measurements............  None.
  Supply........................  Taken from the games port.
  
  Note:- These specifications are for a standard A1200 running OS 3.0x.
         The A500+ and A600 specification changes are shown in brackets,
         and require OS 2.0x as a minimum.

----------------------------------------------------------------------------

  Overview:-
  ----------

  This tool is a VERY simple Frequency Counter only and is used to measure
  an alternating frequency to 10MHz. It is used to accurately set crystal
  oscillators, audio oscillators, and various types of VFOs, (variable
  frequency oscillators). Because I have NOT designed a very high range
  prescaler circuit, the upper limit of frequency measuement is 11.5MHz.
  I do NOT intend to design a ~divide by 10~ or ~divide by 100~ prescaler
  to increase the ranges, if you require this then you will have to design
  your own.

----------------------------------------------------------------------------

  System Requirements, Minimum In Brackets:-
  ------------------------------------------

  1) A standard A1200, (a standard A500+ or A600).
  2) The mouse, this is MANDATORY.
  3) AGA, (ECS).
  4) A PAL/NTSC monitor, (a PAL/NTSC television set).
  5) A hard disk drive, (an extra floppy disk drive).
  6) OS 3.0x, (OS 2.0x).
  7) Workbench MUST have a minimum of four colours, (this is the default).

  (For those of you who have accelerator cards fitted you MIGHT get a
  substantial increase in the count, say to 250KHz and 25MHz or more.)

  Known Problems, (NOT Bugs):-
  ----------------------------

  1) When using an A500+ or A600, and OS 2.0x with Workbench 2.0x there is
     the occasional frequency ~jitter~ downwards. ALWAYS use the higher of
     the ~jitter~ as this is the correct frequency reading.
  2) If the AMIGA used has got a Real Time Clock inside, then after use
     of the Frequency Counter it MIGHT need reseting back to the correct
     time, (see the assembler lines in the source code for the reason).

----------------------------------------------------------------------------

  Using The Frequency Counter:-
  -----------------------------

  1) Ensure that the A1200 is switched OFF.
  2) Connect the Frequency Counter hardware to the games port.
  3) Make sure that the jumper J1 is in position 2 & 3 of CON1.
  4) For the 100Hz to 100KHz range make sure that the jumper(s) J2 is in
     position 2 & 3 and J3 is in position 4 & 5 of CON2.
  5) For the 10KHz to 10MHz range make sure that the jumper(s) J2 is in
     position 1 & 2 and J3 is in position 3 & 4 of CON2.
  6) Switch ON the A1200 and boot into a standard Workbench 3.0x screen.
  7) Start up the ~Freq_Counter_PAL~ or ~Freq_Counter_NTSC~ software.
  8) A window will appear in standard ~Topaz 8~ font with a copyright
     notice and with some other text. ENSURE that the mouse pointer is over
     the counter window, then after 2 seconds...
  9) The window will clear and some text will appear in extended ~Topaz 16~
     font. This will read either ~Using default values.~ or ~Using
     calibrated values.~, then after a further 2 seconds...
 10) The window will clear again and also in extended ~Topaz 16~ font the
     word ~Waiting....~ will appear. This is a short delay to set the
     timing count. Note that if there is NOT an input signal of 70Hz or
     more on the Low range input or 7KHz or more on the High range input,
     then ~Waiting....~ will stay on screen ~ad infinitum~... until the
     Left mouse button is pressed once only, see Part 12).
 11) After ~Waiting....~ for about 1 second the frequency readout will be
     displayed, also in extended ~Topaz 16~ font, in two sections:-
     A) A set of up to six digits in one colour. These are the proper count
        digits and will constantly be updated approximately once every
        second. Use these digits ONLY for the 100Hz to 100KHz Low range.
     B) Two zeros at the end, ~00~ in a different colour to finish off the
        ~count~. These are for show only and give the correct number of
        characters for the 10KHz to 10MHz High range.
     C) These two colours are entirely dependant on YOUR personal Workbench
        ~Palette~ preferences.
 12) To exit a ~Waiting....~ or counting window, press the Left mouse button
     once only. This is to prevent any form of hanging and will place you
     into the Main Keyboard Window in standard ~Topaz 8~ font. ENSURE that
     the mouse pointer IS over the counter window for this to occur.
 13) The Main Keyboard Window:-
        ~Q~ or ~q~ will Quit back to Workbench.
        ~C~ or ~c~ will place you into the Calibration Window.
        ~Space Bar~ or ~ENTER/RETURN~ to go back to the count window.
 14) The Calibration Window:-
        ~H~ or ~h~ to alter the High frequency error correction value.
        ~M~ or ~m~ to alter the Middle frequency error correction value.
        ~L~ or ~l~ to alter the Low frequency error correction value.
        ~W~ or ~w~ to Save the values to the ~CURRENT~ working drawer.
        ~Space Bar~ or ~ENTER/RETURN~ to go back to the count window.
 15) When you have finished using the Frequency Counter switch OFF the
     A1200 and disconnect the hardware.

----------------------------------------------------------------------------

  Calibration:-
  -------------

  IF the ~Default~ values are NOT correct then continue with the calibration
  setup. If they are correct then skip this section completely.

  1) Ensure that the A1200 is switched OFF.
  2) Connect the Frequency Counter hardware to the games port.
  3) Put the jumper J1 to position 1 & 2 of CON1. Adjust jumpers J2 & J3
     to the range required as per Part(s) 4) or 5) of
     ~Using The Frequency Counter:-~ section.
  4) Initially set J2 & J3 to the 10KHz to 10MHz range.
  5) Switch ON the A1200 and boot into a standard Workbench 3.0x screen.
  6) Start up the ~Freq_Counter_PAL~ or ~Freq_Counter_NTSC~ software and
     obtain a count.
  7) This should read 10000000Hz + or - 200Hz, where the last two digits
     are in a different colour.
  8) Left click once to enter the ~Main Keyboard Window~.
  9) Press ~C~ or ~c~ to enter the ~Calibration Window~.
 10) Using ~H~ or ~h~ change the value for the High frequency range. ~H~
     will reduce the value by 1 and ~h~ will increase the value by 1.
 11) Press the ~Space Bar~ or ~ENTER/RETURN~ key to check the count.
 12) Go to Part 7) and keep doing this until the CORRECT count is obtained.
 13) IF you have access to a professional counter and a signal generator
     then do the Middle and the Low ranges as well, Part 13) A) and
     Part 13) B). If NOT then go to Part 14), (and read Part 15)). Set
     J2 & J3 to the 100Hz to 100KHz range and ensure that the output of the
     generator is a 50% duty cycle TTL level square wave.
     A) Using the 100Hz to 100KHz range, the Middle frequency is adjusted
        with keys ~M~ an ~m~ to display 5KHz + or - 2Hz from a generator
        set at 5KHz + or - 1Hz. Use the same method as for the High range,
        Part 7) to Part 12) inclusive, except change keys ~H~ and ~h~
        for ~M~ and ~m~.
     A) Using the 100Hz to 100KHz range, the Low frequency is adjusted
        with keys ~L~ an ~l~ to display 500Hz + or - 2Hz from a generator
        set at 500Hz + or - 1 Hz. Use the same method as for the High range,
        Part 7) to Part 12) inclusive, except change keys ~H~ and ~h~
        for ~L~ and ~l~.
 14) When all is correct press ~W~ or ~w~ to Save the values to the
     ~CURRENT~ working drawer.
 15) IF you do NOT have access to a professional counter or signal generator
     then you will have to trust the Middle and Low values at this point
     until the ~Crystal Calibrator~ has been built to check them. I have
     done ALL of that hard work already and I suspect that the count will
     be quite accurate over the whole range of 100Hz to 10MHz.
 16) If you are using the ~Freq_Counter_PAL~ software and CANNOT obtain
     the desired accuracy then try the ~Freq_Counter_NTSC~ instead and
     recalibrate, as this should give the required results.
 17) Similarly if you are using the ~Freq_Counter_NTSC~ software and CANNOT
     obtain the desired accuracy then try the ~Freq_Counter_PAL~ instead
     and recalibrate, as this should give the required results.
 18) When all is finished switch OFF the A1200 and disconnect all of the
     hardware.
 19) Put the jumper J1 to position 2 & 3 of CON1.

  Important Note:-
  ----------------

  Although I have NTSC facilities using my A1200 and PAL/NTSC monitor, and
  can switch between the two modes easily, I CANNOT guarantee the critical
  timings are correct for NTSC. However the timings work properly on my
  A1200,  standard A600, another A600 using OS 2.0x and also emulating
  OS 3.0x using ~SKICK~, an A500+ using OS 2.0x.

----------------------------------------------------------------------------

  How Does It Work:-
  ------------------

  1) Read the source code as it is free. It should be completely self
     explanitory, especially the CRITICAL timing part in assembler.
  2) Here is the assembler part of the source code using the ~ASSEM~ and
     ~END ASSEM~ statements in ~ACE Basic Compiler~:-

REM The critical timer for the games port.
ASSEM

  movem.l        d0-d7/a0-a6,-(sp)  ;Save all registers just in case...
  lea.l          $0,a0              ;Use ~RESET SSP~ for my variable.
                                    ;Who cares about ~ENFORCER HITS~ with
                                    ;a bog standard A1200.
  movea.l        $4,a6              ;Set the ~EXEC~ pointer.
  jsr            -132(a6)           ;Disable interrupts...
  jsr            -120(a6)           ;and tasking.
  move.l         #$0,d0             ;Clear ~d0~ for use.
  move.l         #$0,d1             ;Clear ~d1~ for use.
  move.l         d0,(a0)            ;Empty ~RESET SSP~ for use.
  move.b         d0,$bfd800         ;Clear ~todlo~ and
  move.b         d0,$bfda00         ;clear ~todhi~ and
  move.b         d0,$bfd800         ;ensure ~todlo~ is still clear and
  move.b         d0,$bfd900         ;clear ~todmid~ and
counter_wait1:
  move.b         d0,$bfd800         ;clear ~todlo~ again.
  cmpi.b         #$0,$bfd800        ;Ensure ~todlo~ = 0.
  bne            counter_wait1      ;If NOT then wait until it is...
counter_loop1:
ones_loop1:
  move.b         $bfe001,d1         ;Start with a ~MARK~ of a 50% duty cycle
                                    ;square wave.
  btst           #6,d1              ;Help let me out if I am hung up...
  beq            mouse_exit         ;Just left mouse click.
  btst           #7,d1              ;Check for a ~SPACE~ of a 50% duty cycle
                                    ;square wave. When ~SPACE~ comes exit.
  bne            ones_loop1
zeros_loop1:
  move.b         $bfe001,d1         ;Continue with a ~SPACE~ of a 50% duty
                                    ;cycle square wave.
  btst           #6,d1              ;Help let me out if I am hung up...
  beq            mouse_exit         ;Just left mouse click.
  btst           #7,d1              ;Check for a ~MARK~ of a 50% duty cycle
                                    ;square wave. When ~MARK~ comes exit.
  beq            zeros_loop1
  add.l          #1,d0              ;Increase counter by ~1 CYCLE~.
  move.b         $bfd900,d1         ;Use ~todmid~ as the
  cmpi.b         #$3e,d1            ;coarse timer value...
  bne            counter_loop1
  move.l         d0,(a0)            ;Save my count to location ~0~.
mouse_exit:
  movea.l        $4,a6              ;Set the ~EXEC~ pointer again.
  jsr            -126(a6)           ;Enable tasking...
  jsr            -138(a6)           ;and interrupts.
  movem.l        (sp)+,d0-d7/a0-a6  ;Reload the registers.

  EVEN

END ASSEM

  3) Why did I use the ~todlo~, ~todmid~ and ~todhi~ of CIAB?
     These were the ONLY values found to be ~constant~, with the three
     different AMIGA types that the Frquency Counter was to work on in both
     NTSC and PAL format.
  4) Why did I use location/address ~0~ to pass my ~variable~ instead of
     using the methods explained in the compiler docs?
     A) Simplicity, ~Enforcer Hits~ are not a problem on an absolutely
        standard A1200, A600 and A500+, (68020 and 68000 CPUs).
     B) It makes the overall executable program size much smaller, if
        memory is at a premium, (especially if it is run under OS 1.3x, OH!!
        did I forget to mention that it does work on an old style standard
        OCS, with an extra floppy drive, 0.5MB A500 but UNCALIBRATED).

----------------------------------------------------------------------------

  Other:-
  -------

  1) The original copyright goes to (C)2002 B.Walker, G0LCU.
  2) See the ~ReadMe~ file for legal and other issues.
  3) As the source code is free you are entitled to modify it subject to
     the standard ~GPL~ terms and conditions.
  4) This file MUST remain intact and go with the running software.

----------------------------------------------------------------------------

  Limitations:-
  -------------

  1) Because the hardware is hit directly and the ~Tasking~ and ~Interrupts~
     are disabled during these hits it is NOT practical to multitask the
     A1200 with other programs... Therefore the Frequency Counter MUST be
     left to run on its own.
  2) Effectively the Counter is a 6, (5.5), digit type making the resolution
     poor compared to commercial equipment but it is EXTREMELY cheap and
     this more than compensates for it.
  3) This counter only has one ~Gate~ time of about 1 second duration. It
     is easily possible to increase the ~Gate~ time to 10 seconds to
     increase the accuracy but I did not bother as I have issued the
     source code so that someone else could do it if they wish.

----------------------------------------------------------------------------

  To Do:-
  -------

  1) Make the Low range work WITHOUT the need for a TTL level 50% duty
     cycle square wave.
  2) Add an AC coupled preamplifier to the High range, to increase the
     sensitivity to better than 100mV RMS at 10MHz.
  3) Possibly add a 10 Second count range for more accuracy.

============================================================================

  Acknowledgements:-
  ------------------

First of all many thanks to my wife Tricia who allows me to spend many hours
on my computers.

Also to David Benn and Herbert Breuer for the ACE/AIDE combination supplied
on an AMIGA FORMAT floppy disk which made it easy to compile this program.

And finally to anyone else who I may have neglected or forgotten.

----------------------------------------------------------------------------

    Mr Barry Walker,
    70 King George Road,
    Loughborough,
    Leicestershire,
    LE11 2PA,
    England.

    Email to:-

    wisecracker@tesco.net

    BYE.....

============================================================================
