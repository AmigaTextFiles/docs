<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="Author" content="Joakim Ögren">
<meta name="Description"
content="Technical description of the PCI connector.">

<title>HwB: PCI (Tech) Connector</title>
<meta name="Keywords"
content="HwB, pinout, hardware, connector, pci, bus, technical">


</head>

<body background="images/bgr_grey.jpg" bgcolor="#C0C0C0"
text="#000000" link="#0000EE" vlink="#551A8B" alink="#FF0000">


<p align="center"><a href="menu_Connector.html"><img
src="images/mini_Back.GIF" alt="GoTo Connector" border="0"
width="64" height="48"></a><img src="images/menu_Connector.GIF"
alt="CONNECTOR" width="400" height="48"><a href="hwb.html"><img
src="images/mini_hwb.GIF" alt="GoTo Main" border="0" width="64"
height="48"></a></p>


<h1>PCI (Technical)</h1>

<p>This section is currently based soly on the work by Mark
Sokos.</p>

<p>This file is not intended to be a thorough coverage of the PCI
standard. It is for informational purposes only, and is intended
to give designers and hobbyists an overview of the bus so that
they might be able to design their own PCI cards. Thus, I/O
operations are explained in the most detail, while memory
operations, which will usually not be dealt with by an I/O card,
are only briefly explained. Hobbyists are also warned that, due
to the higher clock speeds involved, PCI cards are more difficult
to design than ISA cards or cards for other slower busses. Many
companies are now making PCI prototyping cards, and, for those
fortunate enough to have access to FPGA programmers, companies
like Xilinx are offering PCI compliant designs which you can use
as a starting point for your own projects.</p>

<p>For a copy of the full PCI standard, contact:</p>

<address>
    PCI Special Interest Group (SIG)<br>
    PO Box 14070<br>
    Portland, OR 97214<br>
    1-800-433-5177<br>
    1-503-797-4207 
</address>

<h2>Signal Descriptions:</h2>

<h3>AD(x)</h3>

<p>Address/Data Lines.</p>

<h3>CLK</h3>

<p>Clock. 33 MHz maximum.</p>

<h3>C/BE(x)</h3>

<p>Command, Byte Enable.</p>

<h3>FRAME</h3>

<p>Used to indicate whether the cycle is an address phase or or a
data phase.</p>

<h3>DEVSEL</h3>

<p>Device Select.</p>

<h3>IDSEL</h3>

<p>Initialization Device Select</p>

<h3>INT(x)</h3>

<p>Interrupt</p>

<h3>IRDY</h3>

<p>Initiator Ready</p>

<h3>LOCK</h3>

<p>Used to manage resource locks on the PCI bus.</p>

<h3>REQ</h3>

<p>Request. Requests a PCI transfer.</p>

<h3>GNT</h3>

<p>Grant. indicates that permission to use PCI is granted.</p>

<h3>PAR</h3>

<p>Parity. Used for AD0-31 and C/BE0-3.</p>

<h3>PERR</h3>

<p>Parity Error.</p>

<h3>RST</h3>

<p>Reset.</p>

<h3>SBO</h3>

<p>Snoop Backoff.</p>

<h3>SDONE</h3>

<p>Snoop Done.</p>

<h3>SERR</h3>

<p>System Error. Indicates an address parity error for special
cycles or a system error.</p>

<h3>STOP</h3>

<p>Asserted by Target. Requests the master to stop the current
transfer cycle.</p>

<h3>TCK</h3>

<p>Test Clock</p>

<h3>TDI</h3>

<p>Test Data Input</p>

<h3>TDO</h3>

<p>Test Data Output</p>

<h3>TMS</h3>

<p>Test Mode Select</p>

<h3>TRDY</h3>

<p>Target Ready</p>

<h3>TRST</h3>

<p>Test Logic Reset</p>

<p>The PCI bus treats all transfers as a burst operation. Each
cycle begins with an address phase followed by one or more data
phases. Data phases may repeat indefinately, but are limited by a
timer that defines the maximum amount of time that the PCI device
may control the bus. This timer is set by the CPU as part of the
configuration space. Each device has its own timer (see the
Latency Timer in the configuration space).</p>

<p>The same lines are used for address and data. The command
lines are also used for byte enable lines. This is done to reduce
the overall number of pins on the PCI connector.</p>

<p>The Command lines (C/BE3 to C/BE0) indicate the type of bus
transfer during the address phase.</p>

<table border="1">
    <tr>
        <th>C/BE</th>
        <th>Command Type</th>
    </tr>
    <tr>
        <td>0000</td>
        <td>Interrupt Acknowledge</td>
    </tr>
    <tr>
        <td>0001</td>
        <td>Special Cycle</td>
    </tr>
    <tr>
        <td>0010</td>
        <td>I/O Read</td>
    </tr>
    <tr>
        <td>0011</td>
        <td>I/O Write</td>
    </tr>
    <tr>
        <td>0100</td>
        <td>reserved</td>
    </tr>
    <tr>
        <td>0101</td>
        <td>reserved</td>
    </tr>
    <tr>
        <td>0110</td>
        <td>Memory Read</td>
    </tr>
    <tr>
        <td>0111</td>
        <td>Memory Write</td>
    </tr>
    <tr>
        <td>1000</td>
        <td>reserved</td>
    </tr>
    <tr>
        <td>1001</td>
        <td>reserved</td>
    </tr>
    <tr>
        <td>1010</td>
        <td>Configuration Read</td>
    </tr>
    <tr>
        <td>1011</td>
        <td>Configuration Write</td>
    </tr>
    <tr>
        <td>1100</td>
        <td>Multiple Memory Read</td>
    </tr>
    <tr>
        <td>1101</td>
        <td>Dual Address Cycle</td>
    </tr>
    <tr>
        <td>1110</td>
        <td>Memory-Read Line</td>
    </tr>
    <tr>
        <td>1111</td>
        <td>Memory Write and Invalidate</td>
    </tr>
</table>

<p>The three basic types of transfers are I/O, Memory, and
Configuration.</p>

<h2>PCI timing diagrams:</h2>

<pre>
            ___     ___     ___     ___     ___     ___
CLK     ___|   |___|   |___|   |___|   |___|   |___|   |___

        _______                                   _________
FRAME          |_________________________________|

                ______  _______  ______  ______  ______
AD      -------&lt;______&gt;&lt;_______&gt;&lt;______&gt;&lt;______&gt;&lt;______&gt;---
                Address  Data1    Data2   Data3   Data4

                ______  _______________________________
C/BE    -------&lt;______&gt;&lt;_______________________________&gt;---
                Command   Byte Enable Signals

         ____________                                   ___
IRDY                 |_________________________________|

         _____________                                  ___
TRDY                  |________________________________|

         ______________                                 ___
DEVSEL                 |_______________________________|
</pre>

<p>PCI transfer cycle, 4 data phases, no wait states. Data is
transferred on the rising edge of CLK.</p>

<pre>                         [1]              [2]        [3]
            ___     ___     ___     ___     ___     ___     ___     ___
CLK     ___|   |___|   |___|   |___|   |___|   |___|   |___|   |___|   |__

        _______                                                  _________
FRAME          |________________________________________________|

                                   A               B               C
                ______           ______________  ______  _____________
AD      -------&lt;______&gt;---------&lt;______________&gt;&lt;______&gt;&lt;_____________&gt;---
                Address           Data1           Data2   Data3

                ______  ______________________________________________
C/BE    -------&lt;______&gt;&lt;______________________________________________&gt;---
                Command   Byte Enable Signals

                                                         Wait
         ____________                                    _____         ___
IRDY                 |__________________________________|     |_______|

                        Wait            Wait
         ______________________         ______                         ___
TRDY                           |_______|      |_______________________|

         ______________                                                ___
DEVSEL                 |______________________________________________|
</pre>

<p>PCI transfer cycle, with wait states. Data is transferred on
the rising edge of CLK at points labled A, B, and C.</p>

<h2>Bus Cycles:</h2>

<h3>Interrupt Acknowledge (0000)</h3>

<p>The interrupt controller automatically recognizes and reacts
to the INTA (interrupt acknowledge) command. In the data phase,
it transfers the interrupt vector to the AD lines.</p>

<h3>Special Cycle (0001)</h3>

<table border="1">
    <tr>
        <th>AD15-AD0</th>
        <th>Description</th>
    </tr>
    <tr>
        <td>0x0000</td>
        <td>Processor Shutdown</td>
    </tr>
    <tr>
        <td>0x0001</td>
        <td>Processor Halt</td>
    </tr>
    <tr>
        <td>0x0002</td>
        <td>x86 Specific Code</td>
    </tr>
    <tr>
        <td>0x0003 to 0xFFFF</td>
        <td>Reserved</td>
    </tr>
</table>

<h3>I/O Read (0010) and I/O Write (0011)</h3>

<p>Input/Output device read or write operation. The AD lines
contain a byte address (AD0 and AD1 must be decoded). PCI I/O
ports may be 8 or 16 bits. PCI allows 32 bits of address space.
On IBM compatible machines, the Intel CPU is limited to 16 bits
of I/O space, which is further limited by some ISA cards that may
also be installed in the machine (many ISA cards only decode the
lower 10 bits of address space, and thus mirror themselves
throughout the 16 bit I/O space). This limit assumes that the
machine supports ISA or EISA slots in addition to PCI slots.</p>

<p>The PCI configuration space may also be accessed through I/O
ports 0x0CF8 (Address) and 0x0CFC (Data). The address port must
be written first.</p>

<h3>Memory Read (0110) and Memory Write (0111)</h3>

<p>A read or write to the system memory space. The AD lines
contain a doubleword address. AD0 and AD1 do not need to be
decoded. The Byte Enable lines (C/BE) indicate which bytes are
valid.</p>

<h3>Configuration Read (1010) and Configuration Write (1011)</h3>

<p>A read or write to the PCI device configuration space, which
is 256 bytes in length. It is accessed in doubleword units. AD0
and AD1 contain 0, AD2-7 contain the doubleword address, AD8-10
are used for selecting the addressed unit a the malfunction unit,
and the remaining AD lines are not used.</p>

<pre>Address     Bit 32      16   15           0

00          Unit ID        | Manufacturer ID
04          Status         | Command
08          Class Code               | Revision
0C          BIST  | Header | Latency | CLS
10-24            Base Address Register
28          Reserved
2C          Reserved
30          Expansion ROM Base Address
34          Reserved
38          Reserved
3C          MaxLat|MnGNT   | INT-pin | INT-line
40-FF       available for PCI unit
</pre>

<h3>Multiple Memory Read (1100)</h3>

<p>This is an extension of the memory read bus cycle. It is used
to read large blocks of memory without caching, which is
beneficial for long sequential memory accesses.</p>

<h3>Dual Address Cycle (1101)</h3>

<p>Two address cycles are necessary when a 64 bit address is
used, but only a 32 bit physical address exists. The least
significant portion of the address is placed on the AD lines
first, followed by the most significant 32 bits. The second
address cycle also contains the command for the type of transfer
(I/O, Memory, etc). The PCI bus supports a 64 bit I/O address
space, although this is not available on Intel based PCs due to
limitations of the CPU.</p>

<h3>Memory-Read Line (1110)</h3>

<p>This cycle is used to read in more than two 32 bit data
blocks, typically up to the end of a cache line. It is more
effecient than normal memory read bursts for a long series of
sequential memory accesses.</p>

<h3>Memory Write and Invalidate (1111)</h3>

<p>This indicates that a minimum of one cache line is to be
transferred. This allows main memory to be updated, saving a
cache write-back cycle.</p>

<h2>Bus Arbitration:</h2>

<p>This section is under construction.</p>

<h2>PCI Bios:</h2>

<p>This section is under construction.</p>

<address>
    <font size="2">Contributor: </font><a
    href="mailto:qtech@mailhost.net"><font size="2">Joakim Ögren</font></a><font
    size="2">, </font><a href="mailto:msokos1@gl.umbc.edu"><font
    size="2">Mark Sokos</font></a> 
</address>

<address>
    <font size="2">Sources: <a
    href="http://www.gl.umbc.edu/~msokos1/pci.txt">Mark Sokos PCI
    page</a><br>
    Sources: &quot;Inside the PCI Local Bus&quot; by Guy W.
    Kendall, Byte, February 1994 v 19 p. 177-180<br>
    Sources: &quot;The Indispensible PC Hardware Book&quot; by
    Hans-Peter Messmer, ISBN 0-201-8769-3</font> 
</address>


<address>
    <font size="1">Please send any comments to </font><a
    href="mailto:qtech@mailhost.net"><font size="1">Joakim Ögren</font></a><font
    size="1">.</font> 
</address>

</body>
</html>