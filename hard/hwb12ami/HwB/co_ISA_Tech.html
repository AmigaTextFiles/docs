<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">

<meta name="Author" content="Joakim Ögren">
<meta name="Description"
content="Technical description of the ISA connector.">
<meta name="Keywords"
content="HwB, pinout, hardware, connector, isa, bus, technical">

<title>HwB: ISA (Tech) Connector</title>

</head>

<body background="images/bgr_grey.jpg" bgcolor="#C0C0C0"
text="#000000" link="#0000EE" vlink="#551A8B" alink="#FF0000">


<p align="center"><a href="menu_Connector.html"><img
src="images/mini_Back.GIF" alt="GoTo Connector" border="0"
width="64" height="48"></a><img src="images/menu_Connector.GIF"
alt="CONNECTOR" width="400" height="48"><a href="hwb.html"><img
src="images/mini_hwb.GIF" alt="GoTo Main" border="0" width="64"
height="48"></a></p>


<h1>ISA (Technical)</h1>

<p>This file is designed to give a basic overview of the bus
found in most IBM clone computers, often referred to as the XT or
AT bus. The AT version of the bus is upwardly compatible, which
means that cards designed to work on an XT bus will work on an AT
bus. This bus was produced for many years without any formal
standard. In recent years, a more formal standard called the ISA
bus (Industry Standard Architecture) has been created, with an
extension called the EISA (Extended ISA) bus also now as a
standard. The EISA bus extensions will not be detailed here.</p>

<p>This file is not intended to be a thorough coverage of the
standard. It is for informational purposes only, and is intended
to give designers and hobbyists sufficient information to design
their own XT and AT compatible cards.</p>

<h2>Physical Design:</h2>

<p>ISA cards can be either 8-bit or 16-bit. 8-bit cards only uses
the first 62 pins and 16-bit cards uses all 98 pins. Some 8-bit
cards uses some of the 16-bit extension pins to get more
interrupts.</p>

<h3>8-bit card:</h3>

<p><img src="images/conn_busisa8m.GIF"
alt="62 PIN EDGE CONNECTOR MALE" width="250" height="246"> (At
the card)<br>
<img src="images/conn_busisa8f.GIF"
alt="62 PIN EDGE CONNECTOR FEMALE" width="187" height="65"> (At
the computer)</p>

<h3>16-bit card:</h3>

<p><img src="images/conn_busisa16m.GIF"
alt="62+36 PIN EDGE CONNECTOR MALE" width="378" height="246"> (At
the card)<br>
<img src="images/conn_busisa16f.GIF"
alt="62+36 PIN EDGE CONNECTOR FEMALE" width="290" height="65">
(At the computer)</p>

<h2>Signal Descriptions:</h2>

<h3>+5, -5, +12, -12</h3>

<p>Power supplies. -5 is often not implimented.</p>

<h3>AEN</h3>

<p>Address Enable. This is asserted when a DMAC has control of
the bus. This prevents an I/O device from responding to the I/O
command lines during a DMA transfer. When AEN is active, the DMA
Controller has control of the address bus as the memory and I/O
read/write command lines.</p>

<h3>BALE</h3>

<p>Bus Address Latch Enable. The address bus is latched on the
rising edge of this signal. The address on the SA bus is valid
from the falling edge of BALE to the end of the bus cycle. Memory
devices should latch the LA bus on the falling edge of BALE. Some
references refer to this signal as Buffered Address Latch Enable,
or just Address Latch Enable (ALE). The Buffered-Address Latch
Enable is used to latch SA0-19 on the falling edge. This signal
is forced high during DMA cycles.</p>

<h3>BCLK</h3>

<p>Bus Clock, 33% Duty Cycle. Frequency Varies. 4.77 to 8 MHz
typical. 8.3 MHz is specified as the maximum, but many systems
allow this clock to be set to 12 MHz and higher.</p>

<h3>DACKx</h3>

<p>DMA Acknowledge. The active-low DMA Acknowledge 0 to 3 and 5
to 7 are the corresponding acknowledge signals for DRQ 0-3, 5-7.</p>

<h3>DRQx</h3>

<p>DMA Request. These signals are asynchronous channel requests
used by I/O channel devices to gain DMA service. DMA request
channels 0-3 are for 8-bit data transfer. DAM request channels
5-7 are for 16-bit data transfer. DMA request channel 4 is used
internally on the system board. DMA requests should be held high
until the corresponding DACK line goes active. DMA requests are
serviced in the following priority sequence:<br>
High: DRQ 0, 1, 2, 3, 5, 6, 7 Lowest</p>

<h3>IOCS16</h3>

<p>I/O size 16. Generated by a 16 bit slave when addressed by a
bus master. The active-low I/O Chip Select 16 indicates that the
current transfer is a 1 wait state, 16 bit I/O cycle. Open
Collector.</p>

<h3>I/O CH CK</h3>

<p>Channel Check. A low signal generates an NMI. The NMI signal
can be masked on a PC, externally to the processor (of course).
Bit 7 of port 70(hex) (enable NMI interrupts) and bit 3 of port
61 (hex) (recognition of channel check) must both be set to zero
for an NMI to reach the cpu. The I/O Channel Check is an
active-low signal which indicates that a parity error exists in a
device on the I/O channel.</p>

<h3>I/O CH RDY</h3>

<p>Channel Ready. Setting this low prevents the default ready
timer from timing out. The slave device may then set it high
again when it is ready to end the bus cycle. Holding this line
low for too long (15 microseconds, typical) can prevent RAM
refresh cycles on some systems. This signal is called IOCHRDY
(I/O Channel Ready) by some references. CHRDY and NOWS should not
be used simultaneously. This may cause problems with some bus
controllers. This signal is pulled low by a memory or I/O device
to lengthen memory or I/O read/write cycles. It should only be
held low for a maimum of 2.5 microseconds.</p>

<h3>IOR</h3>

<p>The I/O Read is an active-low signal which instrucs the I/O
device to drive its data onto the data bus, SD0-SD15.</p>

<h3>IOW</h3>

<p>The I/O Write is an active-low signal which instructs the I/O
device to read data from the data bus, SD0-SD15.</p>

<h3>IRQx</h3>

<p>Interrupt Request. IRQ2 has the highest priority. IRQ 10-15
are only available on AT machines, and are higher priority than
IRQ 3-7. The Interrupt Request signals which indicate I/O service
attention. They are prioritized in the following sequence:
Highest IRQ 9(2),10,11,12,14,3,4,5,6,7</p>

<h3>LAxx</h3>

<p>Latchable Address lines. Combine with the lower address lines
to form a 24 bit address space (16 MB) These unlatched address
signals give the system up to 16 MB of address ability. The are
valid when &quot;BALE&quot; is high.</p>

<h3>MASTER</h3>

<p>16 bit bus master. Generated by the ISA bus master when
initiating a bus cycle. This active-low signal is used in
conjuction with a DRQ line by a processor on the I/O channel to
gain control of the system. The I/O processor first issues a DRQ,
and upon recieving the corresponding DACK, the I/O processor may
assert MASTER, which will allow it to control the system address,
data and control lines. This signal should not be assrted for
more than 15 microseconds, or system memory may be corrupted du
to the lack of memory refresh activity.</p>

<h3>MEMCS16</h3>

<p>The active-low Memory Chip Select 16 indicates that the
current data transfer is a 1 wait state, 16 bit data memory
cycle.</p>

<h3>MEMR</h3>

<p>The Memory Read is an active-low signal which instructs memory
devices to drive data onto the data bus SD0-SD15. This signal is
active on all memory read cycles.</p>

<h3>MEMW</h3>

<p>The Memory Write is an active-low signal which instructs
memory devices to store data present on the data bus SD0-SD15.
This signal is active on all memory write cycles.</p>

<h3>NOWS</h3>

<p>No Wait State. Used to shorten the number of wait states
generated by the default ready timer. This causes the bus cycle
to end more quickly, since wait states will not be inserted. Most
systems will ignore NOWS if CHRDY is active (low). However, this
may cause problems with some bus controllers, and both signals
should not be active simultaneously.</p>

<h3>OSC</h3>

<p>Oscillator, 14.31818 MHz, 50% Duty Cycle. Frequency varies.
This was originally divided by 3 to provide the 4.77 MHz cpu
clock of early PCs, and divided by 12 to produce the 1.19 MHz
system clock. Some references have placed this signal as low as 1
MHz (possibly referencing the system clock), but most modern
systems use 14.318 MHz.<br>
This frequency (14.318 MHz) is four times the television
colorburst frequency. Refresh timing on many PC's is based on
OSC/18, or approximately one refresh cycle every 15 microseconds.
Many modern motherboards allow this rate to be changed, which
frees up some bus cycles for use by software, but also can cause
memory errors if the system RAM cannot handle the slower refesh
rates.</p>

<h3>REFRESH</h3>

<p>Refresh. Generated when the refresh logic is bus master. This
active-low signal is used to indicate a memory refresh cycle is
in progress. An ISA device acting as bus master may also use this
signal to initiate a refresh cycle.</p>

<h3>RESET</h3>

<p>This signal goes low when the machine is powered up. Driving
it low will force a system reset. This signal goes high to reset
the system during powerup, low line-voltage or hardware reset.
??????????????</p>

<h3>SA0-SA19</h3>

<p>System Address Lines, tri-state. The System Address lines run
from bit 0 to bit 19. They are latched on to the falling edge of
&quot;BALE&quot;.</p>

<h3>SBHE</h3>

<p>System Bus High Enable, tristate. Indicates a 16 bit data
transfer. The System Bus High Enable indicates high byte transfer
is occuring on the data bus SD8-SD15. This may also indicate an 8
bit transfer using the upper half of the bus data (if an odd
address is present).</p>

<h3>SD0-SD16</h3>

<p>System Data lines, or Standard Data Lines. They are
bidrectional and tri-state. On most systems, the data lines float
high when not driven. These 16 lines provide for data transfer
between the processor, memory and I/O devices.</p>

<h3>SMEMR</h3>

<p>System Memory Read Command line. Indicates a memory read in
the lower 1 MB area. This System Memory Read is an active-low
signal which instructs memory devices to drive data onto the data
bus SD0-SD15. This signal is active only when the memory address
is within the lowest 1MB of memory address space.</p>

<h3>SMEMW</h3>

<p>System Memory Write Commmand line. Indicates a memory write in
the lower 1 MB area. The System Memory Write is an active-low
signal which instructs memory devices to store data preset on the
data bus SD0-SD15. This signal is active only when the memory
address is within the lowest 1MB of memory address space.</p>

<h3>T/C</h3>

<p>Terminal Count. Notifies the cpu that that the last DMA data
transfer operation is complete. Terminal Count provides a pulse
when the terminal count for any DMA channel is reached.</p>

<h2>8 Bit Memory or I/O Transfer Timing Diagram (4 wait states
shown)</h2>

<pre>                  __     __     __    __     __     __     __
BCLK          ___|  |___|  |___|  |__|  |___|  |___|  |___|  |__
                               W1    W2     W3     W4
                      __
BALE          _______|  |_______________________________________



AEN           __________________________________________________

                        ______________________________________
SA0-SA19      ---------&lt;______________________________________&gt;-


              _____________                                _____
Command Line               |______________________________|
(IORC,IOWC,
SMRDC, or SMWTC)
                                                      _____
SD0-SD7       ---------------------------------------&lt;_____&gt;----
(READ)

                        ___________________________________
SD0-SD7       ---------&lt;___________________________________&gt;----
(WRITE)</pre>

<p>Note: W1 through W4 indicate wait cycles.</p>

<p>BALE is placed high, and the address is latched on the SA bus.
The slave device may safely sample the address during the falling
edge of BALE, and the address on the SA bus remains valid until
the end of the transfer cycle. Note that AEN remains low
throughout the entire transfer cycle.</p>

<p>The command line is then pulled low (IORC or IOWC for I/O
commands, SMRDSC or SMWTC for memory commands, read and write
respectively). For write operations, the data remaines on the SD
bus for the remainder of the transfer cycle. For read operations,
the data must be valid on the falling edge of the last cycle.</p>

<p>NOWS is sampled at the midpoint of each wait cycle. If it is
low, the transfer cycle terminates without further wait states.
CHRDY is sampled during the first half of the clock cycle. If it
is low, further wait cycles will be inserted.</p>

<p>The default for 8 bit transfers is 4 wait states. Some
computers allow the number of default wait states to be changed.</p>

<h2>16 Bit Memory or I/O Transfer Timing Diagram (1 wait state
shown)</h2>

<pre>
                  __     __     __    __     __     __
BCLK          ___|  |___|  |___|  |__|  |___|  |___|  |_


AEN [2]       __________________________________________

                      _____________
LA17-LA23     -------&lt;_____________&gt;-[1]-----------------

                             __
BALE          ______________|  |________________________

             ________________                    _______
SBHE                         |__________________|

                              __________________
SA0-SA19      ---------------&lt;__________________&gt;-------

             _________________      ____________________
M16                           |____|
                               *  * [4]

             _________________               ___________
IO16 [3]                      |_____________|
                                        *

              _________________              ___________
Command Line                   |____________|
(IORC,IOWC,
MRDC, or MWTC)
                                          ____
SD0-SD7       ---------------------------&lt;____&gt;---------
(READ)

                                ______________
SD0-SD7       -----------------&lt;______________&gt;---------
(WRITE)</pre>

<p>An asterisk (*) denotes the point where the signal is sampled.</p>

<p>[1] The portion of the address on the LA bus for the NEXT
cycle may now be placed on the bus. This is used so that cards
may begin decoding the address early. Address pipelining must be
active.</p>

<p>[2] AEN remains low throughout the entire transfer cycle,
indicating that a normal (non-DMA) transfer is occuring.</p>

<p>[3] Some bus controllers sample this signal during the same
clock cycle as M16, instead of during the first wait state, as
shown above. In this case, IO16 needs to be pulled low as soon as
the address is decoded, which is before the I/O command lines are
active.</p>

<p>[4] M16 is sampled a second time, in case the adapter card did
not active the signal in time for the first sample (usually
because the memory device is not monitoring the LA bus for early
address information, or is waiting for the falling edge of BALE).</p>

<p>16 bit transfers follow the same basic timing as 8 bit
transfers.A valid address may appear on the LA bus prior to the
beginning of the transfer cycle. Unlike the SA bus, the LA bus is
not latched, and is not valid for the entire transfer cycle (on
most computers). The LA bus should be latched on the falling edge
of BALE. Note that on some systems, the LA bus signals will
follow the same timing as the SA bus. On either type of system, a
valid address is present on the falling edge of BALE.</p>

<p>I/O adapter cards do not need to monitor the LA bus or BALE,
since I/O addresses are always within the address space of the SA
bus.</p>

<p>SBHE will be pulled low by the system board, and the adapter
card must respond with IO16 or M16 at the appropriate time, or
else the transfer will be split into two seperate 8 bit
transfers. Many systems expect IO16 or M16 before the command
lines are valid. This requires that IO16 or M16 be pulled low as
soon as the address is decoded (before it is known whether the
cycle is I/O or Memory). If the system is starting a memory
cycle, it will ignore IO16 (and vice-versa for I/O cycles and
M16).</p>

<p>For read operations, the data is sampled on the rising edge of
the last clock cycle. For write operations, valid data appears on
the bus before the end of the cycle, as shown in the timing
diagram. While the timing diagram indicates that the data needs
to be sampled on the rising clock, on most systems it remains
valid for the entire clock cycle.</p>

<p>The default for 16 bit transfers is 1 wait state. This may be
shortened or lengthened in the same manner as 8 bit transfers,
via NOWS and CHRDY. Many systems only allow 16 bit memory devices
(and not I/O devices) to transfer using 0 wait states (NOWS has
no effect on 16 bit I/O cycles).</p>

<p>SMRDC/SMWTC follow the same timing as MRDC/MWTC respectively
when the address is within the lower 1 MB. If the address is not
within the lower 1 MB boundary, SMRDC/SMWTC will remain high
during the entire cycle.</p>

<p>It is also possible for an 8 bit bus cycle to use the upper
portion of the bus. In this case, the timing will be similar to a
16 bit cycle, but an odd address will be present on the bus. This
means that the bus is transferring 8 bits using the upper data
bits (SD8-SD15).</p>

<h2>Shortening or Lengthening the bus cycle:</h2>

<pre>BCLK       W                 W     W                 W
 _    __    __    __    __    __    __    __    __    __    __    __
  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__|  |__

        |--Transfer 1-----|----Transfer 2---------|----Transfer 3---|

BALE
         __                __                      __                __
________|  |______________|  |____________________|  |______________|


SBHE
_________                                       _______________________
         |__________________|__________________|


SA0-SA19
           _________________  _____________________  _________________
----------&lt;_________________&gt;&lt;_____________________&gt;&lt;_________________&gt;


IO16
___________               ___               ___________________________
           |_____________|   |_____________|
                    *                 *

CHRDY
________________________________        _______________________________
                                |______|
                  *                 *     *  [1]

NOWS
______________________________________________________            _____
                                                      |__________|
                                                        * [2]
IORC
______________           _______                 _______           ____
              |_________|       |_______________|       |_________|


SD0-SD15
                     ____                    ____              ____
--------------------&lt;____&gt;------------------&lt;____&gt;------------&lt;____&gt;---
                       *                       *                 *</pre>

<p>An asterisk (*) denotes the point where the signal is sampled.<br>
W=Wait Cycle</p>

<p>This timing diagram shows three different transfer cycles. The
first is a 16 bit standard I/O read. This is followed by an
almost identical 16 bit I/O read, with one wait state inserted.
The I/O device pulls CHRDY low to indicate that it is not ready
to complete the transfer (see [1]). This inserts a wait cycle,
and CHRDY is again sampled. At this second sample, the I/O device
has completed its operation and released CHRDY, and the bus cycle
now terminates. The third cycle is an 8 bit transfer, which is
shortened to 1 wait state (the default is 4) by the use of NOWS.</p>

<h2>I/O Port Addresses</h2>

<p>Note: Only the first 10 address lines are decoded for I/O
operations. This limits the I/O address space to address 3FF
(hex) and lower. Some systems allow for 16 bit I/O address space,
but may be limited due to some I/O cards only decoding 10 of
these 16 bits.</p>

<table border="1">
    <tr>
        <th>Port (hex)</th>
        <th>Port Assignments</th>
    </tr>
    <tr>
        <td>000-00F</td>
        <td>DMA Controller</td>
    </tr>
    <tr>
        <td>010-01F</td>
        <td>DMA Controller (PS/2)</td>
    </tr>
    <tr>
        <td>020-02F</td>
        <td>Master Programmable Interrupt Controller (PIC)</td>
    </tr>
    <tr>
        <td>030-03F</td>
        <td>Slave PIC</td>
    </tr>
    <tr>
        <td>040-05F</td>
        <td>Programmable Interval Timer (PIT)</td>
    </tr>
    <tr>
        <td>060-06F</td>
        <td>Keyboard Controller</td>
    </tr>
    <tr>
        <td>070-071</td>
        <td>Real Time Clock</td>
    </tr>
    <tr>
        <td>080-083</td>
        <td>DMA Page Register</td>
    </tr>
    <tr>
        <td>090-097</td>
        <td>Programmable Option Select (PS/2)</td>
    </tr>
    <tr>
        <td>0A0-0AF</td>
        <td>PIC #2</td>
    </tr>
    <tr>
        <td>0C0-0CF</td>
        <td>DMAC #2</td>
    </tr>
    <tr>
        <td>0E0-0EF</td>
        <td>reserved</td>
    </tr>
    <tr>
        <td>0F0-0FF</td>
        <td>Math coprocessor, PCJr Disk Controller</td>
    </tr>
    <tr>
        <td>100-10F</td>
        <td>Programmable Option Select (PS/2)</td>
    </tr>
    <tr>
        <td>110-16F</td>
        <td>AVAILABLE</td>
    </tr>
    <tr>
        <td>170-17F</td>
        <td>Hard Drive 1 (AT)</td>
    </tr>
    <tr>
        <td>180-1EF</td>
        <td>AVAILABLE</td>
    </tr>
    <tr>
        <td>1F0-1FF</td>
        <td>Hard Drive 0 (AT)</td>
    </tr>
    <tr>
        <td>200-20F</td>
        <td>Game Adapter</td>
    </tr>
    <tr>
        <td>210-217</td>
        <td>Expansion Card Ports</td>
    </tr>
    <tr>
        <td>220-26F</td>
        <td>AVAILABLE</td>
    </tr>
    <tr>
        <td>278-27F</td>
        <td>Parallel Port 3</td>
    </tr>
    <tr>
        <td>280-2A1</td>
        <td>AVAILABLE</td>
    </tr>
    <tr>
        <td>2A2-2A3</td>
        <td>clock</td>
    </tr>
    <tr>
        <td>2B0-2DF</td>
        <td>EGA/Video</td>
    </tr>
    <tr>
        <td>2E2-2E3</td>
        <td>Data Acquisition Adapter (AT)</td>
    </tr>
    <tr>
        <td>2E8-2EF</td>
        <td>Serial Port COM4</td>
    </tr>
    <tr>
        <td>2F0-2F7</td>
        <td>Reserved</td>
    </tr>
    <tr>
        <td>2F8-2FF</td>
        <td>Serial Port COM2</td>
    </tr>
    <tr>
        <td>300-31F</td>
        <td>Prototype Adapter, Periscope Hardware Debugger</td>
    </tr>
    <tr>
        <td>320-32F</td>
        <td>AVAILABLE</td>
    </tr>
    <tr>
        <td>330-33F</td>
        <td>Reserved for XT/370</td>
    </tr>
    <tr>
        <td>340-35F</td>
        <td>AVAILABLE</td>
    </tr>
    <tr>
        <td>360-36F</td>
        <td>Network</td>
    </tr>
    <tr>
        <td>370-377</td>
        <td>Floppy Disk Controller</td>
    </tr>
    <tr>
        <td>378-37F</td>
        <td>Parallel Port 2</td>
    </tr>
    <tr>
        <td>380-38F</td>
        <td>SDLC Adapter</td>
    </tr>
    <tr>
        <td>390-39F</td>
        <td>Cluster Adapter</td>
    </tr>
    <tr>
        <td>3A0-3AF</td>
        <td>reserved</td>
    </tr>
    <tr>
        <td>3B0-3BF</td>
        <td>Monochome Adapter</td>
    </tr>
    <tr>
        <td>3BC-3BF</td>
        <td>Parallel Port 1</td>
    </tr>
    <tr>
        <td>3C0-3CF</td>
        <td>EGA/VGA</td>
    </tr>
    <tr>
        <td>3D0-3DF</td>
        <td>Color Graphics Adapter</td>
    </tr>
    <tr>
        <td>3E0-3EF</td>
        <td>Serial Port COM3</td>
    </tr>
    <tr>
        <td>3F0-3F7</td>
        <td>Floppy Disk Controller</td>
    </tr>
    <tr>
        <td>3F8-3FF</td>
        <td>Serial Port COM1</td>
    </tr>
</table>

<p>Soundblaster cards usually use I/O ports 220-22F.<br>
Data acquisition cards frequently use 300-31F.</p>

<h2>DMA Read and Write</h2>

<p>The ISA bus uses two DMA controllers (DMAC) cascaded together.
The slave DMAC connects to the master DMAC via DMA channel 4
(channel 0 on the master DMAC). The slave therefore gains control
of the bus through the master DMAC. On the ISA bus, the DMAC is
programmed to use fixed priority (channel 0 always has the
highest priority), which means that channel 0-4 from the slave
have the highest priority (since they connect to the master
channel 0), followed by channels 5-7 (which are channel 1-3 on
the master).</p>

<p>The DMAC can be programmed for read transfers (data is read
from memory and written to the I/O device), write transfers (data
is read from the I/O device and written to memory), or verify
transfers (neither a read or a write - this was used by DMA CH0
for DRAM refresh on early PCs).</p>

<p>Before a DMA transfer can take place, the DMA Controller
(DMAC) must be programmed. This is done by writing the start
address and the number of bytes to transfer (called the transfer
count) and the direction of the transfer to the DMAC. After the
DMAC has been programmed, the device may activate the appropriate
DMA request (DRQx) line.</p>

<h2>Slave DMA Controller</h2>

<table border="1">
    <tr>
        <th>I/O</th>
        <th>Port</th>
    </tr>
    <tr>
        <td>0000</td>
        <td>DMA CH0 Memory Address Register<br>
        Contains the lower 16 bits of the memory address, written
        as two consecutive bytes.</td>
    </tr>
    <tr>
        <td>0001</td>
        <td>DMA CH0 Transfer Count<br>
        Contains the lower 16 bits of the transfer count, written
        as two consecutive bytes.</td>
    </tr>
    <tr>
        <td>0002</td>
        <td>DMA CH1 Memory Address Register</td>
    </tr>
    <tr>
        <td>0003</td>
        <td>DMA CH1 Transfer Count</td>
    </tr>
    <tr>
        <td>0004</td>
        <td>DMA CH2 Memory Address Register</td>
    </tr>
    <tr>
        <td>0005</td>
        <td>DMA CH2 Transfer Count</td>
    </tr>
    <tr>
        <td>0006</td>
        <td>DMA CH3 Memory Address Register</td>
    </tr>
    <tr>
        <td>0007</td>
        <td>DMA CH3 Transfer Count</td>
    </tr>
    <tr>
        <td>0008</td>
        <td>DMAC Status/Control Register<br>
        Status (I/O read) bits 0-3: Terminal Count, CH 0-3<br>
        - bits 4-7: Request CH0-3<br>
        Control (write)<br>
        - bit 0: Mem to mem enable (1 = enabled)<br>
        - bit 1: ch0 address hold enable (1 = enabled)<br>
        - bit 2: controller disable (1 = disabled)<br>
        - bit 3: timing (0 = normal, 1 = compressed)<br>
        - bit 4: priority (0 = fixed, 1 = rotating)<br>
        - bit 5: write selection (0 = late, 1 = extended)<br>
        - bit 6: DRQx sense asserted (0 = high, 1 = low)<br>
        - bit 7: DAKn sense asserted (0 = low, 1 = high)</td>
    </tr>
    <tr>
        <td>0009</td>
        <td>Software DRQn Request<br>
        - bits 0-1: channel select (CH0-3)<br>
        - bit 2: request bit (0 = reset, 1 = set)</td>
    </tr>
    <tr>
        <td>000A</td>
        <td>DMA mask register<br>
        - bits 0-1: channel select (CH0-3)<br>
        - bit 2: mask bit (0 = reset, 1 = set)</td>
    </tr>
    <tr>
        <td>000B</td>
        <td>DMA Mode Register<br>
        - bits 0-1: channel select (CH0-3)<br>
        - bits 2-3: 00 = verify transfer, 01 = write transfer, 10
        = read transfer, 11 = reserved<br>
        - bit 4: Auto init (0 = disabled, 1 = enabled)<br>
        - bit 5: Address (0 = increment, 1 = decrement)<br>
        - bits 6-7: 00 = demand transfer mode, 01 = single
        transfer mode, 10 = block transfer mode, 11 = cascade
        mode</td>
    </tr>
    <tr>
        <td>000C</td>
        <td>DMA Clear Byte Pointer<br>
        Writing to this causes the DMAC to clear the pointer used
        to keep track of 16 bit data transfers into and out of
        the DMAC for hi/low byte sequencing.</td>
    </tr>
    <tr>
        <td>000D</td>
        <td>DMA Master Clear (Hardware Reset)</td>
    </tr>
    <tr>
        <td>000E</td>
        <td>DMA Reset Mask Register - clears the mask register</td>
    </tr>
    <tr>
        <td>000F</td>
        <td>DMA Mask Register<br>
        - bits 0-3: mask bits for CH0-3 (0 = not masked, 1 =
        masked)</td>
    </tr>
    <tr>
        <td>0081</td>
        <td>DMA CH2 Page Register (address bits A16-A23)</td>
    </tr>
    <tr>
        <td>0082</td>
        <td>DMA CH3 Page Register</td>
    </tr>
    <tr>
        <td>0083</td>
        <td>DMA CH1 Page Register</td>
    </tr>
    <tr>
        <td>0087</td>
        <td>DMA CH0 Page Register</td>
    </tr>
    <tr>
        <td>0089</td>
        <td>DMA CH6 Page Register</td>
    </tr>
    <tr>
        <td>008A</td>
        <td>DMA CH7 Page Register</td>
    </tr>
    <tr>
        <td>008B</td>
        <td>DMA CH5 Page Register</td>
    </tr>
</table>

<h2>Master DMA Controller</h2>

<table border="1">
    <tr>
        <th>I/O</th>
        <th>Port</th>
    </tr>
    <tr>
        <td>00C0</td>
        <td>DMA CH4 Memory Address Register<br>
        Contains the lower 16 bits of the memory address, written
        as two consecutive bytes.</td>
    </tr>
    <tr>
        <td>00C2</td>
        <td>DMA CH4 Transfer Count<br>
        Contains the lower 16 bits of the transfer count, written
        as two consecutive bytes.</td>
    </tr>
    <tr>
        <td>00C4</td>
        <td>DMA CH5 Memory Address Register</td>
    </tr>
    <tr>
        <td>00C6</td>
        <td>DMA CH5 Transfer Count</td>
    </tr>
    <tr>
        <td>00C8</td>
        <td>DMA CH6 Memory Address Register</td>
    </tr>
    <tr>
        <td>00CA</td>
        <td>DMA CH6 Transfer Count</td>
    </tr>
    <tr>
        <td>00CC</td>
        <td>DMA CH7 Memory Address Register</td>
    </tr>
    <tr>
        <td>00CE</td>
        <td>DMA CH7 Transfer Count</td>
    </tr>
    <tr>
        <td>00D0</td>
        <td>DMAC Status/Control Register<br>
        Status (I/O read) bits 0-3: Terminal Count, CH 4-7<br>
        - bits 4-7: Request CH4-7<br>
        Control (write)- bit 0: Mem to mem enable (1 = enabled)<br>
        - bit 1: ch0 address hold enable (1 = enabled)<br>
        - bit 2: controller disable (1 = disabled)<br>
        - bit 3: timing (0 = normal, 1 = compressed)<br>
        - bit 4: priority (0 = fixed, 1 = rotating)<br>
        - bit 5: write selection (0 = late, 1 = extended)<br>
        - bit 6: DRQx sense asserted (0 = high, 1 = low)<br>
        - bit 7: DAKn sense asserted (0 = low, 1 = high)</td>
    </tr>
    <tr>
        <td>00D2</td>
        <td>Software DRQn Request<br>
        - bits 0-1: channel select (CH4-7)<br>
        - bit 2: request bit (0 = reset, 1 = set)</td>
    </tr>
    <tr>
        <td>00D4</td>
        <td>DMA mask register<br>
        - bits 0-1: channel select (CH4-7)<br>
        - bit 2: mask bit (0 = reset, 1 = set)</td>
    </tr>
    <tr>
        <td>00D6</td>
        <td>DMA Mode Register<br>
        - bits 0-1: channel select (CH4-7)<br>
        - bits 2-3: 00 = verify transfer, 01 = write transfer, 10
        = read transfer, 11 = reserved<br>
        - bit 4: Auto init (0 = disabled, 1 = enabled)<br>
        - bit 5: Address (0 = increment, 1 = decrement)<br>
        - bits 6-7: 00 = demand transfer mode, 01 = single
        transfer mode, 10 = block transfer mode, 11 = cascade
        mode</td>
    </tr>
    <tr>
        <td>00D8</td>
        <td>DMA Clear Byte Pointer<br>
        Writing to this causes the DMAC to clear the pointer used
        to keep track of 16 bit data transfers into and out of
        the DMAC for hi/low byte sequencing.</td>
    </tr>
    <tr>
        <td>00DA</td>
        <td>DMA Master Clear (Hardware Reset)</td>
    </tr>
    <tr>
        <td>00DC</td>
        <td>DMA Reset Mask Register - clears the mask register</td>
    </tr>
    <tr>
        <td>00DE</td>
        <td>DMA Mask Register<br>
        - bits 0-3: mask bits for CH4-7 (0 = not masked, 1 =
        masked)</td>
    </tr>
</table>

<h2>Single Transfer Mode</h2>

<p>The DMAC is programmed for transfer. The DMA device requests a
transfer by driving the appropriate DRQ line high. The DMAC
responds by asserting AEN and acknowledges the DMA request
through the appropriate DAK line. The I/O and memory command
lines are also asserted. When the DMA device sees the DAK signal,
it drops the DRQ line.</p>

<p>The DMAC places the memory address on the SA bus (at the same
time as the command lines are asserted), and the device either
reads from or writes to memory, depending on the type of
transfer. The transfer count is incrimented, and the address
incrimented/decrimented. DAK is de-asserted. The cpu now once
again has control of the bus, and continues execution until the
I/O device is once again ready for transfer. The DMA device
repeats the procedure, driving DRQ high and waiting for DAK, then
transferring data. This continues for a number of cycles equal to
the transfer count. When this has been completed, the DMAC
signals the cpu that the DMA transfer is complete via the TC
(terminal count) signal.</p>

<pre>
                  __     __     __    __     __     __
BCLK          ___|  |___|  |___|  |__|  |___|  |___|  |___

               _______
DRQx         _|       |___________________________________

                   ______________________________
AEN           ____|                              |________

              _______                             ________
DAKx                 |___________________________|

                      ____________________________
SA0-SA15      -------&lt;____________________________&gt;-------


              ___________                     ____________
Command Line             |___________________|
(IORC, MRDC)
                                     _____________
SD0-SD7       ----------------------&lt;_____________&gt;-------
(READ)

                      ____________________________
SD0-SD7       -------&lt;____________________________&gt;-------
(WRITE)
</pre>

<h2>Block Transfer Mode</h2>

<p>The DMAC is programmed for transfer. The device attempting DMA
transfer drives the appropriate DRQ line high. The motherboard
responds by driving AEN high and DAK low. This indicates that the
DMA device is now the bus master. In response to the DAK signal,
the DMA device drops DRQ. The DMAC places the address for DMA
transfer on the address bus. Both the memory and I/O command
lines are asserted (since DMA involves both an I/O and a memory
device). AEN prevents I/O devices from responding to the I/O
command lines, which would not result in proper operation since
the I/O lines are active, but a memory address is on the address
bus. The data transfer is now done (memory read or write), and
the DMAC incriments/decriments the address and begins another
cycle. This continues for a number of cycles equal to the DMAC
transfer count. When this has been completed, the terminal count
signal (TC) is generated by the DMAC to inform the cpu that the
DMA transfer has been completed.</p>

<p>Note: Block transfer must be used carefully. The bus cannot be
used for other things (like RAM refresh) while block mode
transfers are being done.</p>

<h2>Demand Transfer Mode</h2>

<p>The DMAC is programmed for transfer. The device attempting DMA
transfer drives the appropriate DRQ line high. The motherboard
responds by driving AEN high and DAK low. This indicates that the
DMA device is now the bus master. Unlike single transfer and
block transfer, the DMA device does not drop DRQ in response to
DAK. The DMA device transfers data in the same manner as for
block transfers. The DMAC will continue to generate DMA cycles as
long as the I/O device asserts DRQ. When the I/O device is unable
to continue the transfer (if it no longer had data ready to
transfer, for example), it drops DRQ and the cpu once again has
control of the bus. Control is returned to the DMAC by once again
asserting DRQ. This continues until the terminal count has been
reached, and the TC signal informs the cpu that the transfer has
been completed.</p>

<h2>Interrupts on the ISA bus</h2>

<table border="1">
    <tr>
        <th>Name</th>
        <th>Interrupt</th>
        <th>Description</th>
    </tr>
    <tr>
        <td>NMI</td>
        <td>2</td>
        <td>Parity Error, Mem Refresh</td>
    </tr>
    <tr>
        <td>IRQ0</td>
        <td>8</td>
        <td>8253 Channel 0 (System Timer)</td>
    </tr>
    <tr>
        <td>IRQ1</td>
        <td>9</td>
        <td>Keyboard</td>
    </tr>
    <tr>
        <td>IRQ2</td>
        <td>A</td>
        <td>Cascade from slave PIC</td>
    </tr>
    <tr>
        <td>IRQ3</td>
        <td>B</td>
        <td>COM2</td>
    </tr>
    <tr>
        <td>IRQ4</td>
        <td>C</td>
        <td>COM1</td>
    </tr>
    <tr>
        <td>IRQ5</td>
        <td>D</td>
        <td>LPT2</td>
    </tr>
    <tr>
        <td>IRQ6</td>
        <td>E</td>
        <td>Floppy Drive Controller</td>
    </tr>
    <tr>
        <td>IRQ7</td>
        <td>F</td>
        <td>LPT1</td>
    </tr>
    <tr>
        <td>IRQ8</td>
        <td>F</td>
        <td>Real Time Clock</td>
    </tr>
    <tr>
        <td>IRQ9</td>
        <td>F</td>
        <td>Redirection to IRQ2</td>
    </tr>
    <tr>
        <td>IRQ10</td>
        <td>F</td>
        <td>Reserved</td>
    </tr>
    <tr>
        <td>IRQ11</td>
        <td>F</td>
        <td>Reserved</td>
    </tr>
    <tr>
        <td>IRQ12</td>
        <td>F</td>
        <td>Mouse Interface</td>
    </tr>
    <tr>
        <td>IRQ13</td>
        <td>F</td>
        <td>Coprocessor</td>
    </tr>
    <tr>
        <td>IRQ14</td>
        <td>F</td>
        <td>Hard Drive Controller</td>
    </tr>
    <tr>
        <td>IRQ15</td>
        <td>F</td>
        <td>Reserved</td>
    </tr>
</table>

<p>IRQ0,1,2,8, and 13 are not available on the ISA bus.</p>

<p>The IBM PC and XT had only a single 8259 interrupt controller.
The AT and later machines have a second interrupt controller, and
the two are used in a master/slave combination. IRQ2 and IRQ9 are
the same pin on most ISA systems. Interrupts on most systems may
be either edge triggered or level triggered. The default is
usually edge triggered, and active high (low to high transition).
The interrupt level must be held high until the first interrupt
acknowledge cycle (two interrupt acknowledge bus cycles are
generated in response to an interrupt request).</p>

<p>The software aspects of interrupts and interrupt handlers is
intentionally omitted from this document, due to the numerous
syntactical differences in software tools and the fact that
adequate documentation of this topic is usually provided with
developement software.</p>

<h2>Bus Mastering:</h2>

<p>An ISA device may take control of the bus, but this must be
done with caution. There are no safety mechanisms involved, and
so it is easily possible to crash the entire system by
incorrectly taking control of the bus. For example, most systems
require bus cycles for DRAM refresh. If the ISA bus master does
not relinquish control of the bus or generate its own DRAM
refresh cycles every 15 microseconds, the system RAM can become
corrupted. The ISA adapter card can generate refresh cycles
without relinquishing control of the bus by asserting REFRESH.
MRDC can be then monitored to determine when the refresh cycle
ends.</p>

<p>To take control of the bus, the device first asserts its DRQ
line. The DMAC sends a hold request to the cpu, and when the DMAC
receives a hold acknowledge, it asserts the appropriate DAK line
corresponding to the DRQ line asserted. The device is now the bus
master. AEN is asserted, so if the device wishes to access I/O
devices, it must assert MASTER16 to release AEN. Control of the
bus is returned to the system board by releasing DRQ.</p>

<address>
    <font size="2">Contributor: </font><a
    href="mailto:qtech@mailhost.net"><font size="2">Joakim Ögren</font></a><font
    size="2">, </font><a href="mailto:nikke@ing.umu.se"><font
    size="2">Niklas Edmundsson</font></a> <font size="2">, </font><a
    href="mailto:msokos1@gl.umbc.edu"><font size="2">Mark Sokos</font></a>
    <font size="2">, </font><a
    href="mailto:fxmts205@rz.uni-frankfurt.de"><font size="2">Pieter
    Hollants</font></a> 
</address>

<address>
    <font size="2">Sources:&nbsp;</font><a
    href="http://www.gl.umbc.edu/~msokos1/isa.txt"><font size="2">Mark
    Sokos ISA page</font></a><font size="2"><br>
    Sources:&nbsp;&quot;ISA System Architecture, 3rd
    Edition&quot; by Tom Shanley and Don Anderson ISBN
    0-201-40996-8<br>
    Sources:&nbsp;&quot;Eisa System Architecture, 2nd
    Edition&quot; by Tom Shanley and Don Anderson ISBN
    0-201-40995-X<br>
    Sources:&nbsp;&quot;Microcomputer Busses&quot; by R.M. Cram
    ISBN 0-12-196155-9<br>
    Sources: HelpPC v2.10 Quick Reference Utility, by David
    Jurgens<br>
    Sources:&nbsp;ZIDA 80486 Mother Board User's Manual, OPTi
    486, 82C495sx</font> 
</address>


<address>
    <font size="1">Please send any comments to </font><a
    href="mailto:qtech@mailhost.net"><font size="1">Joakim Ögren</font></a><font
    size="1">.</font> 
</address>

</body>
</html>