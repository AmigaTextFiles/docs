<html><head><title>Ultimate Amiga PS/2 Wheel Mouse Controller</title></head>
<body bgcolor="ffffff" link="ff4040" vlink="ff4040">

<a href="index_ru.html">Оглавление</a>

<h2>Как собрать PS/2 контроллер</h2>

Для начала: с <b>версии 1.4</b> контроллер имеет новую версию схемы - но Вы можете
по-прежнему использовать старую благодаря тому, что прошивка отныне выпускается в двух
вариантах.  Подробное описание каждого из них со схемами и ссылками на прошивки Вы можете
прочитать <a href="version_ru.html">здесь</a>.
<p>

<h2>Список деталей</h2>

Для сборки контроллера Вам потребуется как минимум следующее:

<ul>
<li>PIC16F627 или PIC16F628
<li>Разъём DB-9 &laquo;мама&raquo; - в сторону Амиги
<li>Разъём MiniDIN-6 &laquo;мама&raquo; - в сторону мыши
<li>Немного провода, например МГТФ (или <a href="pcb_ru.html">печатная плата</a>)
</ul>

Если у Вас нет PIC16F62x, или Вы хотите доделать существующий контроллер, собранный на
PIC16F84, и при этом в любом случае не будете использовать двухколёсные мыши и/или
имитацию джойстика в будущих версиях, Вы по-прежнему можете использовать

<ul>
<li>PIC16F84 (PIC16F84A, или даже старый добрый PIC16C84)
<li>4-мегагерцовый кварцевый или керамический резонатор
</ul>

вместо PIC16F62x.  Текущая и все последующие версии прошивки в любом случае будут
поддерживать оба PIC'а.<p>

Если Вам хочется уменьшить затраты на контроллер примерно на 2-3 у.е., Вы можете заменить
флэшовый (многократный) PIC на OTP (One-Time-Programmable - программирующийся один раз)
PIC.  Это может быть один из следующих:  PIC16C554, PIC16C558, PIC16C620, PIC16C621,
PIC16C622 и некоторые другие.  Они дешевле, но Вы не сможете обновлять прошивку - для
этого потребуется менять PIC.  Кроме того, на Амиге на данный момент (июнь 2001) не
существует программатора однократных PIC'ов - Вам придётся &laquo;зашивать&raquo; их
&laquo;на стороне&raquo;.<p>

По желанию Вы можете использовать также и следующее:

<ul>
<li>18-контактная панелька для PIC'а - очень рекомендуется для лёгкого апгрейда PIC'а и его прошивки.  Но Вы можете поставить PIC16F627 прямо сейчас и использовать внутрисхемное программирование.
<li>Два 20-пикофарадных конденсатора - они требуются, если резонатор не запускается или работает на неправильной частоте (и рекомендуются - но в большинстве случаев не нужны)
<li>0.1-микрофарадный блокировочный конденсатор в параллель к мыши - тоже рекомендуется, но не требуется.
<li>2-килоомный резистор - рекомендуется для четырёхкнопочной версии.
<li>Второй разъём DB-9 &laquo;мама&raquo;, если Вы хотите использовать колёсико и дополнительные кнопки.
<li>Корпус(а) для разъёмов DB-9<p>
</ul>

<h2>Программирование PIC'а</h2>

Вы можете запрограммировать PIC на готовом программаторе, или спаять мой простенький <b>devpic</b>.

<ul>
<li><b>В случае программирования PIC'а на готовом программаторе</b>, Вы должны указать
следующие параметры:
<table cellspacing="7">
<tr><td>OSC</td><td>=</td><td>HS</td></tr>
<tr><td>WDT</td><td>=</td><td>ON</td></tr>
</table>
Упомянутые параметры касаются всех пригодных для контроллера PIC'ов, включая однократные -
кроме PIC16F627 и 627.  Если Вы программируете PIC16F627 или 628, необходимо указать:
<table cellspacing="7">
<tr><td>OSC</td><td>=</td><td>INTRC <b>без CLKOUT</b></td></tr>
<tr><td>WDT</td><td>=</td><td>ON</td></tr>
<tr><td>LVP</td><td>=</td><td>OFF</td></tr>
<tr><td>MCLRE</td><td>=</td><td>OFF (digital I/O или что-нибудь в этом роде)</td></tr>
</table>

Остальные параметры не имеют значения.
<p>
<li><b>В случае сборки devpic'а</b>,
<a href="ftp://de.aminet.net/pub/aminet/dev/cross/devpic.lha">слейте его с Аминета</a>
и спаяйте.  Devpic - простенькое устройство на параллельном порту, собранное на одной
микросхеме мелкой логики и нескольких резисторах/диодах.  Одна из полезных возможностей
devpic'а - это внутрисхемное программирование: Вы можете перешивать PIC будущими версиями
прошивки прямо в работающем PS/2 контроллере (но по некоторым причинам Вы должны
отсоединить контроллер от порта джойстика на время перешивки).<p>

<table border cellpadding="10"><tr><td>
Devpic будет прошивать <b>PIC16C84(A)</b> и <b>PIC16F84(A)</b> следующей командой:<p>
<b>picprog ps2m.hex force=16382</b>
</td></tr><tr><td>
Для прошивки <b>PIC16F627</b> и <b>PIC16F628</b> даётся команда:<p>
<b>picprog ps2m.hex force=16212 sf=2</b>
</td></tr></table>&nbsp;<p>

Параметр &laquo;FORCE&raquo; задаёт конфигурационное слово, которое содержит биты
конфигурации типа OSC и WDT (а также LVP и MCLRE для PIC16F62x).  Для этого может
быть использован параметр &laquo;CW&raquo;, но параметр &laquo;FORCE&raquo; также
снимает защиту с PIC'а, если он был защищён.  При обновлении прошивки не используйте ни
тот ни другой параметр вообще - PIC помнит последнее записанное конфигурационное слово.
&laquo;SF&raquo; - это режим &laquo;SmartFlash&raquo;, в котором picprog шьёт новые PIC'и
до пяти раз быстрее, чем PIC16F84.<p>
OSC - это режим генератора (PIC поддерживает как резонаторы, так и RC цепочку), а WDT -
это так называемый &laquo;сторожевой таймер&raquo;, внутреннее устройство PIC'а, которое
автоматически сбрасывает его, если тот завис.  <b>WDT требуется PS/2 контроллеру</b> - он
используется не только в исключительных случаях, но и в самом алгоритме, в частности для
таймаута по ожиданию ответа мыши.  LVP - Low Voltage Programming, низковольтное
программирование - в этом режиме программатору не требуется 12 вольт, но
&laquo;пропадает&raquo; ножка PIC'a RB4.  MLCRE - назначение ножки MCLR, в данном случае
она переключена в режим порта общего назначения (может пригодиться в будущих версиях).
Если Вы не хотите разбираться во всех этих тонкостях - просто используйте строку,
написанную выше.<p>

Если у Вас были проблемы с зашивкой PIC'ов - забудьте про свой старый архив devpic'а,
и попробуйте новый релиз (сейчас 1.6) со схемой версии 3, она более стабильна, чем старая
версия 2.<p>
</ul>

<h2>Сборка контроллера</h2>

Окончательно выберите <a href="version_ru.html">версию схемы</a>, и собирайте её по
приведённым схемам.  Лично я не использую печатную плату - я собрал контроллер прямо в
корпусе разъёма DB-9 (как можно увидеть на <a href="index_ru.html">фотографиях</a> на
заглавной странице этой документации).  Но если Вам так уж хочется печатную плату - есть
<a href="pcb_ru.html">пример дизайна платы</a>, сделанный Marc SAVART [sil51#ifrance.com].
Он разработан для использования на A4000T (также можете посмотреть
<a href="ftp://de.aminet.net/pub/aminet/hard/hack/ps2m_example.lha">архив с фотографиями</a>
готового устройства).  Я не могу дать никакой гарантии корректности разводки этой платы,
но после найденных в предыдущих версиях багов я вручную проверяю каждую версию на
неправильные соединения :-)<p>

<h2>Наладка</h2>

На случай, если собранный контроллер не работает - приведу список возможных ошибок:

<ul>
<li>Несовместимость с Вашей мышью - попробуйте другую
<li>Перегрузка 4-кнопочной версии (например, оптической мышью)
<li>Ошибка в соединениях
<li>Ошибка программирования PIC'а или неверное конфигурационное слово
<li>Плохой резонатор (попробуйте 20-пикофарадные конденсаторы)
</ul>

Если у Вас есть осциллограф - посмотрите сигнал на контактах OSC (не годится для
PIC16F62x).  <a href="version_ru.html">Схемы</a> уже проверены и не содержат ошибок.  Уже
есть десятки человек, которые их успешно собрали.

</body></html>
