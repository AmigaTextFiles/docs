1      REM ************************************************************
2      REM *
3      REM *   Programm Uhrzeit_2
4      REM *   Nach dem Start des Programms kann die Uhrzeit
5      REM *   mit Shift/S gesetzt und mit Shift/T geholt werden.
6      REM *   Shift/4 ($) gibt den Wert der an T1 anliegt aus.
7      REM *   Uhrzeit, Datum und Messwert auch auf LCD.
8      REM *
9      REM ************************************************************
10    XTAL=12000000 :  REM   Quarzfrequenz einstellen
15    TMOD=80
20     GOSUB 9200 :  REM     LCD Display initialisieren
25     GOTO 70
30     INPUT "Uhrzeit (Std,Min,Sek)"STD,MIN,SEK
40     INPUT "Datum (Tag,Mon,Jahr)"TAG,M,JAHR
50     INPUT "Wochentag (Montag=1)"WTAG
60     PRINT  :  PRINT  :  PRINT  :  PRINT 
70     CLOCK 0 : TIME=0 :  ONTIME 1,60000
80     CLOCK 1
100    REM
110   CHAR=GET
120    IF CHAR=0 GOTO 200
130    IF CHAR=84 THEN  PRINT STD,MIN,SEK,WTAG,TAG,M,JAHR
140    IF CHAR=36 THEN  PRINT MESS
150    IF CHAR=83 THEN  INPUT STD,MIN,SEK,WTAG,TAG,M,JAHR
200    GOTO 100
8980   REM
8990   REM         Die folgenden Zeilen sind nur fuer die LCD-Ausgabe
8995   REM
9000   REM----- Kommando -----
9010  XBY(0C000H)=N
9020  XBY(0C001H)=192
9030  XBY(0C001H)=128
9040  XBY(0C001H)=64
9050  XBY(0C001H)=192
9060   RETURN 
9100   REM----- Daten -----
9110  XBY(0C000H)=N
9120  XBY(0C001H)=64
9130  XBY(0C001H)=192
9140   RETURN 
9200   REM----- Init -----
9210  N=38H
9220   GOSUB 9000
9230  N=12
9240   GOSUB 9000
9250  N=1
9260   GOSUB 9000
9290   RETURN 
60000  REM ONTIME INTERRUPT HANDLER
60005 MESS=TIMER1
60007 TIMER1=0
60010 TIME=0
60020  ONTIME 1,60000
60030  GOSUB 61000
60036 N=140 :  GOSUB 9000
60037 MM=INT(MESS/100)
60038 N=48+MM/10 :  GOSUB 9100
60039 N=48+MM-10*INT(MM/10) :  GOSUB 9100
60040 MM=INT(MESS/10)
60041 N=48+MM-10*INT(MM/10) :  GOSUB 9100
60042 N=48+MESS-10*INT(MESS/10) :  GOSUB 9100
60090  RETI 
61000  REM
61010 SEK=SEK+1
61020  IF SEK>59 THEN SEK=0 : MIN=MIN+1
61025 N=134 :  GOSUB 9000
61026 N=48+SEK/10 :  GOSUB 9100
61027 N=48+SEK-10*INT(SEK/10) :  GOSUB 9100
61030  IF MIN>59 THEN MIN=0 : STD=STD+1
61035 N=131 :  GOSUB 9000
61036 N=48+MIN/10 :  GOSUB 9100
61037 N=48+MIN-10*INT(MIN/10) :  GOSUB 9100 : N=58 :  GOSUB 9100
61038 N=128 :  GOSUB 9000
61039 N=48+STD/10 :  GOSUB 9100 : N=48+STD-10*INT(STD/10) :  GOSUB 9100
61040 N=58 :  GOSUB 9100
61041 N=192 :  GOSUB 9000
61042 N=48+TAG/10 :  GOSUB 9100
61043 N=48+TAG-10*INT(TAG/10) :  GOSUB 9100
61044 N=46 :  GOSUB 9100
61045 N=48+M/10 :  GOSUB 9100
61046 N=48+M-10*INT(M/10) :  GOSUB 9100
61047 N=46 :  GOSUB 9100 : N=39 :  GOSUB 9100
61048 N=48+JAHR/10 :  GOSUB 9100 : N=48+JAHR-10*INT(JAHR/10) :  GOSUB 9100
61049  IF STD<24 THEN  RETURN 
61050 STD=0 : WTAG=WTAG+1
61060  IF WTAG>7 THEN WTAG=1
61070 TAG=TAG+1
61080  IF TAG>29.AND.M=2 THEN TAG=1 : M=M+1
61090  IF TAG=29.AND.M=2.AND.(4*INT(JAHR/4)<>JAHR) THEN TAG=1 : M=M+1
61100  IF TAG=31.AND.(M=4.OR.M=6.OR.M=9.OR.M=11) THEN TAG=1 : M=M+1
61110  IF TAG>31 THEN TAG=1 : M=M+1
61120  IF M>12 THEN M=1 : JAHR=JAHR+1
61130  IF JAHR>99 THEN JAHR=0
61200  RETURN 
