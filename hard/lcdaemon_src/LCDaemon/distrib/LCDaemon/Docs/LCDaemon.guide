@DATABASE "lcdaemon"
@master lcdaemon.guide
@$VER:  2.2
@author "Hendrik De Vloed"
@(c) "VOMIT, inc."

@NODE "Main" "LCDaemon Documentation"
@TOC "MAIN"


               @{b}@{u}LCDaemon@{ub}@{uu}     @{i}© 1995-98 VOMIT,inc.@{ui}

               Version 2.3+	source code released under @{"GPL" LINK "GPL"} with these @{"restrictions" LINK "RESTRICTIONS"}.

@{"New in this version" LINK "New"}         For long-time users...

@{"Introduction" LINK "Intro"}                What is all this about?

@{"Requirements" LINK "Requirements"}                What do you need to use a LCDaemon-equipped Amiga.

@{"The hardware" LINK "Hard"}                "Technical" overview of the hardware part.

@{"The software" LINK "Soft"}                How to get any response from the hardware?

@{"Hardware construction" LINK "Build"}       Now build it! (see mumbo-jumbo)

@{"Software development" LINK "Buildsoft"}        How to write your own programs for LCDaemon?

@{"Further developments & fun" LINK "Address"}  The funny part, and the thank-yous.

@{"History" LINK "History/MAIN"}                     So it wasn't bugfree from the start ???

@{"" LINK "MS-Windows NT for Amiga, thank God"}   Borg NT Workstation  --  Disk-space is irrelevant
@{"" LINK "MS-Windows NT for Amiga, thank God"}                            CPU hogging is inevitable
@{"" LINK "MS-Windows NT for Amiga, thank God"}                            Adding memory is futile

@ENDNODE

@NODE "New" "What's new?"

@{b}@{u}Version 2.2:@{uu}@{ub}

    Instead of having several executables, LCDaemon is now one single executable, and the driver-specific part
    has been put into driver libraries. Apart from the obvious distribution advantage, this also facilitates
    adding extra drivers and starting multiple LCDaemon instances.

    The startup options can now be set by either environment variable, icon-tooltype or command-line
    parameter, in that order.

    Multiple instances of LCDaemon can be started. The port names of additional instances are created by suffixing the
    default name by .n, with n being a number from 1 onwards. The first instance keeps the base port-name without
    suffix.

    A memory-map abstraction layer is present, which will be extended to take care of deviating LCD memory models.
    If you are the proud owner of such a display, contact me by E-mail.

    An installer script is provided. This script was crufted together in a short while and should still be
    considered beta. Feel free to enhance it further and mail it back...

@ENDNODE

@NODE "Intro" "Introduction"
@TOC "MAIN"

    LCDaemon is a combined hardware/software project to equip your Amiga with a Liquid Crystal Display.

    Using this display, asynchronous messages can be displayed conveying all kinds of information to the user:

    ·   System load
    ·   Alerts
    ·   Available memory
    ·   Available resources
    ·   Task-specific messages

    The hardware consists of nothing more than a pre-assembled LCD module, available from the local electronic component
    store.

    The software consists of a daemon-like program, presenting a public port to the system. Several utilities are
    included, as well as developer information.

    The total cost for the hardware should be around £20 - £40, depending on what type of display you purchase.
    Compatible displays should have the following @{"characteristics" LINK "Compat"}:

    ·   Hitachi LCD controller chip: HD44780A00 or compatible.
    ·   Up to 4 display lines, although larger displays could be used with an appropriate port driver.
    ·   A character size of 5x7 pixels (5x10 possible, but futile)
    ·   A line length of up to 40 characters.
    ·   With or without backlighting.

    A representation of the LCD is available: @{"click here" ALINK "lcd.iff/main"}. The picture is nearly scale 1:1.
    Actual dimensions are 8.4cm x 4.4cm with a depth of max. 1.6cm. (1cm=0.3937in)

    EBP (I lost your E-mail address, please contact me for proper credits!) sent me these very nice schematics of
    his setup. Note that the wiring diagrams do not imply your display will be wired like this!

    @{"Front view" ALINK "lcd40x2front.iff/main"} ; @{"Back view and wiring" ALINK "lcd40x2back.iff/main"}

@ENDNODE

@NODE "Compat" "Compatible displays"
@TOC "MAIN"

    The display used for the initial development was the Sharp LM16A21. This is a 16-character 2-line display without
    backlighting. The price of this display fluctuated from roughly £20 to £30, depending on the store.

    A Daewoo 2-line 20-characters display is currently built into my A4000.

    For 4-line development, I use a Seiko M4024 40-character 4-line display.

    When you purchase your display, chances are high you'll end up with a Sharp display, since this is a world leader
    in the manufacture of LCDs. Available displays include 16x1, 16x2, 40x1 and 40x2, all available with or without
    backlighting.

@{u}Q@{uu}:  I have found a XYZ1234 display in an old cyclotron on my attic. Can I use that display?

@{b}A@{ub}:  Have a look at the back side of the display. If you can see a chip marked with the number 44780
    the display will be compatible. If the display has more than two lines, you will probably find two of these
    chips.

@ENDNODE

@NODE "Requirements" "Requirements"
@TOC "MAIN"

    To use this project, you will need:

    · On the hardware front:

        - A @{"compatible" LINK "Compat"} LCD display.

        - A male 25-pin D-connector for the parallel port.

        - A piece of 16-wire flatcable

    · On the software front:

        - This software, obviously...

        - Kickstart 2.0 or higher, with a strong preference for Kickstart 3.0+

@ENDNODE

@NODE "Hard" "The hardware"
@TOC "MAIN"
@{b}@{u}The principle of LCD displays@{ub}@{uu}


    The @{i}modus operandi@{ui} of LCDs is based on the polarisation of light and the polarisation-altering effects
    of certain substances.

    Ambient light consists of electromagnetic @{"waves" ALINK "light.iff/main"}. These waves can be considered to
    possess a "wave direction", called polarisation. Waves can have any polarisation direction perpendicular to their
    direction. A three-dimensional @{"figure" ALINK "lightunpol.iff/main"} illustrates this.
    There are certain substances that can filter out a certain wave direction. These substances are called
    polarisers or polarisation filters. Polaroid sunglasses eliminate reflection by filtering out the main polarisation
    component present in light reflected on surfaces. Click @{"here" LINK "lightpol.iff/main"} to view a symbolic
    representation of the effect of a polarisation filter (the vertical lines on the schematic).

    The 'liquid crystal' substances in an LCD have the following properties:

    · At ease, the molecules are ordered horizontally, and have no effect on passing light.

    · When brought into an electric field, the molecules turn gradually.
      They can rotate the polarisation of passing light.

    Using these properties, an LCD is constructed by putting the LC material inbetween two conducting layers and
    applying a voltage. The chemical properties of LC dictate that only AC voltage is acceptable.

    On this @{"figure" LINK "lcdprinc.iff/main"} you can observe a simplified representation of the functioning of an LCD.
    Note that the colours on the figure have nothing to do with the colour of the light, but are a symbol for the
    polarisation of the light, ranging from red (0°) over yellow (45°) to green (90°) and back to red (180°).

    Ambient light (white bar on figure) is fed through a polarisation filter. The angle of this filter is referenced as
    0°. Only light with this polarisation (actually all light, but with its intensity limited on the 0°-axis) is allowed
    to pass through the filter. In the right (inactive) pixel, the light just bounces off the mirror and passes unaltered
    through the filter, to your eye. Resting, the LCD is clear (apart from the  reduction in intensity by filtering out
    half the available light). When a tension is applied, the LC material is twisting the polarisation direction of the
    light. When the light has reached the filter after bouncing off the mirror, and the polarisation has turned 90°, all
    light is filtered out. You see a dark spot.

    Since the amount the LC turns is dependent on the applied voltage, this can be utilized to adjust the contrast.
    To get a dark patch, the light must turn exactly 90° over the distance travelled in the LC.

    It must be clear by now that the generation of the LC voltages is a matter of altering the phase difference of Vbpl
    and Vseg. Unfortunately, on matrix displays there are far too many pixels to drive them one at a time. A complex
    5-level block wave is used while the rows or columns are scanned one at a time. The waveforms involved become far
    too complex to generate conveniently using little electronics.

    This is where chip manufacturers come in. Hitachi has developed a line of chips to produce exactly these waveforms
    and have conveniently interfaced them to the outside world using a 8 or 2*4 bit command set.

    These are the lines available to the developer:

    · Vss and Vdd: the power supply to the LCD and controller.

    Since the chips are constructed using CMOS technology, the power drain is extremely low. In CMOS technology, the
    power dissipation is dependent on the switching frequency since 'all' power loss occurs when both p and n channel
    transistors conduct. This occurs when changing logical state. The Hitachi controller works at a frequency of around
    250kHz, consuming less than 10 mW. A trifle compared to the dissipation of certain modern cooking ovens and stoves,
    like the Pain-tium or MC680[4|6]0.

    A 1988 data sheet for my display reveals a maximum power dissipation of 2.2 mA at 5V. However, a measurement of the
    total current drawn by the LCD (measured in the return feed on the Vss pin for convenience purposes) produces only
    0.35 (rest) to 0.38 (a screen full of symbols) mA. Hitachi must have improved their technology since then. As the
    other inputs are CMOS, no significant power drain should be expected.

    · Vo: the contrast adjustment line.

    The operating instructions suggest connecting a trimmer (adjustable resistor) of 10kOhm between Vdd and Vss and
    connecting Vo to the middle of the trimmer. However, the data sheet reads a typical voltage of 0.65 V for Vo. Since
    a trimmer of 10kOhm would draw 0.5 mA this seems silly. In @{"this design" LINK "Compat"}, Vo has been connected to
    ground. This produces a contrastful display, but involves no readability problems. If your display is badly readable,
    do @{"this" LINK "contrast.iff/main"}.

    · RS: Register Select.

    This line determines whether the data represents actual character codes (RS=1) or control information (RS=0).

    · R/W: Read/not(Write).

    When 0, the display listens to data on the data bus. When 1, the display will put data on the bus.

    Since the LCD will be interfaced to the parallel port, this line is permanently connected to 0 for safety reasons.
    If R/nW was controllable by software and an unexpected situation would occur (e.g. starting a program that fiddles
    with the lines on the parallel port connected to R/W and E) and the parallel port data buffers were set for output,
    this could lead in both the LCD and the Amiga CIA chip trying to put @{"different data on the same lines" LINK "busconflict.iff/main"}.

    Since the CIA has active pull-ups, there is no @{"safe" LINK "nobusconflict.iff/main"} way of interfacing the LCD to
    the parallel port in a bidirectional fashion. The software will deal with this 'problem'.

    · E: Enable.

    A pulse on the E line activates the controller. The controller will pick up data off the bus (or put it on the bus,
    according to R/nW). If your LCD module has two controller chips, each chip's E line is present on the parallel port
    interface.

    · DB0 ... DB7: the data bus.

    This should need no further clarification.
@ENDNODE

@NODE "Soft" "The software"
@TOC "MAIN"
    In order to drive the hardware a suitable driver is needed. Certain electronics magazines have published demonstration
    programs for the PC¹, allowing the user to select options from a menu which perform various actions for the user.
    The one I saw was written in GW-Basic, and relied on its slowness for certain timing issues. Pathetic! :-)

    The Amiga approach has to do better than that. It must really open up the LCD as a shared resource to all other tasks.
    Therefore, the LCDaemon program has the following interesting aspects:

    · A @{"public message port" LINK "mesgport"} to which tasks can send messages. The messages include priority and time
      controls, allowing arbitration to select which messages make it to the LCD in heavy-traffic conditions.
    · An @{"AREXX port" LINK "arexxport"}, allowing programs that are not specifically written for the LCD to benefit from
      an extra display device.
    · Example drivers are included, allowing the LCD to be driven from virtually anything (provided you write the port driver)

    LCDaemon needs some parameters at startup. These are described below. As always, the parameter list can be asked by typing
    a ? as only parameter on the command line.

·   WIDTH or CHARACTERS
    The physical width of your display.
·   HEIGHT or LINES
    The physical height of your display.
·   VIRTUAL or VIRTUALWIDTH
    The modulus (number of bytes on one line in the controller). Only play with this parameter if you get skewed displays.
·   LINESPERCONTROLLER or LPC
    In the case of multiple controllers, this parameter indicates after how many lines a new controller should be addressed.
    Again, this parameter should only be toyed with as a last resource.
·   TASKPRI or TP
    Change the multitasking-priority of the daemon to increase responsiveness. Defaults to 0.
·   DESCENDERS or D (switch)
    If set, characters like j,q,p and so on will use the bottom line of pixels. Some LCD's have a little gap between this
    line and the rest of the matrix, so you may get ugly-looking results when using this switch. Defaults to no descenders.
·   CURSOR or C (switch)
    Activate a blinking cursor on screen. Purely aesthetic. Defaults to my aesthetic level (no cursor) :-)
·   STARTUP
    This field contains a driver-dependent string that is passed to the port-specific driver. For example, the Amiga window
    driver uses this field to set the window's title. The parallel port driver uses this field to optionally select the port
    number (0 or 1). Driver library writers should use this field to pass a driver-specific startup string. This allows
    startup string tunnelling, as depicted in the ficticious example:

    lcd .... CHARACTERS 20 STARTUP "TCPADDRESS 255.255.255.0 WINNUKE" ....

    Note the double-quotes around the driver startup parameters, since it contains spaces.

·   TENDOTS
    This parameters sets the 10-dots-high character mode. Note that this may conflict with programs using programmable
    characters. 

·   QUIET or Q
    Suppresses startup messages.

·   DRIVERLIB
    Selects the driver-specific library to use. The default is the Grand Unified parallel port driver ("lcdgppy.library").
    To test LCDaemon without owning a LCD module, try the lcdwindow.library.

·   CONTRAST
    The default contrast setting to use, if your driver library supports it. Currently no library implements programmable
    contrast for the simple reason that this requires additional ocnnections and/or hardware. This feature was requested
    by Andre Breiler, who will write a driver library for his ABus-project.

·   BACKLIGHT
    The default backlight intensity setting. The comments of CONTRAST apply.

·   MEMMAP
    This is a "patch" option in case your display is "hacked" together by the designers in a non-intuitive way.
    LCDaemon contains a physical-to-logical memory location table to take care of these displays. This parameter selects
    one of several possible table contents. Current possibilities are:
    0 : Intuitive linear mapping with VIRTUALWIDTH modulus in-between lines (default).
    1 : Half-split mapping: your second half line lies VIRTUALWIDTH characters after the first half. Essentially your
        display behaves as it is a WIDTH/2 x HEIGHT*2 intuitively mapped one, with the second line being physically
        placed after the first one. Where did you buy such a atrocity? Russian army stock? Got any plutonium? ;-)
    This option is still beta. Get in touch if it works for you, or if it doesn't.


	These are the driver-specific startup parameters:

    · lcdguppy.library
    The Grand Unified Parallel Port driver attempts to open the Multifacecard 3 and Multifacecard 2 drivers,
    in that order. If none is found, it defaults to the Amiga parallel port. To override this scanning order, use the
    STARTUP parameter. The first letter of the startup field is checked. If a 'P','L' or 'M' is present, the parallel,
    MFC2 or MFC3 (respectively) is selected instead. For the MultifaceCard2, an additional number determines which port
    to use.

    · lcdwindow.library
    This driver emulates the LCD in a window on your Amiga workbench. This way, you can have a look at this software
    without actually building the LCD. To use this driver to its fullest you need Kickstart 3.0 (for its pen allocation
    features) and a workbench with sufficient colours to be able to allocate dark and light green.
    If your display remains blank, try increasing the number of colours of your WB screen.

____________________
¹   Arrogant abbreviation for the Politically Correct @{b}@{u}IBM-compatible@{uu}@{ub} Personal Computer.
@ENDNODE

@NODE "mesgport" "Public Port commands"
@TOC "MAIN"
 @{u}@{b}The public message port "«« LCD rendezvous »»"@{uu}@{ub}

    In @{"lcd.h" ALINK "/programmer/lcd.h/MAIN"} programmers will find all necessary information to drive the LCD through
    use of the public inter-task message port instead of sending AREXX messages. Not only does this relieve REXX of
    processing all those silly string-oriented messages, but it allows finer control of the LCD.

    Doing something to the LCD involves:

    · Allocating the needed structures to allow inter-task communications.
      (Allocating a replyport, a lcdmessage structure, ...)

    · Filling the lcdmessage.lcd_Code field with the command type:

        - LCDMSG_ASKPARAMS: lcdmessage.lcd_Data contains a pointer to a lcdparams structure.
          After successful completion its fields will contain data for the LCD screen used.
          This data is supplied by the user on the command line while starting the daemon.
          This command is implemented to free the user of having to set his/her configuration in each program that
          uses the LCD.

        - LCDMSG_QUEUE: The lcdmessage.lcd_Data contains a STRPTR to a string that has to be displayed.
          To allow the driver to select which messages are important enough to display the lcdmessage.lcd_Priority field
          will determine how important a message is. Use the supplied LCDPRI_ defines to indicate your type of application.
          The user should be given an additional parameter that can be added (positively or negatively) to this amount.
          The user-allowed range should be -10...10, thereby allowing "depth arrangement" of various tasks of the same
          LCDPRI_ type. The lcdmessage.lcd_Ticks is the time in 50ths of a second the message has a chance (according to
          the priority) of being displayed. Note that this command performs intelligent word splitting on space boundaries
          so if you are interested in verbatim display control, perhaps a LCDMSG_ALLOCATEHANDLE is in order?

        - LCDMSG_ALLOCATELCD, LCDMSG_FREELCD and LCDMSG_LCDIRECT: No longer supported as of version 2.0.
          If you're interested in doing lowlevel stuff, you are basically rewriting LCDaemon yourself anyway. If you
          desperately need a feature that can't be done in LCDaemon, send me an E-mail.

        - LCDMSG_ALLOCATEHANDLE: When this command returns without lcdmessage.lcd_Error the lcdmessage.lcd_Data field
          points to a struct lcdscreen (defined in lcd.h). The lcdscreen structure contains the following fields:
          (see also the protection status in lcd.h, indicating which fields are yours to alter and which fields are
          read-only)

            × lcdscreen.version is initialized to LCDaemon"s version of the LCDSCREEN_MINVERSION constant.
              Check for this version against the LCDSCREEN_MINVERSION of your header file and fail if it is smaller.

            × lcdscreen.bufferwidth and lcdscreen.bufferheight are initialized to reflect the screen parameters.
              Note that the bufferwidth variable corresponds to the width of one line of characters in the buffer,
              but does not necessarily correspond to the width of the display. Use the LCDMSG_ASKPARAMS lcdparams.width
              field if you need the actual width.

            × lcdscreen.screenbuffer points to a buffer of (lcdscreen.bufferwidth * lcdscreen.bufferheight) bytes.
              This buffer is yours to write and is double buffered in LCDaemon, so you needn't worry about modifying this
              buffer during its appearance on the LCD. After transmission to LCDaemon and before receiving the reply to
              the message, the buffer may not be altered to avoid race conditions.

          For more information and additional fields, see lcd.h.


        - LCDMSG_UPDATEHANDLE: The lcdmessage.lcd_Data must point to the lcdscreen structure, as returned by
          LCDMSG_ALLOCATEHANDLE. Once a handle has been established, you are free to modify the following fields:

            × lcdscreen.customcharheight indicates the number of bytes per character for the user-programmable characters.
              This should be set to 8, since the currently supported LCDs use this amount.

            × lcdscreen.customcharnum contains the number of programmable characters, each of height
              lcdscreen.customcharheight. The number of custom characters can be chosen arbitrarily, but note that the
              currently supported LCDs have a limit of 8 custom characters. The current screen updating algorithm dumps
              the entire user-character set into the LCD at each context change where different handles with their own
              programmable characters are involved, so it is useful to limit this number to the number of actually used
              programmable characters.

            × lcdscreen.ud_flags must be set to reflect to changes in the above parameters you made since the last
              LCDMSG_UPDATEHANDLE. The value for this field is a logic OR of the flags:

                » LCDUPD_DISPLAY: The contents of the screen buffer have been altered and need to be updated. Updating is
                  done using a smart cacheing algorithm to avoid unnecessary writes to the LCD.

                » LCDUPD_CUSTOMCHARNUM: The number of custom characters needs to be altered. Currently, only a
                  lcdscreen.customcharnum change is allowed, not a lcdscreen.customcharheight change.

                » LCDUPD_CUSTOMCHARDEFS: Either the custom char data or the pointer lcdscreen.customchardefs has changed.

                » LCDUPD_OPTICAL: Either the backlight or contrast setting has changed. See the remarks concerning
                  the BACKLIGHT command line option.

        - LCDMSG_FREEHANDLE: This deallocates all storage allocated by the LCDMSG_ALLOCATEHANDLE call. The
          lcdmessage.lcd_Data must contain the pointer to the lcdscreen structure, as returned by a successful
          LCDMSG_ALLOCATE call. The screen buffer is deallocated as well, since it was allocated by LCDaemon. The custom
          char data however, is the property of the application and will not be deallocated.

@ENDNODE

@NODE "arexxport" "AREXX Port commands"
@TOC "MAIN"
 @{u}@{b}The Arexx message port "LCDAEMON"@{uu}@{ub}

    This port currently supports four commands:
    Parameters in [square brackets] are optional.

    · LCDMESSAGE [time t] [pri p] text

    An 'echo' equivalent. Maps to the @{"LCDMSG_QUEUE" LINK "mesgport" 24} command on the @{"public port" LINK "mesgport"}.

    · CLEARREXXMESSAGES

    All messages sent to LCDaemon via the AREXX port are cancelled. This allows an AREXX script to send a message with an
    "infinite" time while doing CPU-intensive stuff and then cancel it when it is completed. Thus you can e.g. switch off
    your monitor during 3D rendering and get notified when rendering is completed.

    · GETCHARACTERS
    · GETLINES

    After completion, the Result variable contains the parameters of the LCD at startup. Similar to @{"LCDMSG_ASKPARAMS" LINK "mesgport" 16}.
    Do not forget to issue the OPTIONS RESULTS Arexx command to allow the Result variable to be filled!

@ENDNODE
@NODE "Build" "Building the display"
@TOC "MAIN"
    
    @{b}The author takes no responsibility whatsoever for what could happen to you, your computer, the LCD or anything
    connected to your computer by any physical (liquid, gaseous, solid, energy) connection, even if this document contains
    blatant lies.@{ub}

    This means, if you blow up your local nuclear plant after printing the word "Tschernobyl" on the LCD, or your cat drops
    dead after watching a little pixel mouse dance and make obscene gestures¹, I am not to blame. The only insurance this
    document is not a really great April 1 joke intended to increase the Comm... er Escom... er Viscorp er... Gateway Amiga(*)
    sale and 2nd-hand fried part market is the current date.

    Make sure you get a data sheet for @{i}your @{ui}LCD and verify these pinouts. Furthermore, check you have tied these to
    the correct parallel port pins before plugging it in! (see p. 319 Hardware Reference Manual 3rd Ed.)

    The Sharp LM16X21A and compatibles have the following pin layout:

1   Vss :   Connect to GND of parallel port (pins 18-22)
2   Vdd :   Connect to +5V  (pin 14 on Amiga parallel ports)²
3   Vo:     Contrast. Either use @{"an adjustable resistor" LINK "contrast.iff/MAIN"} or tie to GND.
4   RS@{u}:@{uu}     Register Select: tie to POUT (pin 12)
5   R/W:    Read/notWrite: ALWAYS tie to GND!!! If you read from the
            LCD the LCD will try to put data on the parallel port
            while the port is configured as output! This will probably
            result in @{"blowing your LCD" LINK "busconflict.iff/MAIN"} (or even your CIA)³.
6   E:      Enable: tie to BUSY (pin 11). For a second controller's E line use SEL (pin 13).
7 \\
.  \\
.   DB:    Data bus: tie to data lines of parallel port (pins 2 to 9).
.  /
14/


    If you have a backlit LCD you'll have to connect the Vled and Vss lines to a @{b}@{u}separate@{uu}@{ub}² 5 V power supply.

____________________
* "Amiga" is a registered trademark of this week's volunteer of owning the Amiga(*) trademarks.

¹ Possible as of version 1.6.

² Make sure that you don't draw too much current. The port should be able to handle the 1 to 10 mA required for the LCD. When
  you use a backlit LCD, the hundreds of mA to illuminate it will have to be supplied by some other means!
³ See @{" a picture " LINK "busconflict.iff/MAIN"} of the problem. The LCD is a fragile CMOS IC so it will probably blow first
  and act as a very expensive fuse :). For more info, read @{"here" LINK "Hard" 95}.

@ENDNODE

@NODE "Buildsoft" "Writing display programs"
@TOC "MAIN"
    All programmer information can be found in the @{"Public" LINK "mesgport"} and @{"Arexx" LINK "arexxport"} sections.

    Please keep in mind that your programs will always be struggling to get information on the LCD since they will be
    competing for time. Be sure to check return codes (lcd_Error field) of your messages. Certain error messages might need
    some further clarification:

    · LCDERR_UNKNOWN: The lcd_Code is unknown. Nothing has happened. Maybe you could prompt the user to upgrade to a more
      recent driver that supports the violating LCDCMD command if you really need the command you just sent.

    · LCDERR_TOOBUSY: This can occur in various situations, for example when the message could not be queued because
      the LCDaemon is shutting down.

    · LCDERR_YOURFAULT: You forgot to initialize fields or initialized them to gibberish values. Naughty boy! Trying to
      defeat the Amiga's memory protec... er... forget it. :-/

    @{b}Please please please CHECK and RESPECT return codes!@{ub}

    As always for a public message port, send messages to it through the SafePutToPort() function, which disables
    multitasking, checks for the existance of the port, sends the message and enables multitasking. This ensures
    that the port didn't close under your very nose while you were about to send a message to it. This function
    can be found in the @{"example programs" LINK "/Programmer/lcdecho/lcdecho.c/MAIN" 18}

    For ARexx programs: don't forget to use the command
    @{b}OPTIONS RESULTS@{ub}
    before using commands that are supposed to return something, like `getcharacters' or `getlines'!

    If you want to support arcane hardware connections to your LCD display, e.g. 4-bit shift registers or I2C
    interfaces; you'll have to write a driver. Although the main LCDaemon is written in C++, the interface functions
    are deliberately declared als C-style. Have a look at the Grand Unified Parallel Port driver library
    @{"guppy.c" link "/Programmer/Driver/Guppy/guppy.c/main"} to see the callback functions being implemented.

    · AllocLCD

    Tries to allocate the driver. In addition to the parameters indicating the physical configuration of the LCD,
    the startup string and a pointer to a struct timerequest. If successful, this function returns a handle to
    driver-specific information, which will be passed to each member function. If initialization failed, returns NULL.

    · FreeLCD

    Frees everything allocated by AllocLCD. This function is called even if lcd_alloc() fails, in order to be able
    to undo partial allocations.

    · LCDDelayFor

    The timerequest passed to AllocLCD can be used to implement the delays necessary to meet your LCD timing
    restrictions. A LCDDelayFor instruction needs to be implemented to wait for the specified number of microseconds.
    You can just copy this function from Guppy.c, unless your driver needs different timing restrictions.

    · LCDPutChar

    This function implements the actual data transmission. The 8-bit code needs to be transmitted to the LCD.
    If the boolean parameter "isdata" is TRUE, the data is a control code, which needs to be transmitted with RS=1.
    Otherwise it is just display or character data, with RS=0. The delay is the minimum delay you need to wait while the
    transmission is being processed in your LCD. The final parameter is an ULONG containing a mask indicating for which
    controller the message is intended. Multiple destinations are possible! Note this is a @{b}bitfield@{ub}, not a number.
    Controller 0 corresponds to bit 0, and so on.

    · LCDPreMessage / LCDPostMessage

    Before and after data transfer sequences these functions are called. These callbacks are added upon special
    request by a user but should not generally be needed.

    · LCDDriverName

    If driver allocation was successful, this functions returns a STRPTR to the name of the driver, as to be reported to
    the user. Otherwise it returns NULL.

    · LCDVisual

    Called if any optical parameter changes.

    · LCDMethod

    This function is called to obtain various minor services. The most important of them is the verification of the
    library version. See include/LCDDriverMethod.h for details.


@ENDNODE
@NODE "Address" "How to get further development done"
@TOC "MAIN"

@{b}@{i}@{u}Please read this! It's not boring, like all those other discaimers! @{uu}@{ui}

    I'm not begging for money like all other PD authors! ;-)@{ub}


    Nowadays, most software written seems to bear the shareware label. No matter how insignificant or futile
the utility, the user is given a moral obligation to pay a certain amount. In the end, this means that
--- to be at "moral ease" --- the average user should fork out hundreds of pounds before a decent working environment
can be obtained. So far for the "spirit" of the Amiga community. I've seen that spirit elsewhere, and it's called
greed.

    Fortunately, most shareware programs are fully functional. Combined with the fact that the average user doesn't really
have an urge to pay money for an utility they use once in a while this has led to horrible contraptions like "crippleware".

    Several Amiga users --- including myself --- have adopted a "What? Crippleware? del¹ *.lha!"-attitude towards this
pathetic attempt to abuse Aminet and other data carriers for free publicity. For this is exactly what crippleware is: a
program, totally made useless on purpose, is put on Aminet in the hope that the user will pay the amount to buy it in order
to get to actually work with it. No "if you use it intensely" underlying idea like shareware, just free abuse of Aminet
to make publicity and distribute the software.

    What's worse: some shareware authors have descended to using "threat": I have heard that in my (registered) copy of Spot
there is embedded program code to do harm if a tampered keyfile is detected. Have they gone totally mad??? I fear for the
day that Reorg messes up my personal keyfile, thereby triggering Spot into who-knows-what frenzy! In ArcHandler's guide I
read a similar thing: "del¹ ArcHandler.lha" was my spontaneous reaction. In one part of the doc file the authors dismiss
all responsibilities for misbehaviour of their programs, in the other they state without remorse their programs have been
programmed to do nasty things. Do I qualify for Safe Hex International's "Give us names of virus programmers" reward? ;-)

    One sad day some program's history file will contain the following lines:

@{i}Revision 3 : Fixed small bug in ARexx port code
             Fixed accidental formatting of HD due to bug in
             keyfile protection code. (sorry, registered users!)
             Fixed windo^%$#° Þ®©¥º®@{ui}
<file ends due to author killed in stampede of enraged ß-testers>

    I bought Meeting Pearls III, and found a crippleware port of the shareware UN?X program XV. Huh? Asking money
($10 for ONE update) for porting someone else's shareware? What are we supposed to do? Register TWICE??? I sure hope you
don't get into trouble with the original author, Terje!

    In my naive opinion, computer hobbyists should be exactly that, otherwise they should get a real job and work for
firms like Microsoft or write PClone software. I write soft- and hardware all day too, and I've put a lot of my spare time
into LCDaemon. But you don't read me extorting other fellow Amigans...

    As you might have guesed by now, LCDaemon is...

    @{b}@{u}@{i}freeware!@{ui}@{uu}@{ub} (hurrah! ;-) )

    That doesn't mean you can include this into other products, though! If you want to use this commercially, contact me.
If you want to use this project in a magazine or on a coverdisk, the "price" is 1 year's subscription starting from the
issue the project appears in. Basically, if you make money with it, I want to make sure you don't gain too much off of
my back.

    CD-ROM distribution is only allowed on CD-ROMs that satisfy 1 or more of the following:

·   The name is "Aminet" (Thanks, Urban, great job!)
·   The name contains "Fish" (great job, Fred!)
·   The name contains "Meeting Pearls" (Yes, Angela, the same applies to you).
·   The CD sells for <= £15, DM25 or equivalent.

    This archive may be carried anywhere as long as no alteration is made, not even adding file_id.diz or other junk.

    A PD disk with this archive cannot be sold for more than £1 or equivalent.

@{u}@{b}And now something for YOU:@{ub}@{uu}

    The only thing you, average fanatic Amiga user, could do for me is sending me a postcard or Email stating
why you (dis)like the program, what could be done or what bugs you found.

If you don't have the courage to get out of bed and drop a piece of paper in the mailbox, consider this program my tiny
attempt to reward all other Amiga PD authors for their excellent work in thwarting the Gates of Hell.

     Hendrik De Vloed
        VOMIT, inc.

       Pontstraat 22
       B-9090 Melle
       Belgium, man, Belgium!²

E-mail: hendrik.devloed@barco.com

@{b}Thanks@{ub}
So far, I have received E-mail from about forty people who are interested in building a display or have already built it.
Please get in touch if you want features! The programmable character support wouldn't have been implemented if I didn't
know someone was waiting for it! Since the current driver fulfills all my needs, it is now up to you to give me input for
the features you want!

____________________
¹   I use CShell :)
²   © Z. Beeblebrox
@ENDNODE

@NODE "GPL" "GNU Public License"
@TOC "MAIN"
		    GNU GENERAL PUBLIC LICENSE
		       Version 2, June 1991

 Copyright (C) 1989, 1991 Free Software Foundation, Inc.
                       59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 Everyone is permitted to copy and distribute verbatim copies
 of this license document, but changing it is not allowed.

			    Preamble

  The licenses for most software are designed to take away your
freedom to share and change it.  By contrast, the GNU General Public
License is intended to guarantee your freedom to share and change free
software--to make sure the software is free for all its users.  This
General Public License applies to most of the Free Software
Foundation's software and to any other program whose authors commit to
using it.  (Some other Free Software Foundation software is covered by
the GNU Library General Public License instead.)  You can apply it to
your programs, too.

  When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
this service if you wish), that you receive source code or can get it
if you want it, that you can change the software or use pieces of it
in new free programs; and that you know you can do these things.

  To protect your rights, we need to make restrictions that forbid
anyone to deny you these rights or to ask you to surrender the rights.
These restrictions translate to certain responsibilities for you if you
distribute copies of the software, or if you modify it.

  For example, if you distribute copies of such a program, whether
gratis or for a fee, you must give the recipients all the rights that
you have.  You must make sure that they, too, receive or can get the
source code.  And you must show them these terms so they know their
rights.

  We protect your rights with two steps: (1) copyright the software, and
(2) offer you this license which gives you legal permission to copy,
distribute and/or modify the software.

  Also, for each author's protection and ours, we want to make certain
that everyone understands that there is no warranty for this free
software.  If the software is modified by someone else and passed on, we
want its recipients to know that what they have is not the original, so
that any problems introduced by others will not reflect on the original
authors' reputations.

  Finally, any free program is threatened constantly by software
patents.  We wish to avoid the danger that redistributors of a free
program will individually obtain patent licenses, in effect making the
program proprietary.  To prevent this, we have made it clear that any
patent must be licensed for everyone's free use or not licensed at all.

  The precise terms and conditions for copying, distribution and
modification follow.

		    GNU GENERAL PUBLIC LICENSE
   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION

  0. This License applies to any program or other work which contains
a notice placed by the copyright holder saying it may be distributed
under the terms of this General Public License.  The "Program", below,
refers to any such program or work, and a "work based on the Program"
means either the Program or any derivative work under copyright law:
that is to say, a work containing the Program or a portion of it,
either verbatim or with modifications and/or translated into another
language.  (Hereinafter, translation is included without limitation in
the term "modification".)  Each licensee is addressed as "you".

Activities other than copying, distribution and modification are not
covered by this License; they are outside its scope.  The act of
running the Program is not restricted, and the output from the Program
is covered only if its contents constitute a work based on the
Program (independent of having been made by running the Program).
Whether that is true depends on what the Program does.

  1. You may copy and distribute verbatim copies of the Program's
source code as you receive it, in any medium, provided that you
conspicuously and appropriately publish on each copy an appropriate
copyright notice and disclaimer of warranty; keep intact all the
notices that refer to this License and to the absence of any warranty;
and give any other recipients of the Program a copy of this License
along with the Program.

You may charge a fee for the physical act of transferring a copy, and
you may at your option offer warranty protection in exchange for a fee.

  2. You may modify your copy or copies of the Program or any portion
of it, thus forming a work based on the Program, and copy and
distribute such modifications or work under the terms of Section 1
above, provided that you also meet all of these conditions:

    a) You must cause the modified files to carry prominent notices
    stating that you changed the files and the date of any change.

    b) You must cause any work that you distribute or publish, that in
    whole or in part contains or is derived from the Program or any
    part thereof, to be licensed as a whole at no charge to all third
    parties under the terms of this License.

    c) If the modified program normally reads commands interactively
    when run, you must cause it, when started running for such
    interactive use in the most ordinary way, to print or display an
    announcement including an appropriate copyright notice and a
    notice that there is no warranty (or else, saying that you provide
    a warranty) and that users may redistribute the program under
    these conditions, and telling the user how to view a copy of this
    License.  (Exception: if the Program itself is interactive but
    does not normally print such an announcement, your work based on
    the Program is not required to print an announcement.)

These requirements apply to the modified work as a whole.  If
identifiable sections of that work are not derived from the Program,
and can be reasonably considered independent and separate works in
themselves, then this License, and its terms, do not apply to those
sections when you distribute them as separate works.  But when you
distribute the same sections as part of a whole which is a work based
on the Program, the distribution of the whole must be on the terms of
this License, whose permissions for other licensees extend to the
entire whole, and thus to each and every part regardless of who wrote it.

Thus, it is not the intent of this section to claim rights or contest
your rights to work written entirely by you; rather, the intent is to
exercise the right to control the distribution of derivative or
collective works based on the Program.

In addition, mere aggregation of another work not based on the Program
with the Program (or with a work based on the Program) on a volume of
a storage or distribution medium does not bring the other work under
the scope of this License.

  3. You may copy and distribute the Program (or a work based on it,
under Section 2) in object code or executable form under the terms of
Sections 1 and 2 above provided that you also do one of the following:

    a) Accompany it with the complete corresponding machine-readable
    source code, which must be distributed under the terms of Sections
    1 and 2 above on a medium customarily used for software interchange; or,

    b) Accompany it with a written offer, valid for at least three
    years, to give any third party, for a charge no more than your
    cost of physically performing source distribution, a complete
    machine-readable copy of the corresponding source code, to be
    distributed under the terms of Sections 1 and 2 above on a medium
    customarily used for software interchange; or,

    c) Accompany it with the information you received as to the offer
    to distribute corresponding source code.  (This alternative is
    allowed only for noncommercial distribution and only if you
    received the program in object code or executable form with such
    an offer, in accord with Subsection b above.)

The source code for a work means the preferred form of the work for
making modifications to it.  For an executable work, complete source
code means all the source code for all modules it contains, plus any
associated interface definition files, plus the scripts used to
control compilation and installation of the executable.  However, as a
special exception, the source code distributed need not include
anything that is normally distributed (in either source or binary
form) with the major components (compiler, kernel, and so on) of the
operating system on which the executable runs, unless that component
itself accompanies the executable.

If distribution of executable or object code is made by offering
access to copy from a designated place, then offering equivalent
access to copy the source code from the same place counts as
distribution of the source code, even though third parties are not
compelled to copy the source along with the object code.

  4. You may not copy, modify, sublicense, or distribute the Program
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense or distribute the Program is
void, and will automatically terminate your rights under this License.
However, parties who have received copies, or rights, from you under
this License will not have their licenses terminated so long as such
parties remain in full compliance.

  5. You are not required to accept this License, since you have not
signed it.  However, nothing else grants you permission to modify or
distribute the Program or its derivative works.  These actions are
prohibited by law if you do not accept this License.  Therefore, by
modifying or distributing the Program (or any work based on the
Program), you indicate your acceptance of this License to do so, and
all its terms and conditions for copying, distributing or modifying
the Program or works based on it.

  6. Each time you redistribute the Program (or any work based on the
Program), the recipient automatically receives a license from the
original licensor to copy, distribute or modify the Program subject to
these terms and conditions.  You may not impose any further
restrictions on the recipients' exercise of the rights granted herein.
You are not responsible for enforcing compliance by third parties to
this License.

  7. If, as a consequence of a court judgment or allegation of patent
infringement or for any other reason (not limited to patent issues),
conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot
distribute so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you
may not distribute the Program at all.  For example, if a patent
license would not permit royalty-free redistribution of the Program by
all those who receive copies directly or indirectly through you, then
the only way you could satisfy both it and this License would be to
refrain entirely from distribution of the Program.

If any portion of this section is held invalid or unenforceable under
any particular circumstance, the balance of the section is intended to
apply and the section as a whole is intended to apply in other
circumstances.

It is not the purpose of this section to induce you to infringe any
patents or other property right claims or to contest validity of any
such claims; this section has the sole purpose of protecting the
integrity of the free software distribution system, which is
implemented by public license practices.  Many people have made
generous contributions to the wide range of software distributed
through that system in reliance on consistent application of that
system; it is up to the author/donor to decide if he or she is willing
to distribute software through any other system and a licensee cannot
impose that choice.

This section is intended to make thoroughly clear what is believed to
be a consequence of the rest of this License.

  8. If the distribution and/or use of the Program is restricted in
certain countries either by patents or by copyrighted interfaces, the
original copyright holder who places the Program under this License
may add an explicit geographical distribution limitation excluding
those countries, so that distribution is permitted only in or among
countries not thus excluded.  In such case, this License incorporates
the limitation as if written in the body of this License.

  9. The Free Software Foundation may publish revised and/or new versions
of the General Public License from time to time.  Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.

Each version is given a distinguishing version number.  If the Program
specifies a version number of this License which applies to it and "any
later version", you have the option of following the terms and conditions
either of that version or of any later version published by the Free
Software Foundation.  If the Program does not specify a version number of
this License, you may choose any version ever published by the Free Software
Foundation.

  10. If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author
to ask for permission.  For software which is copyrighted by the Free
Software Foundation, write to the Free Software Foundation; we sometimes
make exceptions for this.  Our decision will be guided by the two goals
of preserving the free status of all derivatives of our free software and
of promoting the sharing and reuse of software generally.

			    NO WARRANTY

  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
REPAIR OR CORRECTION.

  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.

		     END OF TERMS AND CONDITIONS

	    How to Apply These Terms to Your New Programs

  If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these terms.

  To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
convey the exclusion of warranty; and each file should have at least
the "copyright" line and a pointer to where the full notice is found.

    <one line to give the program's name and a brief idea of what it does.>
    Copyright (C) 19yy  <name of author>

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA


Also add information on how to contact you by electronic and paper mail.

If the program is interactive, make it output a short notice like this
when it starts in an interactive mode:

    Gnomovision version 69, Copyright (C) 19yy name of author
    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
    This is free software, and you are welcome to redistribute it
    under certain conditions; type `show c' for details.

The hypothetical commands `show w' and `show c' should show the appropriate
parts of the General Public License.  Of course, the commands you use may
be called something other than `show w' and `show c'; they could even be
mouse-clicks or menu items--whatever suits your program.

You should also get your employer (if you work as a programmer) or your
school, if any, to sign a "copyright disclaimer" for the program, if
necessary.  Here is a sample; alter the names:

  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
  `Gnomovision' (which makes passes at compilers) written by James Hacker.

  <signature of Ty Coon>, 1 April 1989
  Ty Coon, President of Vice

This General Public License does not permit incorporating your program into
proprietary programs.  If your program is a subroutine library, you may
consider it more useful to permit linking proprietary applications with the
library.  If this is what you want to do, use the GNU Library General
Public License instead of this License.

@ENDNODE

@NODE "RESTRICTIONS" "Restrictions on source code"
@TOC "MAIN"

	Due to a chronic lack of time to fix some other people's outstanding issues - and the fact that LCDaemon fulfills
	all MY needs, I have decided to release the source under the Gnu Public License.

	In practice, this means that anyone is allowed to make modifications, as long as the source code is
	again re-released under GPL.

	Note that I've not left Amiga or anything, so don't worry. I'll be still around to make small
	modifications and/or enhancements. It's just that if you want support for some exotic controller you have
	you should be able to add it yourself. That way debugging should be straightforward.

	I kindly ask that you then mail any modifications back to me instead of
	just releasing "renegade" versions on Aminet. Not because I want to harass volunteer coauthors, but just
	to try to keep various version from diverging into different directions.

	Of course the (C) notices should be left intact, except to add your own.

	The sources should be compiled with Maxon or Hisoft C++. I use MaxonDevelop 4.0 PRO, which includes
	the EasyObjects C++ classes. These classes are copyrighted, and therefore should not be included in
	subsequent distributions. I you haven't got these compilers, I suggest you contact me and explain what
	you have and what you want to accomplish. I'm sure we can work something out - nudge,nudge,wink,wink - ;-)
	I could for example mail you info on how to rewrite the missing classes.

	The makefiles make the distribution archive from the compilation directory or
	copy various files into the right places. they should be run under CShell >=5.50
	(which can be found on Aminet). Then load the .project file in Maxon C++, after having edited
	it to correct the path names.

	I use header files to speed up compilation. These are not included due to their size, but
	you can either easily recreate them (Menu project/Individual Project Settings/headers/write header file)
	or switch them off ( ... /no headers). Note that I compile LCDaemon.header just once, in
	LCDaemon.cpp and then reuse it for all other .cpp files.

	If you need info on the operation of the program, mail @{"me" LINK "Address"}.

	Owners of exotic controllers should have a look at MemMap.cpp where the translation
	layer between screen coordinates and hardware controller coordinates resides.

	Hendrik De Vloed
	15-Aug-98
	
@ENDNODE
