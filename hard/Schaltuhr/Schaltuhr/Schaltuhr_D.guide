@database 680fc858-0
@master //Distribution/Schaltuhr/Schaltuhr_D.guide
@$VER: 1.0
@remark Created with Heddley v1.1 (c) Edd Dumbill 1994

@node "Main" ""
                              @{u}@{fg shine}Schaltuhr-Guide@{uu}@{fg text}

                          (c) 1997 Andreas Börner


 @{"Disclaimer               " link "disclaimer" 0} - Bitte zuerst lesen!

 @{"Einführung               " link "einführung" 0} - Die Idee...
 @{"Hardware                 " link "hardware" 0} - Benötigte Komponenten für den Aufbau
 @{"Aufbau                   " link "aufbau" 0} - der Zusammenbau
 @{"Software                 " link "software" 0} - Das Schaltuhr-Programm
 @{"Technische Infos/Probleme" link "hacks" 0} - WICHTIG!
 @{"Autor                    " link "autor" 0} - Vorschläge, etc.
@endnode

@node "disclaimer" "Disclaimer"
                              @{fg shine}- Disclaimer -@{fg text}

 Der Nachbau und Betrieb der in diesem Dokument beschriebenen Hardware
 geschieht @{u}ausschließlich auf eigenes Risiko@{uu}. Ebenso bin ich nicht
 verantwortlich für Fehler jeglicher Art, die das Programm Schaltuhr
 verursacht.

 Für den Einbau der Schaltung sollte man zumindest ein klein wenig
 technisches Verständnis und Geschick mitbringen, schließlich wird die
 Schaltuhr am 220V-Netz betrieben. Wer also nicht weiß, wo sich die heiße
 Seite des Lötkolbens befindet, sollte lieber die Finger davon lassen!

 Diese Beschreibung und das Programm 'Schaltuhr' sind Freeware. Das Archiv
 darf nur komplett und unverändert weitergegeben werden.

 Dieses Archiv darf auf jeglichen Medien frei verbreitet werden, solange
 keine Gewinne damit erzielt werden.

 Das Archiv darf ohne meine Genehmigung nicht kommerziell verbreitet
 werden. Fred Fish und das Aminet haben meine ausdrückliche Erlaubnis, das
 Programm auf ihren Datenträgern zu verbreiten.
@endnode

@node "einführung" "Einführung               "
                              @{fg shine}- Einführung -@{fg text}

 Diese Schaltung ist eigentlich sehr simpel, erfüllt ihren Zweck  aber
 ausgezeichnet.

 Das Grundprinzip besteht darin, daß ein Rechner mit der Schaltuhr
 eingeschaltet wird, bestimmte Aufgaben durchführt und erst/genau dann
 wieder ausgeschaltet wird, wenn er damit fertig ist.

 Was mich an einer "einfachen" Schaltuhr stört, ist die Tatsache, daß der
 Computer für einen festgelegten Zeitraum eingeschaltet wird. Um nicht
 Gefahr zu laufen, daß der Computer abgeschaltet wird, wärend er noch
 fleißig am Arbeiten ist, muss die Einschaltzeit sehr hoch angesetzt
 werden, u.U. mehrere Stunden.

 Und wenn der Computer dann die ganze Zeit an ist, ist das, was er tun
 sollte natürlich generell bereits nach zwanzig Minuten erledigt - Fehler
 und Verzögerungen treten immer erst dann ein, wenn man die Einschaltzeit
 runtersetzt. :-)

 Meine Schaltung sorgt nun dafür, daß der Computer genau solange anbleibt,
 bis er selbst das Signal zum Abschalten gibt, also keine Minute zu kurz
 oder zu lang.



 Ich benutze die hier beschriebene Schaltung schon seit Jahren. Ich hatte
 ursprünglich vor, das ganze noch etwas weiterzuentwickeln, um die
 Schaltung so in den Rechner einzubinden, daß der zweite Joystick-Port
 nicht mehr @{"blockiert" link "hacks" 0} wird.

 Dazu hatte ich bis heute weder Lust noch Zeit und gestört hat mich
 diese Einschränkung bisher auch nicht.

 Deshalb veröffentliche ich diese Hardware so wie sie ist, denn ich kann
 mir denken, daß der eine oder andere auch so etwas damit anfangen kann.
@endnode

@node "hardware" "Hardware                 "
                             @{fg shine}- Die Hardware -@{fg text}

 Zum @{"Aufbau" link "aufbau" 0} der Schaltung werden folgende Komponenten benötigt:

 - eine Zeitschaltuhr (s. Hinweise!)

 - ein 9-poliger SUB-D-Stecker (female) zum Anschluß an den Joystick-Port

 - zweipolige Steckverbindung (Stecker und Buchse - z.B. Mono-Klinke)

 - ein Optokoppler Typ SFH 610, ein Widerstand 2,7 kOhm

 - etwas Draht (zweiadrig), evl. ein kleines Stück Rasterplatine - es geht
   aber mit ein bischen Geschick auch ohne

 - der Amiga muß mit einer Echtzeituhr ausgestattet sein (s. @{"Software" link "software" 29})


 @{u}@{fg shine}Die Zeitschaltuhr:@{uu}@{fg text}

 Bevor man einen Timer kauft, sollte man ihn sich unbedingt ansehen und
 ausprobieren, bevor man ihn mitnimmt. Das wichtigste ist, daß der
 Betriebsmodus der Zeitschaltuhr (Auto, On, Off, usw.) über eine Taste
 eingestellt wird, also keine Schiebeschalter!

 Dann sollte man ausprobieren, ob die Schaltuhr die einzelnen Modi
 etwas verzögert aktiviert. Ganz konkret heißt das, man schließt die
 Zeitschaltuhr an eine Steckdose an, stellt den Modus 'On' ein und
 versucht nun, durch zügiges Drücken der Mode-Taste alle anderen Modi
 durchzuschalten bis man wieder auf 'On' ist, ohne daß das Relais
 zwischendurch abfällt.

 Besonders kritisch ist meistens die 'Off'-Stellung, bei der die meisten
 Schaltuhren sofort abschalten, ohne daß man eine Chance hat, den Modus zu
 überspringen.

   Ich verwende dazu eine Zeitschaltuhr von Conrad:

   Zeitschaltuhr Modell HT 456 (Bestellnummer: 622842)

 Diese Schaltuhr ist zwar ansonsten zu nichts zu gebrauchen (was einem
 leider erst nach dem Studium der Anleitung auffällt) aber für diesen
 Zweck ist sie ideal.


 @{u}@{fg shine}Die anderen Bauelemente:@{uu}@{fg text}

 Der 9-polige SUB-D-Stecker ist einfach ein normaler Joystick-Stecker.
 Ein altes Joystick-Kabel, bei dem die Leitungen für Pin 6 und 7 noch
 intakt sind, eignet sich ebenfalls dafür. Dann spart man sich den Draht.

 Die Steckverbindung ist dafür gedacht, um die Schaltuhr einfacher
 abtrennen zu können, falls sie woanders benötigt wird oder wenn man ein
 Schalten durch den Computer verhindern will.

 Den Optokoppler habe ich auch bei Conrad gekauft (Bestellnummer: 184497).
@endnode

@node "aufbau" "Aufbau                   "
                                @{fg shine}- Aufbau -@{fg text}

 Ich beschreibe hier die Vorgehensweise für die Zeitschaltuhr HT456 von
 Conrad (s. @{"Hardware" link "hardware" 0}). Bei anderen Zeitschaltuhren sollten die
 Arbeitsschritte aber ähnlich sein.

 Zunächst dreht man die beiden Schrauben über dem Stecker heraus, die das
 Gehäuse zusammenhalten. Das Gehäuse wird nun noch oben und unten mit je
 einem Plastikclip zusammengehalten, den man mit einem Schraubenzieher
 aushebelt.

 Nun muß das Bedienelement (Knöpfe und LCD) herausgenommen werden. Dazu
 löst man jeweils oben und unten die beiden äußersten Schrauben (vier
 insgesamt). Nun kann das Element komplett herausgenommen werden und die
 restlichen fünf Schrauben können gelöst werden. Danach hebt man
 vorsichtig die Platine ab, möglichst ohne die Knöpfe und die LCD-Anzeige
 durcheinander zu würfeln. Gegebenenfalls noch die Leitgummis abnehmen.

 Auf der Platine sind die Kontakte für die einzelnen Schalter beschriftet.
 Nun muß an beide "Pole" des Mode-Schalters (unten rechts) je ein Draht
 angelötet werden. Auf der oberen Seite bietet sich dazu ein Meßpunkt an,
 der beim Verfolgen der Leiterbahn leicht zu entdecken ist. Auf der
 anderen Seite muß die Leiterbahn etwas freigekratzt werden - am besten am
 Knickpunkt.

 Jetzt können die Drähte angelötet werden - man sollte aber darauf achten,
 daß die Funktion der Schalter nicht durch Drähte oder großzügig
 aufgetragens Lötzinn beeinträchtigt wird.

 Sind die beiden Drähte angelötet, kann die Platine wieder mit den
 Bedienelementen verschraubt werden.

 Jetzt muß folgende Schaltung (freischwebend oder auf einem kleinen Stück
 Rasterplatine) angeschlossen werden:

                  +----------+
                  |          |
                  | SF-610   |                    /
    +-------------|          |-------------------/ --------o PIN 7
    |           3 |          | 2
    \\  MODE-      |          |                Stecker+     Joystick-
     \\ Schalter   |          |                Buchse       port
    |             |          |        _______     /
    +-------------|          |-------|______|----/ --------o PIN 6
                4 |    /\\    | 1
                  |   |  |   |        R 2,7 kOhm
                  +----------+

 Die Polung der Anschlüsse 3 und 4 ist egal. Optokoppler und Widerstand
 werden im Gehäuse angeschlossen und etwas Kabel herausgeführt. Dazu muß
 noch eine Aussparung ins Gehäuse gefeilt werden.

 Nun kann die Schaltuhr wieder zusammengebaut werden. Dabei darauf achten,
 daß keine Kurzschlüsse entstehen (ggf. Isolierband verwenden) und vor
 allem darf die Schaltung @{u}nicht in den Hochspannungsteil@{uu} der Schaltuhr
 ragen!

 An das herausgeführte Drahtende wird die Buchse angelötet und der Stecker
 entsprechend der Schaltung mit PIN 6 und 7 des Joystick-Steckers
 verbunden.

 Zum Schluß wird das Kabel an den zweiten Gameport angeschlossen.

 Das ist alles!

 Dann sollte die Schaltuhr erstmal getestet werden, d.h. in die Steckdose
 stecken, das Joystick-Kabel verbinden aber nicht gleich den Computer
 dranhängen.

 Falls mit dem Schaltuhr-Programm kein Schaltvorgang ausgelöst werden
 kann, die Leitungen zu PIN 6 und 7 vertauschen. Es wurde dann vermutlich
 irgendwo zwischen Optokoppler und und Joystick-Anschluß etwas vertauscht.
@endnode

@node "software" "Software                 "
                               @{fg shine}- Software -@{fg text}

 Zur Ansteuerung der Schaltuhr dient das gleichnamige Programm.

 Syntax: Schaltuhr TIME/A,PATTERN/M

         TIME    : Schaltdauer in 50stel Sekunden

         PATTERN :  S  - Schaltvorgang auslösen
                   <n> - n/50stel Sekunden warten

 Die Schaltdauer gibt an, wie lange der Modus-Knopf bei einem
 Schaltvorgang "gedrückt" werden soll. Ein Wert >2 sollte hier ausreichen.

 Danach folgt ein Muster, nach dem die Schaltuhr bedient werden soll.
 Ein S entspricht einem Schaltvorgang und eine Zahl gibt an, wie lange das
 Programm warten soll. Beispiel:

   Schaltuhr TIME 5 PATTERN 50 S 10 S 10 S

 Das Programm wartet zunächst eine Sekunde, schaltet (für 1/10 Sekunde),
 wartet 1/5 Sekunde, schaltet, wartet 1/5 Sekunde und schaltet.

 Man sollte die Schaltfunktion zunächst testen, ohne daß man sein
 Computersystem an die Schaltuhr angeschlossen hat.


 @{u}@{fg shine}Das Prinzip:@{uu}@{fg text}

 Die Schaltuhr wird so programmiert, daß sie sich nur für ein paar Minuten
 selbsttätig einschaltet (z.B. fünf Minuten). In der Startup-Sequence wird
 überprüft, ob die Systemzeit mit der programmierten Einschaltzeit
 übereinstimmt (ein paar Minuten Toleranz sollten eingeplant werden, da
 Echtzeituhr und Zeitschaltuhr nicht exakt synchron laufen).

 Stimmt die Einschaltzeit, wird ein bestimmtes Programm gestartet, z.B.
 ein Netcall-Script. Das erste, was dann getan werden sollte, ist, die
 Schaltuhr auf 'On' zu stellen (mit dem Schaltuhr-Programm), damit sie
 sich nicht wieder abschaltet.

 Jetzt kann man die gewünschten Aktionen durchführen und nachdem alles
 erledigt ist, wird die Schaltuhr weitergeschaltet, bis sie wieder auf
 'AUTO' steht. An dieser Stelle entscheidet sich, ob man beim Kauf der
 Schaltuhr die richtige Wahl getroffen hat. Wenn man über die
 'Off'-Stellung kommt, ohne daß sich der Rechner abschaltet, hat man
 gewonnen.

 Von nun an wird der Rechner immer über die Schaltuhr ein- und
 ausgeschaltet. Zum manuellen Einschalten stellt man den Modus auf "On"
 und zum Abschalten auf "Auto".

 Man sollte alle Komponenten des Computers über eine Mehrfachsteckdose an
 die Schaltuhr anschließen. Einzelne Geräte (z.B. Drucker) kann man
 immernoch abschalten, wenn sie nicht ständig benötigt werden.
 Vor allem der Monitor wird bei einem automatischen Bootup kaum benötigt
 werden.

 Der Rechner kann mit dem Schaltuhr-Programm nun auch über ein kleines
 Script abgeschaltet werden, ohne die Schaltuhr zu benutzen, z.B. per
 Mausklick oder über einen Hotkey.
@endnode

@node "autor" "Autor                    "
                                 @{fg shine}- Autor -@{fg text}

 Falls jemand diese Schaltuhr nachgebaut hat, würde ich mich über eine
 Rückmeldung freuen. Falls jemand eine etwas systemfreundlichere Version
 des Schaltuhr-Programmes schreibt und mir zuschickt, so werde ich diese
 in Zukunft dem Archiv beilegen und mein Dank wird ihm ewig
 nachschleichen. :->

 Ich bin zu erreichen unter: A.Boerner@BBrandes.in-brb.de
@endnode

@node "hacks" "Einschränkungen/Hacks"
                 @{fg shine}- Einschränkungen und technische Infos -@{fg text}

 - Die wichtigste Einschränkung ist, daß der zweite Joystick-Port von der
   Schaltung blockiert wird. Leider ist es mit dieser Form der Schaltung
   auch nicht möglich, den Joystick durchzuschleifen, da beim Druck auf
   den Feuerknopf die Schaltuhr ausgelöst wird.

   Will man also einen Joystick anschließen, muß man den Stecker für die
   Schaltuhr herausziehen.


 - Das Programm ist in AmigaE geschrieben und schreibt direkt in die
   CIA-Register. Sowas löst bei einem echten Programmierer meist sofort
   Herzattacken aus (bei einem bestimmten vor allem schwallartige
   Beleidigungsorgien... egal :-) aber es funktioniert bis heute auf jedem
   Amiga-Computer.

   Trotzdem bin ich natürlich an einer etwas systemfreundlicheren
   Umsetzung interessiert. Also wenn jemand Lust und zwei Stunden Zeit
   hat - der E-Quellcode ist im Archiv zu finden und das Programm ansich
   ist eigentlich sehr einfach.


   @{u}@{fg shine}Technische Infos:@{uu}@{fg text}

   Die Schaltung verbindet den +5V-Ausgang des zweiten Joystick-Portes mit
   PIN 6 (dem Feuerknopf) über eine Diode im Optokoppler.

   Normalerweise ist PIN 6 als Eingang programmiert und es liegen
   +5V TTL-Spannung (HIGH) an, um den Feuerknopf zu testen. Diese
   TTL-Spannung steht den +5V Versorgungsspannung entgegen, da beide PINS
   über die Diode im Optokoppler verbunden sind. Es fließt folglich kein
   Strom.

   Sobald PIN 6 aber als Ausgang programmiert wird, sackt die TTL-Spannung
   auf LOW ab. Damit steht den 5V Versorgungsspannung von PIN 7 nichts
   mehr im Weg, es findet ein Stromfluß durch die Diode statt und der
   Optokoppler reagiert (der Transistor auf der anderen Seite schaltet auf
   Durchgang). Damit wird der Kontakt in der Schaltuhr geschlossen.

   Die 5V, die nun an PIN 6 anliegen, werden im Computer über einen
   Transistor gegen Masse abgeleitet. Ich mißbrauche praktisch die
   Kurzschlußschaltung des Joystick-Portes aber meinem Rechner hat es in
   über zwei Jahren nicht geschadet, also keine Panik. :-)

   Das Schaltuhr-Programm tut bei einem Schaltvorgang folglich nichts
   weiter, als PIN 6 für eine kurze Zeit auf Ausgang zu schalten und
   wieder zurückzustellen.
@endnode

