@DATABASE "Documentation for the ICY project"
@NODE "MAIN" "Manual for the ICY board"
@TOC "MAIN"

@{JCENTER}

@{b}ICY - a system friendly Zorro II I2C board@{ub}
==========================================

ICY © 1999 Michael Boehmer. All rights reserved.

email: michael.boehmer@physik.tu-muenchen.de

@{" Legal stuff           " LINK "LegalStuff"}
@{" Introduction          " LINK "Introduction"}
@{" The archive           " LINK "Archive"}
@{" Requirements          " LINK "Requirements"}
@{" Theory of operation   " LINK "Operation"}
@{" Memory mapping        " LINK "Addresses"}
@{" Building the hardware " LINK "Hardware"}
@{" Get it up running     " LINK "GetUpRunning"}
@{" Expansions for ICY    " LINK "Expansion"}
@{" Using the software    " LINK "Software"}

@{" Author                " LINK "Author"}
@{" History               " LINK "History"}
@{" Future                " LINK "Future"}
@{" Thanks go to ...      " LINK "Thanks"}

        

One Ring to rule them all.
One Ring to find them.
One Ring to bring them all
And in the darkness bind them.
(J.R.R. Tolkien, Lord of the Rings)

@ENDNODE


@NODE "LegalStuff" "Legal stuff"

@{b}Legal stuff:@{ub}
============

All possible care has been taken to make ICY bugfree.
Though no guarantee can be given on anything.
Build and use ICY on your own risk !

ICY is postcard ware. If you use it, send @{"me" LINK "Author"} a postcard !
Of course, you are free to send me money, Amigas, CDs, books, DVD videos, ... :)

All files in this archive except the i2c.library are © 1999 Michael Boehmer.
The i2c.library is © 1999 Wilhelm Noeker.

The distribution of the ICY archive on Public Domain disks or CDROMs is
permitted, as long as no profit is made from it and the archive and its 
contents remain unaltered. If you build an ICY board, you are allowed to 
sell this one to the price of the parts. 

It is especially @{b}NOT@{ub} permitted to:
 - sell this product in a commercial way
 - copy any part of this project 
 - include this project in any commercial product
without the written permission of the author.

@ENDNODE


@NODE "Introduction" "What is this all about ?"

@{b}What is ICY ?@{ub}
=============

ICY is a Zorro II compliant expansion board for the Amiga computer family.
It is supposed to work in any Amiga model with a Zorro II bus system.
ICY does implement an I2C bus interface which is straight forward to
program, without bit twanging or the need to care for timing. It is
supported by Wilhelm Noekers i2c.library, so every program based on this
library will work with this interface. Moreover, there is an expansion port
which allows the usage of the hyperCOM 3i module produced by vmc.

As an additional feature, there is place for a battery backuped real time
clock (RTC) on the board, so all who have the problem of the original
motherboard RTC dying on age can use ICY as a replacement.

@{b}What is I2C ?@{ub}
=============

I2C (speak I squared C) is a bus system developped by Philips for usage in
video recoders, tuners, television sets as well as in "multimedia" systems.
Its purpose is to modulize such systems; so e.g. a VCR can be easily
assembled from different modules which communicate over the I2C bus.

To get in closer touch with this topic, there's a small @{"FAQ" LINK "I2CFAQ"}
compiled by me which should clear most of the questions you may have.

@ENDNODE

@NODE "Archive" "The archive contents"

@{b}The archive contents@{ub}
====================

@{b}The files:@{ub}

The ICY archive contains the following files:

ICY -+---------------- ICY.guide  : the file you are reading now
     |
     +- PCB --------+- top.ps     : Postscript top layer file
     |              +- bottom.ps  : Postscript bottom layer file
     |              +- tplace.ps  : Postscript placement file
     |
     +- Schematics -+- schem1.ps  : Postscript schematics 1/4 
     |              +- schem2.ps  : Postscript schematics 2/4
     |              +- schem3.ps  : Postscript schematics 3/4
     |              +- schem4.ps  : Postscript schematics 4/4
     |
     +- libs --------- i2c.library: Library for hardware accesses

The files in the PCB and Schematics directory contain all information 
on the technical side of ICY. Use a tool like GhostScript to view 
and /or print these files.
When you own a Postscript capable printer (or have access to one
connected to a PC), you can print these files easily by:

 * Amiga             : copy file.ps par:

 * PC + Linux        : lpr file.ps
 
 * PC + MSDOS/Windoof: copy file.ps lptX: /b
   (where lptX: is the port the printer is connected to)

Use CrossDOS to transfer the files via a MSDOG disk.

@{b}The installation:@{ub}

1. @{u}hardware@{uu}

   Have a look in @{"Get ICY up and running" LINK "GetUpRunning"}.

2. @{u}software@{uu} 

   Copy libs/i2c.library to LIBS:
   You should do this @{u}before@{uu} you test ICY the first time.
   It is also recommended to get the full i2c.library archive from aminet.
   See further details in the @{"software section" LINK "Software"}. 

@ENDNODE


@NODE "I2CFAQ" "Frequently asked questions ..."

@{b}Some questions and their answers:@{ub}
=================================

@{"What the hell is I2C ?" LINK "topic1"}
@{"So this is USB ?" LINK "topic2"}
@{"How does it work ?" LINK "topic3"}
@{"How does a chip recognize that he is addressed if there are only two wires ?" LINK "topic4"}
@{"What about master and slave ?" LINK "topic5"}
@{"What about speed ?" LINK "topic6"}
@{"What can I do with it ?" LINK "topic7"}
@{"What chips with I2C interface do exist ?" LINK "topic8"}
@{"Compatibility ?" LINK "topic9"}
@{"Do there exist other interfaces for the Amiga ?" LINK "topic10"}
@{"Is there any software for it ?" LINK "topic11"}
@{"Why should I build such a Zorro2 card ?" LINK "topic12"}
@{"Where can I find additional information on I2C topics ?" LINK "topic13"}
@{"Where can I get a PCB ?" LINK "topic14"}
@{"Where can I get the parts needed for this board ?" LINK "topic15"}

If you miss some Q&A, feel free to email @{"me" LINK "Author"}.

@ENDNODE


@NODE "topic1" "What the hell is I2C ?"

@{b}Q:@{ub} What the hell is I2C ?
@{b}A:@{ub} I2C is the abbreviation for "Inter IC Communication". It's a standard
for coupling many different chips together, where any of them can be a
master, which controls the other slaves. It is mainly used in television and
audio consumer electronics, but can be even found in actual int*l based
systems, where it's called SMB and used for monitoring voltages, temperature
and the CPU fan. The bus itself was originally invented by Philips for use
in television sets and VCRs.

@ENDNODE


@NODE "topic2" "So this is USB ?"

@{b}Q:@{ub} So this is USB ?
@{b}A:@{ub} No, sorry. USB needs are more sophisticated interface, and to make
things harder, most USB controller chips have a builtin PCI interface.
ICY is NOT an USB controller card.

@ENDNODE


@NODE "topic3" "How does it work ?"

@{b}Q:@{ub} How does it work ?
@{b}A:@{ub} Simple. The whole bus consists of three wires:
     SCL - serial clock
     SDA - serial data
     GND - ground
Both lines are open collector and stay high (at +5V) if the bus is free.
Each transmission consists of nine bits: 8 data bits and 1 acknowledge
bit. Data is only valid on the positive (raising) edge of SCL and must
not change during SCL high.
If a chip wants access to the bus, it drives SDA low while SCL is high -
this is called a start condition.
The whole bus specification (local copy) can be found at:
http://www.e12.physik.tu-muenchen.de/~mboehmer/iic/pdf/I2C_BUS_SPECIFICATION_1995.pdf

@ENDNODE


@NODE "topic4" "How does a chip recognize that he is addressed ... ?"

@{b}Q:@{ub} How does a chip recognize that he is addressed if there are only
two wires ?
@{b}A:@{ub} Each transmission consists of a start condition, a chip address and
a (not limited) number of data. Each slave chip listens to the start
condition and compares its internal address with the current one transmitted
on the bus. Only if it matches, it acknownledges the cycle and reacts on
further data. Each address consists of a 7 bit chip address and one bit
indicating R/W accesses (0 = write, 1 = read).
Some chips have a completely hardwired address, but most of them have up to
three pins (A2,A1,A0) which determine the chip address (e.g. the PCF8574).
Some of the newest ICs start with a hardwired address and can be
reprogrammed to a new one (e.g. the DS1780).

@ENDNODE


@NODE "topic5" "What about master and slave ?"

@{b}Q:@{ub} What about master and slave ?
@{b}A:@{ub} Generally, there are two kinds of chips on the bus: masters and
slaves. A master is a chip driving the SCL line and thus dictating the speed
of the transmission. A slave is a chip reacting on the SCL transitions.

@ENDNODE


@NODE "topic6" "What about speed ?"

@{b}Q:@{ub} What about speed ?
@{b}A:@{ub} The I2C bus is specified for up to 100kHz. Taking 9bit transmissions,
you get roughly 11kB/s (but there is still overhead to calculate with).
Modern versions of the I2C bus work with 400kHz, but this is NOT supported
by ICY (as the controller chip is limited to 100kHz maximum).

@ENDNODE


@NODE "topic7" "What can I do with it ?"

@{b}Q:@{ub} What can I do with it ?
@{b}A:@{ub} Almost everything. The most known application on the Amiga is 
certainly teletext (in Germany: Videotext). With only two chips, some
passive components and a CVBS (Germany: FBAS) source you can read all
teletext pages into your computer and save, print, edit and whatever them.
I suggest using the superb Videotext package from Wilhelm Noeker on the
Amiga (aminet/hard/drivr/VideoText.lha).
But all kind of applications can be done:
  Analogue-digital conversion
  realtime clocks (e.g. PCF8583)
  EEPROMs (e.g. the PCF8581)
  LED drivers (SAA1064)
  beepers (PCD3311)
  general I/O tasks (e.g. PCF8574)
  temperature measurement (e.g. DS1629)

@ENDNODE


@NODE "topic8" "What chips with I2C interface do exist ?"

@{b}Q:@{ub} What chips with I2C interface do exist ?
@{b}A:@{ub} Too many to list them all here.
Good starting points are
  http://www-eu3.semiconductors.com/i2c/products/ (Philips - mainly video and audio applications)
  http://www.dalsemi.com/                         (Dallas Semiconductors - data acquistion)
  http://www.linear-tech.com/                     (Linear Technologies - data acquistion)
  http://www.maxim-ic.com/                        (Maxim Integrated Circuits - data acquisition)
  http://www.xicor.com/                           (Xicor - digital potentiometers)

@ENDNODE


@NODE "topic9" "Compatibility ?"

@{b}Q:@{ub} Compatibility ?
@{b}A:@{ub} Watch out, there exist other serial busses which are very similar 
to the I2C bus but NOT compatible. Have a long and deep look into the data
sheet of the selected IC and ensure that it is really compatible.
Philips chips which have the "I2C" symbol in the data sheet work, and most
of the Dallas Semiconductor chips also do. Especially when looking for ADCs
special care should be taken, as many of these chips use own serial busses
which do NOT comply with the I2C protocol.

@ENDNODE


@NODE "topic10" "Do there exist other interface for the Amiga ?"

@{b}Q:@{ub} Do there exist other interfaces for the Amiga ?
@{b}A:@{ub} Yes, there are plenty of them. All I know of use discrete components 
to implement the open collector outputs of the SCL and SDA line. They all
need software control to do the bus protocol and the parallel/serial
conversion and vice versa.
At the moment, there exist interfaces which connect to the
  parallel port: Jan Leuverink`s interface
  serial port:   c`t interface
  disk port:     Wilhelm Noekers interface
  Zorro bus:     my interface
which are all supported by Wilhelm Noekers i2c.library.

@ENDNODE


@NODE "topic11" "Is there any software for it ?"

@{b}Q:@{ub} Is there any software for it ?
@{b}A:@{ub} Yes, the i2c.library from Wilhelm Noeker (aminet/hard/hack/i2clib40.lha).
This library has support for several hardware interfaces and provides an
easy way to program own hardware based on the I2C bus. This package includes
also tools for scanning the I2C bus (so you know what addresses do respond),
sending and receiving data in the shell. An application package is e.g. the
VideoText package (aminet/hard/drivr/VideoText.lha), which gives you a full
featured teletext decoder using the SAA5246 standard application circuit.

@ENDNODE


@NODE "topic12" "Why should I build such a Zorro2 card ... ?"

@{b}Q:@{ub} Why should I build such a Zorro2 card if I can solve the whole 
problem by only one chip like in Wilhelm Noekers interface ?
@{b}A:@{ub} You should choose the kind of interface you want by what is important 
for you. The "passive" interfaces are easy to build, fit externally and
generally work just fine. But: they occupy one port, are stupid and so need
software to do all the protocol questions and watch out not to overclock the
bus.
My ICY interface card does all the protocol work in hardware, is not too
hard to build and offers the possibility to add serial/parallel ports. You
also needn`t worry about speed, as SCL is generated in hardware - so the
correct frequency is kept even if you use ICY in a PPC system with 300MHz as
well as in a 68000 system with 7MHz.
Interrupt driven handshake is also possible, so the need for polling the
interface is not given like with the passive adapters (software still lacks
this support, but will get as soon as the PCB are produced).
Moreover, the interface chip implements a monitor mode, so for example you
could connect this bus to your VCR internal bus and analyze how its tuner
and VTX chip are controlled. (But sorry again, no software exists yet to do
this.)

@ENDNODE


@NODE "topic13" "Where can I find adtitional information on I2C topics ?"

@{b}Q:@{ub} Where can I find additional information on I2C topics ?
@{b}A:@{ub} Try one of these links:
  Simon's I2C page
        http://www.tk.uni-linz.ac.at/~simon/private/i2c/index.html
  Matthias Prinke's I2C page
        http://www-public.tu-bs.de:8080/~y0001602/projekte/projekte.html

@ENDNODE


@NODE "topic14" "Where can I get a PCB ?"

@{b}Q:@{ub} Where can I get a PCB ?
@{b}A:@{ub} There are three possibilities:
  either get the Postscript schematics from this archive and use a prototype
        board (like I did the first time) and wire it by hand.
        Worst possibility in my eyes.
  or you get the Postscript files for the top and the bottom layer and do it
        yourself. As many vias are present on the board and the wires are
        quite small, you should do this @{b}only if you know what you are doing !@{ub}
  or you contact me. I got a first series of ten PCBs produced.
        These PCBs are industrial quality, so containing soldering stop and vias.
        Maybe the easiest way.

@ENDNODE


@NODE "topic15" "Where can I get the parts needed for this board ?"

@{b}Q:@{ub} Where can I get the parts needed for this board ?
@{b}A:@{ub} Try your local electronic shop or some of these:
  Conrad Electronics (http://www.conrad.de)         (good assortment, bad website, quite expensive)
  Buerklin           (http://www.buerklin.com)      (good assortment, partly expensive)
  R+S Components     (http://www.rs-components.com) (good assortment, rather expensive)
All these firms are in Germany, so you will need to find a suitable dealer
next to you when you are abroad.

@ENDNODE


@NODE "Requirements" "Needful things"

@{b}Requirements@{ub}
============ 

For using the ICY board, you will need:

  * any Amiga model with a Zorro II / Zorro III bus system
    (e.g. A2000, A3000, A4000)
  * OS 2.04 (software requirement)
  * of course something to control with it :) (e.g. a teletext decoder)

For building the ICY board, you will need:

  * a PCB (see the Postscript files top.ps and bottom.ps)
  * the parts according to the part list
  * some experience in SMT soldering

@ENDNODE

@NODE "Operation" "Theory of operation"

@{b}Theory of operation@{ub}
===================

ICY does implement both autoconfiguration logic and an interface to the
PCF8584 I2C bus controller chip as well as an optional RTC circuit
controlled via the I2C bus.

@{b}Autoconfiguration@{ub}

The autoconfiguration part of ICY is implemented as suggested in the CATS
documentation from Commodore. The autoconfig part consists of IC1 (data bus
driver), IC2 (address bus driver), IC3 (comparator), IC4 (8bit data
register), IC6 (autoconfig GAL) and parts of IC5.
IC6 stores the autoconfiguration table with all information on the board
(manufacturer, product id, serial number, boardsize, ...) as well as two
latches used for passing /CFGOUT and handling a possible SHUTUP condition.
ICY uses normal four cycle bus accesses while the autoconfiguration process.
/SLAVE and /BERR are handled also by IC5.
Before autoconfiguration is completed, the base address of the board is
given as 0xE8xxxx by the resistor array RN1 and RN2. The new base address of
ICY is stored in register IC4.

@{b}Interfacing the PCF8584@{ub}

Though the PCF8584 is well suited for a Motorola style bus, there are some
points to watch out for. The PCF8584 uses an automatic bus detection feature
to "autoconfigure" for both int*l and Motorola style busses. So all accesses
to the PCF8584 are to be blocked until the software can ensure that the
correct bus system (Motorola, of course :) will securely be recognized.
IC5 does this by blocking all read accesses to the PCF8584 until at least
one write cycle has occured. By this way, the correct sequence of /CS and
R/W edges will be seen by the PCF8584.
The other problem is the minimum access time needed for correct operation of
the PCF8584. Normal four cycle accesses as used on the ZorroII bus are by
far too short - the PCF8584 will not respond to these cycles.
There are basically two ways of adding wait states to a bus access on the
ZorroII bus: either by applying XRDY (to delay the automatic /DTACK
generating on the motherboard) or by setting /OVR (to disable the
motherboard /DTACK). ICY uses the /OVR method which proved more reliable: in
my Amiga 4000, XRDY didn't give satisfying results.
On each access to the PCF8584, IC5 sets the /OVR signal and disables /DTACK
generation on the motherboard. The PCF8584 generates an own /DTACK to signal
the end of access. IC5 samples this signal and optionally delays the output
to the ZorroII bus (that's what SW1 is for). Should the PCF8584 go to int*l
mode by error, the first access to it will completely block the Amiga system
by a bus lockup.
This /DTACK handling is only done for accesses to the PCF8584, not for
accesses while autoconfiguration or to the expansion connector.

@{b}Interrupts@{ub}

ICY offers two interrupt sources: PCF8584 generates /INT2 (when enabled),
the /INT6 signal can be used by any expansion module on the expansion
connector JP1 (so would the vmc hyperCOM 3i module).

@{b}RTC circuitry@{ub}

The circuit for the RTC is orientated on the standard applications for both
the DS1629 and the PCF8583. An adjustment capacitor allows fine tuning the
quartz oscillator.

@ENDNODE

@NODE "Addresses" "Memory map of ICY"

@{b}Memory map of ICY@{ub}
=================

ICY uses only data lines D[15:8].

@{b}During autoconfiguration@{ub}

ICY uses the normal ZorroII autoconfiguration address space from 0xe8000 to
0xe807f.

@{b}After successful configuration@{ub}

The OS assigns a new base address to ICY which will normally be in the range
between 0xe90000, 0xea0000 ... 0xef0000. So only offsets relative to the new
base address can be given:

 Offset     function

 0x0000     PCF8584 data buffer/shift register S0
 0x0002     PCF8584 control/status register S1

 0x8000
  ...       expansion board
 0x81fe

Though the PCF8584 addresses are mirrored throughout the lower 32kB space of
ICY, it is @{u}strongly recommended@{uu} to use only offsets 0x0000 and 0x0002 for
compatibility with future hardware versions !

@{b}After SHUTUP in autoconfiguration@{ub}

After a SHUTUP in autoconfiguration ICY will not occupy any address space.

@ENDNODE


@NODE "Hardware" "Instruction on building the hardware"

@{b}How to build the ICY board@{ub}
==========================

A prototype of ICY has been built after the schematics in this archive. I
could take this prototype almost immediately to operation in both an Amiga
2000 and an Amiga 4000. Should you encounter any unusual behaviour of ICY,
you should first consider to have a look into the @{"hardware solution FAQ" LINK "Solutions"}.

First of all, make sure that you have the following things ready at hand:

* all parts listed in @{"partlist" LINK "PartList"} for the ICY version you want
  (basic, RTC, complete)
* the @{"PCB" LINk "PCB"}, of course
* a small soldering iron with a fine tip suitable for SMT soldering
  (a soldering station would be the best choice)
* SMT tin, preferable with flux included
* a pair of tweezers for placing the components
* some plairs
* some desoldering litz for removing unwanted soldering joints

@{u}Some words on the GALs:@{uu}
As I want to include both a serial number and information on the GAL source
version, I decided not to release the GAL source files. This makes things
easier for you and me, as in case of hardware problems, you simply provide
the serial number (which includes the version information) output from a
utility like SysInfo - this gives me exact information on your GAL version.
When you want to burn your own GALs, please feel free to contact me.
I will provide the two JEDEC files needed for both GALs.

You should use GALs from Lattice only. Use only GALs with 15ns or less
access time. Suitable GALs are (Lattice part numbers):

 GAL22V10B-15LJ  (low power, 15ns)
 GAL22V10B-15QJ  (quarter power, 15ns)
 GAL22V10B-10LJ  (low power, 10ns)
 GAL22V10B-10QJ  (quarter power, 10ns)


@{u}Some hints on soldering:@{uu}

* Double check the components' polarity !
  This refers to the tantalum capacitor, the diodes, all ICs, the battery
  socket and the SIL resistor network.
* Use as much tin as needed but not more. This will prevent shorts between
  pads and vias.
* Keep the soldering time as short as possible. The components are quite
  small and get overheated fast.

To make things more complicated for you, I designed the ICY board in a way
it can be build in four versions:

    @{"Basic version   " LINK "BasicVersion"} - only the I2C interface
    @{"RTC version     " LINK "RTCVersion"} - I2C interface and RTC
    @{"vmc version     " LINK "VmcVersion"} - I2C interface and expansion port
    @{"complete version" LINK "CompleteVersion"} - I2C interface, RTC and expansion port

After you built your ICY board, you should double check all soldering joints
and control on misplaced parts. After this, a @{"first check" LINK "GetUpRunning"} can be done.

@ENDNODE


@NODE "PartList" "Partlist for all ICY versions"

@{b}Partlist for the ICY project@{ub}
============================

@{b}Parts for the basic version:@{ub}

Part     Value          Package
@{"PCB" LINK "PCB"}      ---            ---
C1       10uF 16V       6032
C2       100nF          0805
C3       100nF          0805
C4       100nF          0805
C5       100nF          0805
C6       100nF          0805     
C7       100nF          0805     
C8       100nF          0805     
F1       NANOFUSE       NANOFUSE 
IC1      74F245         SO20L
IC2      74F245         SO20L    
IC3      74F521         SO20L    
IC4      74ALS574       SO20L    
IC5      22V10PLC28     PLCC28   
IC6      22V10PLC28     PLCC28   
IC7      PCF8584SMD     SO20L    
JP2      PINHD-2X5      2X05     
PLCC28   PLCC28         Socket   
PLCC28   PLCC28         Socket   
QG1      12MHZ          DIL08S   
R1       4K7            1206     
R2       4K7            1206
R3       4k7            1206     
R4       4K7            1206     
R5       4K7            1206     
RN1      10K            SIL5     
RN2      1K             SIL5
SW1      SMDSWTCH       SMDSWTCH 

@{b}Parts for the RTC version:@{ub}

Part     Value          Package  
BAT1     LITHIUM        LITHIUM2 
C9       5.0-20pF       SMDTRIM
D1       BAS85SMD       SOD80    
D2       BAS85SMD       SOD80    
IC8      DS1629SMD      SO8      
IC9      PCF8583SMD     SO8W     
Q1       QUARZSMD       QUARZSMD 
BAT      CR1620         CR1620   

Either IC8 or IC9 is needed. 
Mind the different orientation of the PCF8583 compared to
all other ICs on the board !

@{b}Parts for the vmc version:@{ub}

Part     Value          Package
JP1      PINHD-2X13     2X13
3i-Module from vmc

@ENDNODE

@NODE "PCB" "Where to get the PCB"

@{b}Where to get the PCB@{ub}
====================

There are two way of getting a PCB for ICY:

a) @{u}Do it your self@{uu}

Get both PCB files (top.ps and botto.ps) from this archive. Both layerfiles
have a text included which must be readable on the PCB.
As the PCB has quite small wires (8mil) and a high number of vias, I do not
recommend the Do-it-yourself method. This method is only intended for people
who have experience with PCB production.

The vias can be made by hand: put a small piece of wire through the via,
solder the one side, then the other to the pad. Don't forget to make the top
solder joint as low as possible if the via is located under a SMT component
(e.g. the vias under the ICs).

b) @{u}Get one from me@{uu}

After some search, I found a firm which produces PCBs even in small numbers
for a resonable price. For start, I ordered ten PCBs which are ready for
shipping. These PCBs are industrial quality, double sided with vias and are
hot air tinned.

If you want to get one, contact @{"me" LINK "Author"} for information on the
price. I also have most of the parts on stock, as many of them are either
hard to get (especially the 74F521 seems to be hard to find) or are
available in many different sizes (there are plenty of fuses in SMT).

@ENDNODE


@NODE "BasicVersion" "The basic version of ICY"

@{b}The basic version:@{ub}
==================

1. Start with all the decoupling capacitors C2, C3, C4, C5, C6, C7 and C8.
Put the capacitor on its pads by holding it with the tweezers on one end.
Solder the other end to the pad and wait till the capacitor has cooled down.
Then solder the other joint in short time to prevent the other doldering
joint from getting too hot.

2. Next do the same with the resistors R1-R5.

3. The tantalum capacitor C1 should be handled different: Put some tin on
the pads, place the capacitor (mind the polarity, a thick line marks the
positive pin) and reheat the tinned pad while adding some new tin. This is
necessary because the pads are occupied nearly completely by the component.

4. Now for the ICs: We'll start with IC1, IC2, IC3, IC4,IC5 and IC7. Put the
IC on its pads (mind the polarity, a small point marks pin1, or the housing
has a flattened side on the row with pin 1).
Solder two opposite pins to the pads, check the correct orientation and
solder the rest of the pins. Do not overheat the IC !

5. The nanofuse F1 in its socket needs some attention, too, as the pads are
quite close to the connector JP2. Check with the JP2 in its pads if you can
place both parts in the PCB. Remove JP2 again and solder the fuse socket in
the same way as the tantalum capacitor.

6. Tin all the pads for GALs IC5 and IC6. I strongly recommend using sockets
as updating the GALs is made easier (desoldering PLCCs is a task for a well
equipped and trained person only). Use only as much tin that only a small 
"hill" is formed. There shouldn't be any edges or sharp tops.
Put the socket on the tinned pads, check the orientation (the missing edges
should point towards JP2) and solder each pin to its pad by tipping on the
pin from inside the socket. Double check each soldering joint on correct
connection.

7. Put the switch SW1 on its place.

8. Last step: all the "conventional" components. No explanations should be
needed for this task, except: mind the polarity and don't mix up the two
SILs RN1 and RN2. The quartz oscillator QG1 has one sharp edge that points
toward the upper left edge of the PCB.

9. Check all components on correct placement, orientation and shorts.

10. Configure the cable: take a flat ribbon cable with 10 wires, long enough
to reach from JP2 on ICY to the place you want to mount the SUBD9 connector.
Hint: You can also use a standard PC cable used for serial ports (if it's
    long enough). You should double check the wiring in this case.
Press the 10pin connector to the cable (pin1 on the cable is marked red) and
solder the wires 1:1 to the SUBD9 connector. Wire 10 is left free. You can
cut it.

The SUBD9 connector has the following pinout:

          5   4   3   2   1      1  GND     6  GND
          o   o   o   o   o      2  SCL     7  GND
            o   o   o   o        3  GND     8  GND
            9   8   7   6        4  VCC     9  SDA
                                 5  VCC
@ENDNODE


@NODE "RTCVersion" "The RTC version"

@{b}The RTC version:@{ub}
================

For the RTC version, either IC8 or IC9 is needed. You can't use both chips
at once. You will have to choose for yourself which RTC chip you want to
use. Especially the DS1629 has some nice features but is quite hard to get
(at least here in Germany).

1. Perform all steps mentioned under @{"basic version" LINK "BasicVersion"}.

2. Solder IC8 OR IC9 on its pads. CAUTION: When using a DS1629, the chip has
the same orientation as all other ICs, but the PCF8583 has to point in the
other direction !

3. Use the pliers to bend the wires of Q1 in the right orientation. Place it
on the pads, solder both wires and attach the metal housing on the big
ground pad. Take care not to overheat the component.

4. Solder the trim capacitor C9 the same way as mentioned under (A) 1,
followed by the two diodes D1 and D2. The small black ring marks the
cathode, it points toward the left side of the PCB.

5. The battery socket BAT1 shouldn't cause problems, as long as you put it
in the right orientation. The pin in the middle of the round part gets in
the left pad.

6. Do not insert the battery CR1620 at once. The DS1629 is shipped with
temperature conversion and frequency output enabled. You should disable 
frequency output after adjusting C9 (best with a high precision frequency
counter) and temperature conversion to avoid empty batteries.

@ENDNODE


@NODE "VmcVersion" "The vmc version"

@{b}The vmc version:@{ub}
================

1. All steps mentioned for the @{"basic version" LINK "BasicVersion"} are to be performed.

2. Place JP1 into its pads. That's all :)

3. Place the hyperCOM 3i module on JP1. There's only one way it fits, so the
only thing to watch out is a possible misalignment on the pinhead.
The jumper on the module has no meaning, so you can put it in any position
or leave it out.

@ENDNODE


@NODE "CompleteVersion" "The complete version"

@{b}The complete version:@{ub}
=====================

1. Perform all steps mentioned for the @{"basic version" LINK "BasicVersion"}.

2. Follow the instructions for the @{"RTC version" LINK "RTCVersion"}.

3. Do the things explained for the @{"vmc version" LINK "VmcVersion"}.

@ENDNODE


@NODE "GetUpRunning" "Get ICY up and running"

@{b}Get ICY up and running@{ub}
======================

First of all: you should know that @{b}every@{ub} selfbuilt hardware implies
danger when first powered up. You should know what you are doing.

For a first function test follow these instructions:

(1) Disconnect your Amiga from the AC net and remove all external plugs.

(2) Open your Amiga's housing and search a free Zorro slot.

(3) When you feel unsure, remove all other Zorro cards for the first test.

(4) Put ICY in a free Zorro slot. The side with the components is to
    orientate the same way as all other cards in your Amiga. As ICY is a
    "short" board, there's the danger to put it in the Zorro slot the wrong
    way. This would almost sure kill either your ICY board, your Amiga - or
    both. So check the orientation !
    (In the Amiga 2000, the components point towards the power supply; in
    the Amiga 4000, the components side is the upper side)
    Watch out not to shorten the backup battery ! Especially in the Amiga4000,
    there's not much space to "navigate" the ICY board in its slot.

(5) Close the housing. Do not operate your Amiga with a open housing, as
    there's the risk of an electrical shock when touching parts carrying AC
    power.

(6) Connect all external plugs necessary for operation.

(7) Power up your Amiga. Watch out for any unusual behaviour and are
    prepared to switch off IMMEDIATELY when something doesn't behave like
    always.

(8) When your Amiga has booted, install the correct version of i2c.library
    and try a "I2CScan" in a shell. This command should show all I2C chips
    connected to ICY, so:
       none - in the basic version
       one  - in the RTC or complete version

If you encounter any problems, have a look in the @{"hardware FAQ" LINK "Solutions"}.
There's a high probability that your problem can be solved, anyway, if you
can't find the error, feel free to contact @{"me" LINK "Author"}.

@ENDNODE


@NODE "Expansion" "Expansions for ICY"

@{b}Expansions for ICY@{ub}
==================

ICY can be expanded easily by modules fitting on JP1.
On JP1, all necessary signals are provided for small circuits.

A possible enhancement (for which this connector was designed originally) is
the hyperCOM 3i module produced by vmc.
This module provides two serial ports and one parallel port and can be
bought from:

   vmc - Harald Frank
   Ringstrasse 26
   68789 St. Leon-Rot
   Germany
   tel.: +49-6227-880460
   fax:  +49-6227-880464
   mailbox: +49-6227-880464
   www:  http://www.vmc.de/

Up to now, no driver exists for the combination ICY and 3i, but as the
interface is electrically the same as on the vmc isdn blaster, no major
rework should be needed to adapt the hyperCOM driver for the 3i module on the 
isdn blaster. It should be stated that the current driver from vmc does not
work as good as it is supposed to, so don't expect this driver too soon :(

When using the hyperCOM 3i module you needn't care about the jumper on it.
This jumper is only useful when connecting the 3i module to the isdn blaster
and has no meaning for ICY. You can set it to whatever position you want.

@ENDNODE


@NODE "Solutions" "Possible errors and solutions for them"

@{b}Possible errors and solutions for them@{ub}
======================================

First of all, don't panic. I've built several ICY boards and got them nearly 
immediately to work. If an ICY board does refuse to work, then in the most cases
only minor errors are to be found.

What to do if your ICY board doesn't work:

 * Check all soldering joints. Did you forget to solder one pin of an IC ?
   (this can give strange errors - and sometimes even none !)
 * Check the PLCC sockets. Are ALL pins soldered ? Have all pins contact to the
   corresponding wire on the PCB ?
   (happened to me two times :)
 * Are the GALs swapped ? 
 * Are all resistors soldered on both sides ?

After these checks, ICY should work. 
If still an error is present, check all the following FAQs:

@{b}Q:@{ub} My board doesn't work. The first poweron in my Amiga gave me a short
lightning on the ICY board, and the fuse in my room did release.
@{b}A:@{ub} Apparently you didn't check all soldering joints. Some misplaced
components, shortened pads, tin bridges or any else mistake have killed
your board and / or your Amiga.

@{b}Q:@{ub} My board doesn't work. My Amiga doesn't boot, all I get is a flashing
power LED and / or a colored screen.
@{b}A:@{ub} This could be an error in the bus logic. Check the bus drivers IC1 and
IC2, as well as the GAL IC6. Check if /DTACK has been shortened to VCC.
Check both GALs on correct placement.

@{b}Q:@{ub} My Amiga starts, but the ICY board does not show up in the system.
All other boards work.
@{b}A:@{ub} Apparently ICY has been shutup during the autoconfig process. The OS
didn't find a suitable place in the address space between 0xe90000 and
0xefffff. ICY needs 64kB in this region, and if other boards before ICY in
the configuration chain occupy all space in this I/O region, ICY will not
work in this system. This is not an error but normal behaviour in the
autoconfig mechanism.
Check pin 17 of GAL IC6. A high level (3.5V..5V) indicates a "shutup"
board, so try removing one of "big" cards in the system.
A low level (0v..0.5V) makes it harder: try setting SW1 to the right
(left) position, this enables delaying /DTACK of the board. Please contact
me if this error has occured (this "error" is caused by agressive turbo
boards and maybe bad designed backplanes. I haven't seen it once.).

@{b}Q:@{ub} My Amiga starts, but all boards behind ICY (and ICY itself) do not work.
@{b}A:@{ub} This is an error in the autoconfiguration logic. Check both GALs and
IC1, IC2, IC3 and IC4. Check both SILs, as ICY won't work with misplaced
SILs.

@{b}Q:@{ub} Why do you use so many driver chips ? Most of my Zorro boards don't do.
@{b}A:@{ub} Data and address bus drivers are mandatory in the ZorroIII
specification. Though ICY is a plain ZorroII board, the usage of the
drivers IC1 and IC2 should make life easier for the GALs and the PCF8584.

@{b}Q:@{ub} Why only a 250mA fuse ? My Amiga has a 200W power supply ?
@{b}A:@{ub} According to the specifications, each ZorroII board is allowed to
consume up to 2A on the 5V line. Though ICY doesn't need this 2A, you
shouldn't take too much current over the Zorro bus. The +5V line of ICY
is intended for small circuits only, and shorting the fuse Fx is NOT
RECOMMENDED !

@{b}Q:@{ub} Why only 90kHz on the SCL line ? Can I use higher rates ?
@{b}A:@{ub} The PCF8584 does only support 90kHz. You can't use higher rates with
ICY without overclocking the chip (which is @{b}NOT RECOMMENDED@{ub}). Maybe
Philips will release a newer version of the PCF8584 which will support the
fast I2C bus with 400kHz. If this will happen, and if the new chip is pin
compatible, a simple replacement of the PCF8584 could be done.

@{b}Q:@{ub} What does switch SW1 ?
@{b}A:@{ub} This switch is normally neither needed nor used. Leave it out or keep
it in the left position. Should ICY show lots of transmission errors or
fail completely, but configure normally, then you might need to try SW1 in
the right position. Switch only while your Amiga is powered off.
SW1 in the right position enables /DTACK delay, so turbo boards which act
too agressive on the Zorro bus shouldn't be a problem.
Some boards sample data on the bus one clock cycle too early, hoping to
find stable data.
Under normal conditions, SW1 is not needed. ICY has full autoconfig
support and works without any jumpers or switches.

@{b}Q:@{ub} I try to program the PCF8584 on the ICY board, but the chip does not
respond on read cycles before I write at least one byte to it.
@{b}A:@{ub} The PCF8584 is designed for operation in both int*l and Motorola style
bus systems. If the PCF recognizes a falling edge on the R/W line after
a falling edge on the /CS line, it configures for int*l mode and
won't create /DTACK. As this would lead to a bus lockup (and could only
be broken up by a reset), a small control logic in GAL IC5 prevents read
accesses to the PCF8584 before at least one write access has been
performed.
Should you ever recognize bus lockups with ICY, please contact me.

@{b}Q:@{ub} How do I program the PCF8584 ?
@{b}A:@{ub} Take a look into the data sheet.
Some hints:
* Use the initialisation procedure provided by Philips.
* Take care of the dummy read.
* Configure the CLOCK register correctly for the 12MHz quartz oscillator.

@{b}Q:@{ub} My backup battery is empty after one week. I use a DS1629 RTC.
What do I wrong ?
@{b}A:@{ub} The DS1629 includes a temperature conversion feature. If this
feature is enabled, the DS1629 does draw quite a lot of current when performing
continous sampling. Disable this feature by setting bit 0 and bit 2 in the
Configuration/Status register to zero. Disable also the frequency output which
is nice for adjusting the capacitor but needs some power, too.
The voltage from GND to the battery itself and the voltage between GND and the
diodes' D1/D2 cathodes should almost be identical. A difference of 0.3..0.4V is
an indicator for "high" current to the DS1629.

@ENDNODE


@NODE "Software" "Using the software"

@{b}Using the software@{ub}
==================

There is a file called "i2c.library" included with this archive, which is a
special new implementation of the well-known I2C access library from Aminet.
Copy it to your LIBS: directory.

To learn more about i2c.library and what it can do for you, it is a good
idea to obtain the whole package (hard/hack/i2clib40.lha on Aminet). It
comes with programmer's documentation and sample code, and some CLI
utilities (SendI2C, ReceiveI2C, I2Cscan) for the more casual user.

There are just a few things worth noting which you won't learn from the
i2clib40 documentation (which hasn't been updated yet to cover the ICY
hardware):

* The "I2CDELAY" environment variable has a special meaning for this
  library:

  I2CDELAY value | SCL speed
  ---------------+----------
    0            |  90 kHz
    1            |  45 kHz
    2            |  11 kHz
    3 or higher  | 1.5 kHz

* The library assumes that your interface board is running on a 12 MHz
  crystal, unless you set another environment variable, called "I2CXTAL".

  I2CXTAL value | use with quartz at...
  --------------+----------------------
    3           |    3 MHz
    4           | 4.43 MHz
    6           |    6 MHz
    8           |    8 MHz

  All other values are ignored so that, again, a 12 MHz quartz is assumed.

  Note that setting I2CXTAL to a lower quartz frequency than the one that
  you actually use in hardware, will yield higher SCL speeds than indicated
  by the I2CDELAY table above. This may lead to transmission errors, if you
  exceed the 100 kHz that the I2C specification allows.
  @{u}Rememeber@{uu}: overclocking the PCF8584 is @{b}NOT@{ub} recommended !

* Beware of old-style (i2clib39) application programs that ignore the
  I2CDELAY env variable and force i2c.library to use a different delay
  value. This problem isn't actually new, but it can be particularly
  annoying with the ICY hardware.

  For example, you should make sure that Wilhelm Noeker's VideoText is set
  to BUSDELAY=0 in its icon tooltypes. Otherwise it will use a value of 1 or
  even 5 by default, forcing SCL down to 45 kHz or even 1.5 kHz respectively.

@ENDNODE


@NODE "History" "What has happened till now ..."

@{b}History:@{ub}
=======

V1.0: - first public release of ICY in Aminet
      - Eagle PCB layout finished

V0.2: - second prototype board
      - changed XRDY to /OVR
      - added drivers for both address and data lines

V0.1: - first prototype board
      - first unsuccessful tests with XRDY

@{b}Tested systems:@{ub}

* Amiga 2000, OS2.04, MC68000 (7.14MHz)
* Amiga 4000, OS3.0 / OS3.1, MC68040 (25MHz)

@{b}Boards working with ICY:@{ub}

* CyberVision64-4 (phase5)
* Fastlane Z3 (phase5)
* i/o-extender (gvp)
* isdnblaster (vmc)
* ALF232C (bsc)
* 2/8MB board (Ralf Jochheim Computer Tuning)

@{b}@{ub}

@ENDNODE


@NODE "Future" "What will happen in the future ..."

@{b}Things to do:@{ub}

-> test ICY on as many systems as possible
-> get a working driver for the hyperCOM 3i module

Something missing ?
So just send @{"me" LINK "Author"} your ideas. If it is possible, I will try to
realize your improvements.

@ENDNODE


@NODE "Author" "Who made it ?"

@{b}Hardware guru@{ub}

Michael Boehmer
email: michael.boehmer@physik.tu-muenchen.de
WWW:   http://www.e12.physik.tu-muenchen.de/~mboehmer/icy/index.html
snail: Bert-Brecht-Strasse 10
       84032 Altdorf
       Germany

If you are interested in
 * how the autoconfig GAL works
 * getting JEDEC files for both GALs
 * getting an ICY PCB
 * getting parts for ICY
 * anything connected with I2C and ICY
 * producing ICY commercially :))
feel free to contact me.
You can expect the fastest answer by email and the slowest by snail mail.

@{b}Software guru@{ub}

Wilhelm Noeker
email: wnoeker@t-online.de
WWW:   none
snail: Hertastr. 8
       44388 Dortmund
       Germany

Wilhelm is the person to contact if you
 * get software errors
 * are interested in programming with the i2c.library
 * want to see special features in the i2c.library

@ENDNODE

@NODE "Thanks" "Thanks go to ..."

@{b}Thanks go to:@{ub}

  Dave Haynie     - for designing the ingenious Zorro bus system and explaining 
                    details to anyone who's interested in, even half an hour
                    before getting off to Europe :) Thanks, Dave !
  Wilhelm Noeker  - for adapting his i2c.library to my board, though his
                    spare time is limited
  Terry Pratchett - for writing the disc world stories which are real fun to
                    read
  Harald Frank    - for allowing me to use a VMC manufacturer/product id for
                    my ICY board
  Thilo Hacke     - for providing me the CATS documentation on Zorro II
                    autoconfig

@ENDNODE
