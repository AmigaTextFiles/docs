IBMKEY v2.6 (9.6.98)
#####################

Copyright © 1998 Stephen Marsden

Connect a PC keyboard to any Amiga.
Inspired by Eric Rudolph.

If people wish to sell this hack they are free to do so.  It won't
make you rich but it may help tower case manufacturers.


INTRODUCTION
############

This is a small hack I made many months ago and is the original reason
for writing Epic.  It is difficult for me to remember how it works
but I will try my best.  Here goes:

Many A1200 owners have expanded their machines with CD-ROMS and
hard-drives, the only problem being where to put them.  The option of
putting everything in a tower case has appealed to many people but the
most difficult aspect is incorporating a detachable keyboard.  It's
not simply a matter of connecting a A1500 keyboard (you would have to
find one first), but it also needs interfacing to the main motherboard.
Owners of big box Amigas may also be interested in finding a cheap
replacement for a broken keyboard or maybe they would prefer having
a 'clicky' keyboard.

Anyway, this hack allows you to add one of the vast array of cheap PC
keyboards currently available.  I hope someone finds it useful, but
don't blame me if your motherboard goes up in smoke.


KEY ASSIGNMENTS
###############

Many of you will be interested in how the keys are mapped on the PC
keyboard as there are a number of differences to the Amiga's.  So
here goes:

PC                      AMIGA                   NOTE
##                      #####                   ####

L-Ctrl                  L-Amiga                 =Ctrl in Win95 mode.
R-Ctrl                  R-Amiga                 =Ctrl in Win95 mode.
Insert                  R-Amiga & 7             CygnusED
Home                    Shift & Left-Cursor     CygnusED, Reqtools.
End                     Shift & Right-Cursor
Page Up                 Shift & Up-Cursor
Page Down               Shift & Down-Cursor
F11                     \
F12                     Help
Pause/Break             Ctrl-C                  Break CLI commands.
Scroll Lock             )  Keypad
Print Screen            R-Amiga & P             CygnusEd etc.
Num Lock                (  Keypad
Left Win Key            L-Amiga                 Win95 keyboard only.
Right Win Key           R-Amiga                 Win95 keyboard only.
Menu                    L-Amiga & M             Swap Screen (Win95).
Caps Lock               Ctrl                    When 2 keys are pressed.
                                                e.g. Caps & Q=Ctrl & Q
                                                (102-key mode only)

If you have a Win95 keyboard then the keyboard reset is the usual
3 keys but remember that 'W' keys replace the 'A' keys.
With a normal 102-key PC keyboard you press CAPS-CTRL-CTRL to get
the same effect.

In normal 102-key mode the Caps-Lock key works as normal but when
used in combination with another key it will act as the Ctrl key.

Because some of the keys on a PC keyboard have different legends on
their keytops, I have created a keymap to make them work correct with
an Amiga.  This problem is mainly with shifted characters such as
@'~# etc.  Included are keymaps for English and German keyboards.
Just copy them to your 'c:devs/keymaps/' directory.  And select the
one you want using 'c:prefs/input'.

I'm not sure the German keymap works as I don't have a German keyboard.
If someone creates keymaps for other nations then please uuencode me
a copy so that I may include it in further releases.


CONFIGURATION
#############

Once connected, if you press the '*' key on the numeric keypad
20 times you will be able to set up a couple of features.  For this
setup mode to work you will need to be in a text editor as the
keyboard will try to communicate to you by writing to the screen.
The settings are stored in non-volatile memory so you only have
to do this once.

Okay, load up CED or your favourite editor.  Press '*' key 20 times
and you should see:

----------------------------------------------------------------
                                        Notes:
*******************             -> '*' key Pressed 20 times

SELECT TYPE OF KEYBOARD

1= UK 102 KEY                   -> Use 1 & 2 on main keyboard
2= UK 105 KEY WIN95
OK                              -> Make your selection


SELECT TYPE OF RESET

1= FAST RESET
2= SLOW RESET
OK                              -> Make your selection

----------------------------------------------------------------

If you get garbage on the screen then it may be that you pressed
a key while the chip is writing to screen.

The keyboard option allows you to use the new Window '95 keyboards
which have 3 extra keys.  This is probably the best option as the windows
keys are direct replacements for the special Amiga keys.

The slow reset option has been added to cure the booting problem
WB3.0 has with some hard-drives.  When power is switched on to the
Amiga, the slow reset option will allow the hard-drive an extra few
seconds to spin upto speed.  It does this by holding the reset line
low for a few seconds when the machine is first switched on.  This
is not required for WB3.1 ROM's which cures the problem.


INTERFACE (see keyboard.iff)
#########

I've tried to make this as simple as possible but it does require a
skilled hand at soldering.  The number of components is minimal so the
cost should be less than £15 and are readily available from most
electronic stores (Mapin's, Cpc, Rs etc.. )

This design does not require any PCB tracks or chip legs to be cut.
Two resistors are used to prevent conflicts with the original keyboard
CPU.  This means that you can still use the original A1200 keyboard
at the same time as a detachable one.  It must be made clear that this
is a naughty hack but it works fine here.  If the motherboard keyboard
CPU is taken offline then the two interface resistors are not
required.

It is possible to use a 44-pin PLCC to sit on top of 8520 CIA chip.
This is the method I used but a soldered joint will be more reliable
as the socket tries to jump off.

Although this circuit has been made for an A1200 it can be easily
adapted for an A500, A3000, A4000 etc.  Just find the correct pinout
and connect it up as required (47R & 330R resistors not used).  The
big box Amigas may need an external reset switch as I understand
they have reset timer.  Unfortunately I can't test this as I only
have an A1200.

The keyboard requires a 0V and +5V supply which can be taken off the
internal floppy power connector, if you are towerizing your Amiga
you can also take the power directly from the power supply.

If you have mounted your A1200 in a tower case then you may wish to
connect the reset switch between 0V and the motherboard reset.  This
is probably more reliable, this is shown as Pin 38 on IC U13 (the
keyboard MPU), the diagram for this is included on the schematic
keyboard.iff

Keep the wires short between the Amiga and PIC because noise on the
signal lines can cause problems.

If you get lots of ' characters then you probably have the CLK and
DAT lines swapped on the motherboard.



** BEGIN NEW INFO **

If the keyboard does not work at all, and you are quite sure that
you`ve made the circuits (programmer & keyboard interface) and
programmed the PIC chip correctly, you may have a motherboard revision
which is not compatible with the previous project, v2.5, to get around
this incompatibility problem in my case all that was needed was to
disable the keyboard MPU. (IC U13 on schematic)
To disable the MPU all that is needed is to disconnect pins 13 and
14 of the IC (U13), the cutting can be done with a sharp scalpel, it
is possible as the legs are quite thin and cut quite easily, once cut,
make sure that they are NOT shorting out with any other legs connected,
this could do untold damage.
Other methods of cutting or desoldering may be tried, but it is
best to find a method which is easily reversable.

A diagram of the keyboard MPU illustrating which legs need to be cut
is included within the schematic (keyboard.iff) included within this
archive.

Pin 38 of U13 - if this pin is connected to a 0v/Gnd (tower casing etc..)
source it will act as a reset switch for the Amiga, this can be done
using the reset switch in the tower.
Connect one pin of the switch to 0v/Gnd and the other to pin 38 of
U13..and you should now be able to reset your computer using the switch.


Completed Upon : A1200 - motherboard revision 1B
Status         : Keyboard Working perfectly, Reset switch operational

** END NEW INFO **


Amiga keyboards are meant to send a reset warning code to the
computer but I don't think I got it to work properly.  I can only
think of one program that uses it anyway.  Maybe I'll buy the RKM's
one day to see how it works.

Good Luck!


AUTHOR:     Stephen Marsden
#######

If you want to contact the author of this program then please write
to the following addresses:

email:      Ste@smarsden.demon.co.uk    (Home)
            malobs@oslo.expl.pgs.com    (Work)  Subject: Ste

I work away from home for long periods so try either address and don't
expect a speedy reply.

snail-mail:
            Stephen Marsden
            9 Lumley Road
            Redcar
            Cleveland
            TS10 2BD
            ENGLAND


new info:   
            Vaughn Tovey


email:      Vatovey@Glam.Ac.Uk    (Uni)
            Vatovey@Usa.Net       (Net)

