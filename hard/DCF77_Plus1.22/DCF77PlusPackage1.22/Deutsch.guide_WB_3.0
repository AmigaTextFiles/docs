@database DCF77PlusPackage
@$VER: 1.08
@author "Peter Reibold"
@(c) "1997 by Peter Reibold"

@node "Main" "The DCF77 Plus Package"
                         @{b}The DCF77 Plus Package V1.22@{ub}

                             Die "billige" Funkuhr
                           =========================

                          © 1996-97 by Peter Reibold

	       	                @{" Was ist neu? " link "New" 0}

                       @{"           Einführung            " link "Introduction" 0}
                       @{"          Installation           " link "Installation" 0}
                       @{"      Benutzen der Software      " link "Using" 0}
                       @{"         Fehlermeldungen         " link "Errors" 0}
                       @{"  Beschreibung des DCF-Signals   " link "Description" 0}
                       @{"         Bau der Hardware        " link "Hardware" 0}
                       @{"       Systemanforderungen       " link "System" 0}
                       @{"          Danksagungen           " link "Credits" 0}
                       @{"      Entstehungsgeschichte      " link "History" 0}
                       @{"       Copyright & Haftung       " link "Copyright" 0}
@endnode

@node "New" "Was ist neu?"

  @{b}@{u} Was ist neu? @{ub}@{uu}

Es wurde ein kleiner Fehler bereinigt. Nun wird beim Programmende das
benutzte Device ordentlich @{b}geschlossen@{ub} und steht für andere Anwendungen
zur Verfügung.

Außerdem wurde die @{b}Numerierung@{ub} der Bauteile berichtigt (C2 war doppelt vor-
handen) und ein @{b}Schaltplan@{ub} für die freie Verdrahtung hinzugefügt.

@endnode

@node "Introduction" "Einführung"

  @{b}@{u} Einführung @{ub}@{uu}

DCF77Plus ist ein Paket, das dem Amiga-Benutzer erlaubt, auf sehr einfache
und kostengünstige Weise eine genaue Systemzeit zu erhalten.

Dies geschieht mittels eines Hardwarezusatzes und der dazugehörigen
Software. Die Einbindung kann zum Beispiel beim Start des Computers in der
WBStartup geschehen.

Der Vorteil des Paketes ist, dass man nicht auf kommerzielle Produkte
angewiesen ist und der Eigenbau oftmals günstiger ist.

Bei der Realisation dieses Projektes wurde auf die Schaltung zu Atom-
uhr V1.2 von Stefan Glükler, Chur/Schweiz, zurückgegriffen. Dabei
wurde die Schaltung aber so abgeändert, dass sie die Stromversorgung
direkt vom seriellen Port bezieht und mit aktuellen DCF-Modulen
zusammenarbeitet.
@endnode

@node "Installation" "Installation"

  @{b}@{u} Installation @{ub}@{uu}

Die fertige Hardware von DCF77Plus wird ganz einfach an den seriellen Port
bzw. an den Joystickport 2 des ausgeschalteten Amiga angeschlossen und das
Programm DCF77Plus in ein beliebiges Verzeichnis kopiert; am besten wäre
das ´WBStartup´ Verzeichnis.

Außerdem ist darauf zu achten, dass folgende Dateien im C: Verzeichnis
vorhanden sind:

- Date

- Setclock

Diese Dateien sind nötig, um ein einwandfreies Setzen der Uhrzeit zu
gewährleisten.

Sobald der Rechner eingeschaltet wird, sollte die Funktion des
Empfängerbausteines getestet werden: Die LED sollte etwa im Sekundentakt zu
blinken beginnen, was im Normalfall die empfangenen Datenbits anzeigt.

Sollte dies nicht der Fall sein, kann das mehrere Ursachen haben:

- Sie haben die Hardware nicht richtig zusammengebaut.

- Die Empfängerplatine mit der Ferritantenne liegt zu dicht am Computer
  oder Monitor, was einen störenden Einfluss hat. Ein Abstand von 2,5
  Metern sollte aber ausreichen.

- Verändern Sie die Richtung der Ferritantenne um die richtige
  Empfangsrichtung festzustellen.

Die Funktionstüchtigkeit der Software kann zusätzlich noch mit dem Programm
@{u}DCF77Plus_Check@{uu} getestet werden. Bei diesem Programm werden alle Datenbits
des Zeittelegramms dargestellt. Zusätzlich ist darüber eine kurze
Beschreibung der einzelnen Bits. Sollten bei der Übertragung und Deko-
dierung der Datenbits Fehler auftreten, so wird dies angezeigt.

@endnode

@node "Using" "Benutzen der Software"

  @{b}@{u} Benutzen der Software @{ub}@{uu}

DCF77Plus wird ganz einfach durch einen Doppelklick auf das Icon aufgerufen.
Am einfachsten ist es, wenn man das Programm in das @{u}WBStartup@{uu}-Verzeichnis
kopiert; so wird es bei einem Neustart automatisch aufgerufen.

Die beiden Programme @{u}DCF77Plus@{uu} und @{u}DCF77Plus_Check@{uu} können über Einträge in
den Merkmalen/Tooltypes der Icons konfiguriert werden.

Es stehen dabei folgende Tooltypes zur Verfügung:

	@{b}DEVICE=@{ub}		Zur Angabe des Device-Namens, ohne Angabe wird
			das serial.device verwendet.

                        Steckt die Hardware am Joystickport 2, so muss als
                        Device gameport.device angegeben werden.

	@{b}UNIT=@{ub}		Zur Angabe der Unit-Nummer, voreingestellt ist 0.

                        Bei Betrieb am Joystickport gibt die eingestellte
                        Unit den Pin an, an dem die Datenleitung ange-
                        schlossen ist.

        @{b}REVERSE=@{ub}        Soll das Datensignal invertiert werden, muß
                        hier ON stehen. Default ist OFF. Ob man auf ON
                        stellen sollte, sieht man am besten beim Programm
                        DCF77Plus_Check: Tauchen dort unter time Werte von
                        ca. 100 bzw. 200 auf (statt normal ca. 800 bzw. 900),
                        so stellt man REVERSE=ON ein.

Beim Programm DCF77Plus gibt es zusätzlich folgende:

	@{b}PRIORITY=@{ub}	Setzt die Priorität des Programmes. Sie ist im
         		Defaultfalle 0. Um eine Systembelastung auszuschlie-
         		ßen sollten negative Werte verwendet werden.

	@{b}DEBUG=@{ub}		Schaltet den Debugmodus ein.
	  		0  Debugmodus aus.
			1  Der Bildschirm blinkt auf, wenn die Systemzeit
			   aktualisiert wurde.
                        2  Wie 1, jedoch blinkt der Bildschirm auch dann,
                           wenn der Synchronisationsimpuls am Anfang des
                           Zeittelegramms empfangen wird.
                        3  Sie werden über jedes empfangene Signal des
                           Zeittelegramms ab dem Synchronimpuls informiert.

	@{b}DELTA=@{ub}		Definiert eine Zeitkorrektur. Zur ermittelten Zeit
			werden x Stunden addiert (x kann auch negativ sein.)
			Dies ist nützlich, falls die Software an eine
			bestimmte Zeitzone angepasst werden soll.

	@{b}SOUND=@{ub}		Hier kann ein IFF-Soundfile angegeben werden,
			welches nach Setzen der Systemzeit abgespielt
			wird.

	@{b}DONOTWAIT@{ub}	Dieses Schlüsselwort sollte zusätzlich einge-
			tragen werden, damit beim Starten der Workbench
			nicht auf die Beendigung des Programmes ge-
			wartet wird.

@{b}Beispiele@{ub}

DEVICE=serial.device
UNIT=0
PRIORITY=-1
DEBUG=1
DELTA=-1
SOUND=SYS:Prefs/Sounds/ping.iff
DONOTWAIT

Hier wird die Hardware mittels serial.device unter UNIT 0 abgefragt
(Die normale serielle Schnittstelle des Amiga).
Das Programm wird als Hintergrundtask mit der Priorität -1 gestartet.
Nach erfolgter Aktualisierung der Systemzeit blitzt der Bildschirm einmal
kurz auf, um das Programmende zu signalisieren und das angegebene
IFF-Soundfile wird abgespielt. Die Systemzeit entspricht
der empfangenen Zeit minus eine Stunde (z. B. in Großbritannien).

Um einen Betrieb am Joystickport 2 über Pin 6 zu gewährleisten ist
beispielsweise folgendes nötig:

DEVICE=gameport.device
UNIT=6
@endnode

@node "Errors" "  Fehlermeldungen  "

  @{b}@{u} Fehlermeldungen während der Ausführung @{ub}@{uu}

Während das Programm DCF77Plus ausgeführt wird, können folgende Fehler-
meldungen auftreten:

 @{i}No DCF77 signal.@{ui}         Dies gibt an, dass 5 Minuten vergeblich auf den
                          Beginn des Zeittelegrammes gewartet wurde.
                          Das Programm kann nun abgebrochen werden.

 @{i}Error receiving signal.@{ui}  Dies bedeutet, dass über einen längeren Zeitraum
                          fehlerhafte Daten empfangen wurden und nicht
                          mehr mit einem einwandfreien Empfang zu rechnen
                          ist.
                          Auch hier kann das Programm abgebrochen werden.

 @{i}Error opening device.@{ui}    Das Device bzw. das Unit wurde falsch angegeben
                          bzw. ist nicht vorhanden und kann nicht geöffnet
                          werden.
                          Das Programm wird abgebrochen.

 @{i}Soundfile not found.@{ui}     Das angegebene Soundfile wurde falsch angegeben
                          bzw. ist nicht vorhanden und kann nicht abge-
                          spielt werden.
                          Das Programm wird ohne Abspielen beendet.



 @{b} Lösung:@{ub} Im @{u}ersten@{uu} Fall sollte man zuerst überprüfen, ob die Hardware
          richtig funktioniert: Siehe @{"Installation" link "Installation" 0}. Außerdem kann man
          versuchen, die Ausrichtung der Ferritantenne so zu verändern,
          dass ein Signal empfangen wird (LED blinkt und bleibt nicht nur
          entweder an oder aus!).
          Im @{u}zweiten@{uu} Fall kann man versuchen, die Entfernung des Empfangs-
          modules von elektrisch-störenden Geräten (z.B. Computer,
          Monitor o.ä.) zu vergrößern um so die Empfangseigenschaften
          zu verbessern.
          Im @{u}dritten@{uu} und @{u}vierten@{uu} Fall sollte man die Einstellungen in den
          Tooltypes ansehen und gegebenenfalls berichtigen.

@endnode

@node "Description" "  Beschreibung des DCF-Signals  "

  @{b}@{u} Der Aufbau des DCF-Signals @{ub}@{uu}

Das DCF-Signal wird von der Physikalisch Technischen Bundesanstalt in
Braunschweig erzeugt. Ausgestrahlt wird dieses Signal von einem Sender in
Mainflingen bei Frankfurt. Dieser sendet auf der Frequenz 77,5 kHz, weshalb
man auch DCF77 dazu sagt.

Innerhalb von einer Minute wird das sogenannte Zeittelegramm ausgestrahlt.
Es setzt sich aus einer Folge von Low- und High-Bits zusammen. Diese Bits
werden durch eine im Sekundentakt erfolgende kurzzeitige Absenkung der
Amplitude auf 25 % übertragen. Sind diese Absenkungen kürzer als 120 ms so
handelt es sich um ein Low-Bit (0); bei mindestens 180 ms handelt es sich um
ein High-Bit (1).

Zur Synchronisation dient das 59. Bit, bei dem keine Sekundenmarke
ausgesendet wird, und das 0. Bit, welches Low-Signal hat. Nun weiss man
genau, dass die Sekunden bei 00 sind. Man kann nun beginnen, die erforder-
lichen Daten-Bits zu empfangen und zu dekodieren.

Das gesamte Zeit-Telegramm setzt sich wie folgt zusammen:

@{u} Bit   Bedeutung                Wert @{uu}

 0      Minutenbeginn
 1-14   nicht benutzt
 15     bei "Hi" ist Reserveantenne in Betrieb
 16     ist "Hi" 1 Stunde vor Zeitumstellung
 17     ist "Hi" bei Sommerzeit (MESZ)
 18     Zeitzonen-Bit, immer "Lo"
 19     ist "Hi" 1 Stunde bevor Schaltsekunde eingefügt wird
 20     Telegrammbeginn, immer "Hi"
 21     Minute (Einer)            1
 22         "                     2
 23         "                     4
 24         "                     8
 25     Minute (Zehner)          10
 26         "                    20
 27         "                    40
 28     Prüfbit (ergänzt auf gerade Parität)
 29     Stunde (Einer)            1
 30         "                     2
 31         "                     4
 32         "                     8
 33     Stunde (Zehner)          10
 34         "                    20
 35     Prüfbit (ergänzt auf gerade Parität)
 36     Kalendertag (Einer)       1
 37         "                     2
 38         "                     4
 39         "                     8
 40     Kalendertag (Zehner)     10
 41         "                    20
 42     Wochentag                 1
 43         "                     2
 44         "                     4
 45     Monat (Einer)             1
 46         "                     2
 47         "                     4
 48         "                     8
 49     Monat (Zehner)           10
 50     Jahr (Einer)              1
 51         "                     2
 52         "                     4
 53         "                     8
 54     Jahr (Zehner)            10
 55         "                    20
 56         "                    30
 57         "                    40
 58     Prüfbit (ergänzt auf gerade Parität)
 59     keine Marke
@endnode

@node "Hardware" "Hardware"

  @{b}@{u} Bau der Hardware @{ub}@{uu}

Die Hardware besteht im Wesentlichen aus dem fertigen DCF-Modul und der
Anpassungsplatine. Die Anpassungsplatine kann mit Hilfe der folgenden
Liste gebaut werden:


                         @{"      Layout     " link "Layout" 0}
                         @{" Benötigte Teile " link "Parts" 0}
                         @{"      Aufbau     " link "Construction" 0}

@endnode
@node "Layout" "Layout"

  @{b}@{u} Ausdrucken des Layouts @{ub}@{uu}

Für die Platine kann man sich aus dem Layout-Verzeichnis die zum Drucker
passende Datei aussuchen und mit dem Copy-Befehl an den Drucker senden.
Es sind folgende Ausgabedateien vorhanden:

- Star24PinPrinter für Star 24-Nadel-Drucker
- 24PinPrinter     für 24-Nadel-Drucker
- 9PinPrinter      für 9-Nadel-Drucker
- Epson_Ink        für Epson Tinten-Drucker
- HP_Ink           für Hewlett Packard Tinten-Drucker
- Laser            für Laser-Drucker


Diese müssen direkt über den Parallelport an den Drucker gesendet werden.
Das geht ganz einfach durch einen Doppelklick auf die entsprechende
Datei. Dabei wird das im gleichen Verzeichnis befindliche Programm
@{u}ParPrint@{uu} aufgerufen, welches die Übertragung vornimmt.

Alternativ kann man auch im CLI eingeben:

 @{i}copy FileName par:@{ui}

Also z.B.:

 @{i}copy Epson_ink par:@{ui}
@endnode

@node "Parts" "Benötigte Teile"

  @{b}@{u} Es werden folgende Teile benötigt: @{ub}@{uu}


- DCF-Modul: Nr. 641138 von Conrad (ca. 20 DM)

- für die Anpassungsplatine:

    - Fotobeschichtete Platine
    - IC1:     74 HC 14 N  (Schmitt-Trigger)
    - IC2:     78 L 05     (5V Spannungsregler)
    - D1:      LED
    - R1:      100 kOhm
    - R2:       15 kOhm
    - R3       470  Ohm
    - C1, C3:  100 nF
    - C2:        1 µF

- außerdem ein 3-adriges Anschlusskabel und eine 25-polige Sub-D-Buchse
  für den Anschluss am seriellen Port.

- eventuell ein Gehäuse (z.B. Conrad Nr. 522244, nur 53x37x20mm groß
                         und mit Aufhängelasche)

Insgesamt kommt man so auf etwa 30 DM.
@endnode

@node "Construction" "Aufbau"

  @{b}@{u} Schaltungsaufbau @{ub}@{uu}

Beim Nachbau der Schaltung orientiert man sich am besten am Schaubild,
wie es in der Datei @{i}DCF77Plus.iff@{ui} dargestellt ist.
Wie man sieht, ist der Aufbau nicht problematisch. Will man für C2
einen Elko verwenden, sollte man darauf achten, dass der Masseanschluss
zum Platinenrand zeigt.
Hier sieht man auch, wie die Platine mit dem DCF-Modul verbunden
werden muss.

Soll der Anschluss statt über den seriellen Port über den Joystickport 2
erfolgen, so hat man folgende Möglichkeiten, die Datenleitung anzu-
schließen:

- Pin 1 (oben)
- Pin 2 (unten)
- Pin 3 (links)
- Pin 4 (rechts)
- Pin 6 (Feuer)

In diesem Falle kann natürlich auch der Spannungsregler 78 L 05 wegfallen,
da der Port schon 5V liefert. Die Anschlüsse müssen dann aber überbrückt
werden (der rechte und der linke Spannungsregleranschluss müssen verbunden
werden). Die Betriebsspannung am Joystickport liegt an den Pins 7 (+5V)
und 8 (Gnd, Masse).

Die fertig aufgebaute Platine und wie man sie komplett mit dem DCF-Modul
in ein Gehäuse einbauen kann, sieht man auf den Bildern im @{u}Pictures@{uu}-
Verzeichnis.

Wenn das DCF-Modul nicht zu bekommen ist oder man bereits ein
anderes hat, kann man natürlich dieses verwenden. Man muss aber auf die
Betriebsspannung achten (hier 5V). Ob das Ausgangssignal positiv oder
negativ ist, hat keine Bedeutung. Gegebenenfalls muss die Software
mit dem Tooltype REVERSE angepasst werden.
@endnode

@node "System" "Systemanforderungen"

  @{b}@{u} Systemanforderungen @{ub}@{uu}

Das DCF77 Plus Package läuft auf allen Amigas ab der Kickstart-
Version 2.0.

Es wurde erfolgreich auf einem Amiga 500 mit Kickstart 2.1, auf einem
Amiga 4000 mit Kickstart 3.1 und auf einem Amiga 4000 mit Kickstart 3.0
und Multifacecard III getestet.

Um den Guide lesen zu können, sollten 2.X-Benutzer das Standardprogramm
im Icon durch @{u}Amigaguide@{uu} ersetzen.

Bei den Bildern sollte das Standardprogramm durch @{u}Display@{uu} ersetzt
werden.
@endnode

@node "Credits" "Danksagungen"

  @{b}@{u} Danksagungen @{ub}@{uu}

Dank an:

- David Benn für ACE 2.4, mit dem dieses Programm geschrieben wurde.

- Dirk Düsterberg für das Platinenlayout.

- Marcel Döring für das MagicWB Icon und Verbesserungsvorschläge.

- Domenic Gebauer fürs Beta-Testen.

- Andreas Heinrich für Fehlerhinweise.

@endnode

@node "History" "Entstehungsgeschichte"

  @{b}@{u} Entstehungsgeschichte @{ub}@{uu}

- @{u}Version 1.00 (20.10.1996)@{uu}

  Erste Veröffentlichung des Programmpaketes.

- @{u}Version 1.10 (05.03.1997)@{uu}

  Im Gegensatz zu früher wird das Programm DCF77Plus nicht mehr von der
  User-Startup gestartet sondern einfach in das Verzeichnis @{b}WBStartup@{ub}
  des Startlaufwerkes kopiert.

  Die Konfiguration erfolgt nicht mehr über Kommandozeile sondern komfortabel
  über @{b}Tooltypes@{ub}.

  Die Hardware wird nun über Device und Unit angesprochen, somit ist der
  Betrieb an zusätzlichen @{b}I/O-Karten@{ub} möglich.

  Es kann nun beim Setzen der Zeit ein @{b}Sound@{ub} ausgegeben werden.

- @{u}Version 1.20 (01.05.1997)@{uu}

  Neu hinzugekommen ist die Anschlussmöglichkeit über den @{b}@{b}Joystickport 2@{ub}.

- @{u}Version 1.21 (04.05.1997)@{uu}

  Das Datensignal kann nun auch @{b}invertiert@{ub} vorliegen. Die Anpassung wird
  mit dem Tooltype REVERSE eingestellt.

- @{u}Version 1.22 (29.09.1997)@{uu}

  Ein Fehler beim @{b}Schließen@{ub} des Device wurde behoben.
  Die @{b}Bauteilenumerierung@{ub} ist nun richtig.
  Ein @{b}Schaltplan@{ub} für freie Verdrahtung wurde hinzugefügt.

@endnode

@node "Copyright" "Copyright & Haftung"

  @{b}@{u} Copyright @{ub}@{uu}

Copyright © 1996-97 by Ernolto Electronics
                       c/o Peter Reibold
                       Ottberger Weg 13
                       D-31737 Rinteln

             Email:    Peter.Reibold@t-online.de
             Homepage: http://www.stud.uni-hannover.de/~peterr


DCF77 Plus ist Freeware. Es darf uneingeschränkt benutzt werden, solange die
enthaltenen Dateien nicht verändert oder dekompiliert werden.
Ich würde mich freuen, wenn mir Benutzer eine Karte oder Email schicken
würden.

Alle dazugehörigen Dateien dürfen nur im kompletten Paket weitergegeben
werden.

Fragen, Anregungen oder Hinweise werden gern entgegengenommen.


  @{b}@{u} Haftungsausschluss @{ub}@{uu}

Die in dieser Anleitung enthaltenen Informationen werden ohne jegliche
Gewährleistung bezüglich der Anwendung, der Ergebnisse oder des Nutzens
dieser Informationen, ihrer Eignung, Genauigkeit, Zuverlässigkeit oder
Aktualität zur Verfügung gestellt. Alle möglichen Risiken hinsichtlich der
Verwendung dieser Informationen werden vom Anwender übernommen. Der Autor
haftet unter keinen Umständen für irgendwelche direkten, indirekten oder
zufälligen Schäden. Dieser Haftungsausschluss ersetzt alle gegenteilig
lautenden mündlichen oder schriftlichen Erklärungen.
@endnode

