
 2. Описание электрической принципиальной схемы модуля расширения памяти


  Разработка электрической принципиальной схемы сводится к реализации
отдельных блоков функциональной схемы, соединений между блоками и
дополнительных соединений, обеспечивающих работу элементов в нужном режиме.

  Чертеж электрической принципиальной схемы приведен в приложении (1лист А4)
и на плакате (1 лист А1).

  Данная схема построена на базе системной шины ПК "Amiga500", которая
включает в себя системную шины микропроцессора 68000 (описанную выше)
и дополнительные управляющие сигналы. К использующимся дополнительным
управляющим сигналам относятся следующие сигналы:
 
* CDAC- сигнал, повернутый на 90( относительно сигнала частоты микропроцессора
  68000 (CPUCLK), то есть фронты этого сигнала отстают на 70нс относительно
  CPUCLK;
* /OVR- сигнал, который в активном состоянии позволяет отменить дешифрацию
  определенных адресных пространств внутри ПК "Amiga500" (этот сигнал
  используется при установке ПЛМ FX740LC68);
 
  Работа схемы начинается со сброса (/RESET), приводящего к очистке флага
прерывания, который вырабатывается на выходе триггера микросхемы DD12.2.
Также при сбросе происходит установка RS-триггера, сформированного на базе
микросхем DD3.5,DD3.6,DD5.3,DD5.4 (КР1533ЛН1, КР1533ЛИ1), которая приводит
к выборке системного ПЗУ по любому адресному пространству до первой выборки
самого ПЗУ. Это необходимо для выборки вектора сброса по относительному
смещению $000004  в системном ПЗУ, а не из оперативной памяти. 

  Дальнейшая необходимая инициализация нужных триггеров схемы происходит за
счет начального высокого (неактивного) уровня на входе /AS после сброса
ПК "Amiga500". После этого блок дешифрации адресов входит в состояние
ожидания активного низкого уровня сигнала выборки адреса (/AS).
 

  Блок дешифрации адресов реализован на микросхемах DD1, DD2.1, DD2.2
(КР1533ИД7, КР1533ЛИ1). 

  Дешифратор DD1 разбивает 16Мб адресное пространство на 8 частей по 2Мб
каждая: $000000-$1FFFFF, $200000-$3FFFFF, $400000-$5FFFFF, $600000-$7FFFFF,
$800000-$9FFFFF, $A00000-$BFFFFF, $C00000-$DFFFFF, $E00000-$FFFFFF. Это
позволяет уменьшить количество дешифраторов в других модулях схемы. Сигналы
выборки двух последних адресных пространств поступают с выхода микросхемы DD1
в контроллер НЖМД и блок управления ПЗУ. 

  Логические вентили DD2.1 и DD2.2 объединяют четыре адресных пространства
$200000-$3FFFFF, $400000-$5FFFFF, $600000-$7FFFFF, $800000-$9FFFFF в два
$200000-$5FFFFF, $600000-$9FFFFF по 4Мб, используемые затем контроллером
динамической памяти. Переключатель с фиксацией, обозначенный на схеме как
KN1, в замкнутом положении позволяет отключить дешифрацию всех адресных
пространств микросхемой DD1, что приводит к аппаратному отключению всех
блоков схемы от ПК "Amiga500".

 
  Контроллер НЖМД реализован на микросхемах DD2.4, DD4.3, DD4.4, DD10-DD13
(КР1533ЛИ1, КР1533ЛЛ1, КР1533ИД7, КР1533ИД14, КР1533ТМ2, КР1533ЛП8).

  Сигнал /С0, поступающий с блока дешифрации адресов, поступает на дешифратор
DD10, который выделяет 64кб адресное пространство ($DA0000-$DAFFFF) из 2Мб
адресного пространства. 

  Для активизации сигналов (/CS0 и /CS1) при обращении к портам НЖМД
необходимо еще более узкое адресное пространство, что и выполняет дешифратор
DD11.1 и триггер DD12.1(он обеспечивает требуемую задержку сигнала /CS0 в
активном низком уровне относительно сигналов /IOW и /IOR). Сигнал /CS0
становится активным при обращении к адресам $DA2000-$DA2FFF,сигнал /CS1 при
$DA3000-$DA3FFF. 

  Сигналы /IOR и /IOW формируются на выходе дешифратора DD11.2 при чтении или
записи по адресам $DA0000-$DA3FFF. С выхода микросхемы DD4.3 поступает сигнал
записи в регистр (триггер DD12.2) флага прерывания. Этот сигнал сбрасывает
триггер, что приводит к деактивации сигнала прерывания /INT2, подключенного к
системной шине ПК "Amiga500".

  Чтение регистра флага прерывания осуществляется при активном низком уровне
на выходе микросхемы DD4.4. При этом информация о состоянии флага прерывания
поступает на шину данных по линии D15 при чтении с адресов $DA9000-$DA9FFF.
Установка флага прерывания происходит по положительному перепаду сигнала IRQ,
который приходит с разъема НЖМД на вход 11 триггера DD12.2.

  Конденсатор С1, служит для устранения помех по линии IRQ. Через резистор R2
сигнал IRQ соединен с шиной земли, что обеспечивает уровень логического нуля
при отсоединении НЖМД.

  Элемент DD13.1 выполняет функции буфера с третьим состоянием на выходе, тем
самым предотвращая возможные конфликты на шине данных.

  Элемент DD13.2 обеспечивает состояние открытого коллектора на линии /INT2. 

 
  Контроллер динамической памяти реализован на микросхемах DD2.3,DD3.1-DD3.4,
DD4.1,DD4.2,DD5.1,DD5.2,DD6-DD9,DD13.1 (КР1533ЛИ1, КР1533ЛН1, КР1533ЛЛ1,
КР1533ТМ2, КР1533ЛП8, КР1533ИД14).

  В контроллер поступают два сигнала с блока дешифрации адресов, из которых с
помощью элемента DD2.3 образуется сигнал выборки памяти /RAMSEL, отвечающий за
выборку адресного пространства всех 8Мб памяти ($200000-$9FFFFF). Триггер
DD6.1 обеспечивает защелкивание сигнала  /RAMSEL на третьем такте процессора,
что достигается за счет очередного отрицательного перепада. Это позволяет
получить сигнал (/RASC) на выходе этого триггера от середины третьего такта
МС68000 до конца сигнала /AS.

  Сигнал /RASC участвует в формировании сигналов, отвечающих за выборку строки
в модуле динамической памяти. Середина третьего такта МС68000 является таким
образом началом цикла чтения/записи динамической памяти. 

  С помощью элементов DD3.3-DD3.4, DD13.3 обеспечивается формирование сигнала
ADR_SW. Оно происходит за счет задержки сигнала /RASC, которая требуется для
отставания фронта переключения адресов в блоке мультиплексоров относительно
сигналов выборки строки (/RAS1, /RAS0). Следующим фронтом CDAC (положительным)
происходит защелкивание низкого уровня на триггере DD6.2. В результате на
выходе этого триггера формируется сигнал /RASC длительностью от начала
четвертого такта до конца сигнала /AS (конца шестого такта).

  Сигнал /CASC участвует в формировании сигналов /CAS0, /CAS1, /CAS2 и /CAS3,
которые отвечают за выборку столбца динамической памяти. 

  В данной схеме применена регенерация памяти типа "0 wait states"
(регенерация без циклов ожидания ЦП, что позволяет сделать быстродействие
памяти (не менее 70нс). требует постоянной регенерации, циклы которой
происходят с частотой сигнала REGCLK, поступающего со старшего разряда
счетчика DD20.

  Этот счетчик обеспечивает деление частоты Е на 128. При достижении
счетчиком единицы в старшем разряде (REGCLK) происходит защелкивание этой
единицы в триггере DD7.1 с очередным отрицательным перепадом сигнала CDAC
(частотой 7МГц). При этом на прямом выходе триггера происходит перепад сигнала
из низкого уровня в высокий. Этот выход подключен к входу сброса счетчика
DD20. В результате подачи высокого уровня напряжения на этот вход происходит
сброс счетчика в ноль.

  На инверсном выходе DD7.1 формируется одиночный отрицательный импульс
длительностью в один такт ЦП (140нс), который с помощью микросхемы DD9
активизирует все сигналы /CAS, начиная при этом цикл регенерации динамической
памяти. Проходя через триггер DD7.2, сигнал сдвигается на пол такта ЦП, и
полученный сигнал с помощью элементов DD5.1 и DD5.2 активизирует все сигналы
/RAS. При этом обеспечивается регенерация методом /CAS перед /RAS. Регенерация
происходит во время отсутствия активного низкого уровня сигнала /AS, то есть
регенерация происходит между циклами обращения к памяти. 

  Подключаемый блок памяти имеет 32 линии данных, которые разбиты на 4 группы
по 8 бит, каждая из которых активизируется своим сигналом /CAS. Поэтому
возможно по парное объединение линий в одну 16-разрядную. За активизацию
соответствующих пар сигналов /CAS отвечает дешифратор DD8. Сигналы /UDS и
/LDS, приходящие на его вход, обеспечивают чтение/запись старшего или младшего
байта данных 16-разрядной шины, или их выдачу одновременно. Более подробно это
показано в табл.2.1.
 
 
 Таблица2.1

  Распределение сигналов выборки памяти

-----------------------------------------
|  $800000-$9FFFFF  |  $400000-$5FFFFF  |
-----------------------------------------
| /UDS    | /LDS    | /UDS    | /LDS    |
|---------|---------|---------|---------|
| /RAS1   | /RAS1   | /RAS0   | /RAS0   |
| /CAS3   | /CAS2   | /CAS3   | /CAS2   |
| D31-D24 | D23-D16 | D31-D24 | D23-D16 |
-----------------------------------------

-----------------------------------------
|  $600000-$7FFFFF  |  $200000-$3FFFFF  |
-----------------------------------------
| /UDS    | /LDS    | /UDS    | /LDS    |
|---------|---------|---------|---------|
| /RAS1   | /RAS1   | /RAS0   | /RAS0   |
| /CAS1   | /CAS0   | /CAS1   | /CAS0   |
| D15-D08 | D07-D00 | D15-D08 | D07-D00 |
-----------------------------------------

  Микросхемы DD16-DD18 обеспечивают мультиплексирование адресов с системной
шины адреса с помощью сигнала ADR_SW, активизирующегося между подачей сигналов
/RAS и /CAS. При высоком уровне сигнала ADR_SW происходит защелкивание адреса
строки динамической памяти отрицательным фронтом сигнала /RAS, а в низком -
защелкивание столбца динамической памяти отрицательным фронтом сигнала /CAS.

  Резисторы R3-R18 обеспечивают электрическое согласование выходов
мультиплексоров со входами модуля динамической памяти.

 
  Блок управления ПЗУ реализован на микросхемах,DD13.3(КР1533ЛН1, КР1533ЛИ1,
КР1533ЛП8).

  Собранный на элементах DD3.5,DD3.6,DD5.3,DD5.4 (КР1533ЛН1, КР1533ЛИ1)
RS-триггер после сброса обеспечивает формирование сигнала, который отвечает
за выбор вектора сброса с адреса $000004 не из встроенной в ПК"Amiga500"
графической памяти, а из системного ПЗУ. Это обеспечивает перевод элемента
DD13.3 в третье состояние. В результате выход /ROM_OE притягивается резистором
к общему выводу, что обеспечивает выборку вектора сброса ЦП, содержащего адрес
первой команды. Адрес команды находится в адресном пространстве ПЗУ, что
обеспечивает формирование сигнала /Е0 блоком дешифрации адресов при следующем
цикле чтения памяти. Этот сигнал обеспечивает переключение RS-триггера в
рабочий режим, при котором элемент DD13.3 переводит свой вывод /ROM_OE из
третьего состояния в режим пропускания сигнала /Е0.

  Полученный сигнал / ROM_OE поступает на вход разрешения выдачи данных на
шину микросхем DD14-DD15. Вход выборки микросхем соединен с землей, что
обеспечивает постоянную выборку адреса данных к концу шестого такта ЦП.
Сигналы А1-А18 служат для выборки данных внутри адресного пространства
размером 512кб. Сигнал А0 в микропроцессоре МС68000 отсутствует, он
заменяется сигналами /UDS и /LDS при записи. При чтении эти сигналы
использовать не обязательно, так как микропроцессор МС68000 сам защелкивает
нужные данные с шины данных в конце шестого такта. Это позволяет подключить
две 8-разрядные микросхемы ПЗУ к 16-разрядной шине данных и производить
выборку обоих одновременно даже тогда, когда ЦП нужно прочитать 1 байт данных.

  При чтении ПЗУ микросхема DD14 выдает четный (старший) байт данных D15-D8,
а микросхема DD15 - нечетный (младший) байт данных D7-D0. Содержимое микросхем
ПЗУ должно при операции программирования быть разбито по четным и нечетным
частям.

 
  Питание схемы осуществляется напряжением +5В, которое подается через
системного разъема ПК"Amiga500", обозначенного на электрической принципиальной
схеме как Х1.Шина земли подводится с этого же разъема с 11 контактов,
равномерно распределенных по площади разъема. Это сделано с целью уменьшения
помех на шине земли. По той же причине шины земли и +5В проходят рядом и они
более широкие по сравнению с сигнальными проводниками. Конденсаторы С3-С14
установлены вблизи выводов питания микросхем, что устраняет локальные помехи
на этих микросхемах. Питание +12В в схеме не используется, но требуется для
работы НЖМД. 
