
                       Введение.

  Этот архив содержит информацию для сборки платы расширения памяти,
подключения IDE винчестера, нового kickstart для Amiga500 на
основе процессора MC68000. Пользователи A600 тоже могут
собрать эту плату в целях подключения нового kickstart и fast ram,
правда при этом вы не сможете пользоватся pcmcia интерфейсом,
либо сможете, но у вас будет 4мб памяти. Таблица соответствия
системного разъёма A500 и chips А600 приведена в конце этого файла.

  Собранная плата работает сразу после включения amiga и не
требует загрузку никаких драйверов и т.п. в память. Для форматирования
винчестера используется обычный hdtoolbox и обычный scsi.device.
Память реализована по принципу 0 wait states.

                   Возможности схемы.

  Данная схема создавалась на базе более чем трехлетнего опыта создания
устройств для a500/a1200. В предыдущем проекте hard/hack/hddmem.lha
была схема-прототип. Эта схема была упрощена до предела, при котором
некоторые функции были убраны за счет некоторых несущественных
изменений в kickstarte. Также схема была до предела оптимизирована и
в ней стала использоватся новая элементная база - simm 4/8mb.
Автоконфиг не был добавлен за ненадобностью ;-).

  Плата имеет два варианта сборки:
1. 19 микросхем без микросхемы pld dd21. В этом варианте плата имеет
   минимально необходимые для работы возможности и на ней обязательна
   установка kickstart 39.106 с некоторыми изменениями. Как это сделать
   описано в doc/rom_kick.txt. Этот вариант проверен. Плата собрана
   и работает.
2. 7 микросхем (pld dd21, dd16, dd17, dd18, dd20, dd14, dd15). В этом
   случае вы становитесь обладателем плты с полной эмуляцией IDE
   портов A600/A1200, но для этого вам необходимо где-то купить
   микросхему "гибкой логики" FX740LC68 или FX840LC68 (подробнее
   смотри в файл doc/pld.txt. Также на микросхеме pld реализовано
   програмное управление конфигурацией схемы. Hо к сожалению этот
   вариант требует опыта работы с pld и ко всему прочему не прошёл
   окончательной проверки из-за сложности покупки микросхемы pld.


                  Рекомендации по сборке и отладке.

1. Внимательно прочитайте всю документацию.
2. Расширьте дорожки питания, если это позволяет ваше технологическое
   оборудование.
3. Расширьте дырки под все разъёмы, исключая разъём под SIMM.
4. Используйте не EDO SIMM, хотя EDO может быть тоже заработает.
5. Отладку начинайте в последовательности rom -> hdd -> fast ram.
6. Для отладки пользуйтесь программами в каталоге prog.
7. Если у вас не работает винт, то попробуйте шину данных притянуть
   резисторами 1к к +5v.


                     Состав архива.

  Архив содержит следущие каталоги:

Doc         Документация
Gfx         Полезные схемы и рисунки
Pcad4_5     Схемa и разводкa печатной платы в пакете pcad для IBM PC
            Для тех кто не имеет возможности посмотреть это в pcad
            в директории лежат файлы в формате #?.png
Photo       Фотографии платы
Pld         Файлы для версии платы с pld микросхемой
Roms        Файлы для получения прошивки
Prog        Полезные программы для отладки платы
fonts       Русский фонт 866 (ms-dos) для amiga

  Архив содержит следущие каталоги и файлы:

Directory "fonts"
866.font                    russian fonts

Directory "fonts/866"
8                           russian fonts

Directory "Doc":
block.txt                   схема по модульному принципу
electric.txt                электрическое описание схемы (вариант без pld)
bugs.txt                    ошибки
readme_first.txt            no comment ;)
pld.txt                     про версию платы с микросхемой pld
rom_kick.txt                как сделать пропатчить kickstart
chip_list.txt

Directory "Gfx":
Diagram.png                 временные диаграмы работы схемы
sborka.png                  сборочный чертёж
plata.png                   размеры платы
Func1.png                   структурная схема всей платы
fx-740.png                  структурная схема микросхемы PLD
tex.png                     технико-экономические характеристики

Directory "Gfx/Real_work_diagram":
7_mhz_cdac.dsa              диаграммы сигналов 7mhz и cdac
as_ramsel_ras_se_cas.dsa    диаграммы сигналов динамической памяти
How_view                    информация о том, как посмотреть диаграммы

Directory "Pcad4_5"
Kontr.SCH                   электрическая принципиальная схема в pcad4_5
Kontr_1.HP                  электрическая принципиальная схема в pcad4_5 (файл для CorelDraw)
Kontr_2.HP                  электрическая принципиальная схема в pcad4_5 (файл для CorelDraw)
Kontr_1.HPP                 файл для лазерного принтера
Kontr_2.HPP                 файл для лазарного принтера
Kontr_1.png                 принципиальная электрическая схема (часть 1/2)
Kontr_2.png                 принципиальная электрическая схема (часть 2/2)
Kontr8.PCB                  разводка печатной платы в pcad4_5
Kontr8.png                  разводка печатной платы в pcad4_5
Kontr8_component.png        разводка печатной платы в pcad4_5
Kontr8_component.HP         разводка печатной платы в pcad4_5 (файл для CorelDraw)
Kontr8_solder.png           разводка печатной платы в pcad4_5
Kontr8_solder.HP            разводка печатной платы в pcad4_5 (файл для CorelDraw)

Directory "Pcad4_5/REAL_OLD"
KONTR.SCH                   старая принципиальная электрическая схема (с ошибками)
KONTR8.PCB                  старая разводка печатной платы (с ошибками)
Kontr_1.png
Kontr_2.png

Directory "Photo"
brds.png
component_side_1.png
component_side_2.png
solder_side_1.png
solder_side_2.png
Vladimir_Sobolev.png

Directory "Pld"
HM010.BIT                   прошивка для плд
HM010.ERR
HM010.HST                   все диаграммы симуляции плд
HM010.JED                   прошивка для плд
HM010.PDS                   исходный файл для создания прошивки
HM010.PIN
HM010.RPT
HM010.TRF                   заданные диаграммы симуляции плд
state_machine.png
VC.EXT

Directory "Prog"
add4m                       добавляет 4мб с адреса $200000
add8m                       добавляет 8мб с адреса $200000
External_rom_copy           копирует другой kickstart без выхода из
текущего
External_rom_copy.s
HDReset                     програмный сброс винта через cs1
HDReset.s
port                        для отладки обращений к портам или памяти
при помощи осцилографа
port.s
s0_read                     чтение нулевого сектора винта в область
памяти $0f0000-$0f01ff
s0_read.s

Directory "Prog/Kick_check_sum"
RomF8Check                  проверка kickstart check sum
RomF8Check.s
RomF8CheckSumWrite          запись kickstart check sum прямо в rom
RomF8CheckSumWrite.s

Directory "Roms"
ROM_A1200_V39.106_M0.dif      файл для получения прошивки rom (без pld)
ROM_A1200_V39.106_M0_c0.dif   файл для получения прошивки rom (без pld)
rom_split                     разбивает rom на два 8-битных образа
rom_split.c

Directory "Roms/File_diff"
diff_cut                     создаёт файл изменений
diff_cut.c
diff_paste                   восстанавливает исходный файл
diff_paste.c
diff_view                    смотрит файл изменений
diff_view.c
readme.txt
SCOPTIONS


                                 Авторы.

  Часть без pld разработана Dmitry Gzhibovsky на основе данных, полученных
из проекта hddmem и собственных идей и разработок.

  Часть с pld сделана Vladimir Sobolev на основе данных, полученных
из проекта hddmem и собственных идей и разработок.

  Pcad дизайн сделан Natasha Gordievskih и Vladimir Sobolev.

  Коррекция схем, печатной платы, подготовка документации, патч прошивки,
сервисные программы, отладка версии платы без pld произведена
Vladimir Sobolev.

  Перевод на english сделал Andrew "Notorious" Boyarintsev и Labutcky D.

  Весь проект является freeware, так что используйте его как хотите.

  Все коментарии и замечания направлять по адресу Vladimir Sobolev или
Dmitry Gzhibovsky.

  Естественно за эту схему авторы ответственности не несут. Поэтому,
если вы будете её делать, то на свой страх и риск.


                                 Адреса.

Author:   Vladimir Sobolev
Place:    Russia, Ekaterinburg
E-mail:   sobolev@dc.ru
          ys-magic@dialup.mplik.ru
          amiga_man@usa.net
          vsobolev@hotmail.com
FIDO:     2:5080/52.69
AmigaNet: 39:245/200.3
IRC:      irc.msu.ru  /join #amigarus  or  /query vlso

Author:   Dmitry Gzhibovsky
Place:    Russia, Ekaterinburg
E-mail:   ldk@channel4.ru
FIDO:     2:5080/160.0
AmigaNet: 39:245/200.0

Translator: Andrew Boyarintsev
Place:      Russia, Moscow
HomePage:   http://come.to/lkr
E-mail:     ntrs@redline.ru
IRC:        irc.stealth.net  /join #amigarus or /query nOT^LkR

Translator: Labutcky D.
Place:      Ukraina
E-mail:     AVL@ccssu.crimea.ua

                         Для пользователей A600

  К сожалению на A600 нет системного разъема, но одевая на микросхемы
панельки сверху вы можете подключить все нужные контакты к плате.
У вас есть те же два варианта для сборки платы, но в варианте без
pld (dd21) вы должны не устанавливать следущие элементы: dd10, dd11,
dd12, r2, c1 так как они относятся только к ide контроллеру. При
этом ноги 1 и 4 dd13 необходимо отключить от подходящих цепей
и подключить к +5v, либо не соединять ноги 3 и 6 dd13 с платой (отогнуть
ножки в сторону). "Землю" платы и амиги необходимо соеденить оптимально
короткими проводами (не менее 10), а +5v можно в раза два меньшим
количеством проводов.

  К тому же вам придётся обходится без pcmcia-интерфейса, так как
в изменённой прошивке он убран. Конечно вы можете собрать pld
версию платы и использовать стандартную прошивку, но тогда
carddisk.device будет опознавать только 4mb fast ram. Остальные
4мб вам нужно будет опознавать при помощи програмки prog/add4m.
Hо вы можете также, как и я, сделать свой вариант patch... ;)

  Таблица соответствия системного разъёма A500 и chips А600:

a500 pin number | a500 pin name || a600 chip name | a600 pin number
--------------------------------------------------------------------
       1        |     gnd       ||  mc68000       |        16
       2        |     gnd       ||  mc68000       |        17
       3        |     gnd       ||  mc68000       |        56
       4        |     gnd       ||  mc68000       |        57
       5        |     +5v       ||  mc68000       |        14
       6        |     +5v       ||  mc68000       |        52
       7        |     nc        ||    -           |        -
       8        |     -5v       ||    -           |        -
       9        |     nc        ||    -           |        -
      10        |     +12v      ||  fdd power     |
      11        |     nc        ||    -           |        -
      12        |   gnd, cfg in ||    -           |        -
      13        |     gnd       ||  mc68000       |        16
      14        |     /c3       ||    -           |        -
      15        |     cdac      ||    *           |        *
      16        |     /c1       ||    -           |        -
      17        |     /OVR      ||    **          |        **
      18        |     RDY       ||    -           |        -
      19        |     /INT2     ||    -           |        -
      20        |     nc        ||    -           |        -
      21        |     A5        ||  mc68000       |        36
      22        |     /INT6     ||    -           |        -
      23        |     A6        ||  mc68000       |        37
      24        |     A4        ||  mc68000       |        35
      25        |     gnd       ||  mc68000       |        17
      26        |     A3        ||  mc68000       |        34
      27        |     A2        ||  mc68000       |        33
      28        |     A7        ||  mc68000       |        38
      29        |     A1        ||  mc68000       |        32
      30        |     A8        ||  mc68000       |        39
      31        |     FC0       ||     -          |        -
      32        |     A9        ||  mc68000       |        40
      33        |     FC1       ||     -          |        -
      34        |     A10       ||  mc68000       |        41
      35        |     FC2       ||     -          |        -
      36        |     A11       ||  mc68000       |        42
      37        |     gnd       ||  mc68000       |        56
      38        |     A12       ||  mc68000       |        43
      39        |     A13       ||  mc68000       |        44
      40        |     /IPL0     ||     -          |        -
      41        |     A14       ||  mc68000       |        45
      42        |     /IPL1     ||     -          |        -
      43        |     A15       ||  mc68000       |        46
      44        |     /IPL2     ||     -          |        -
      45        |     A16       ||  mc68000       |        47
      46        |     BEER*     ||     -          |        -
      47        |     A17       ||  mc68000       |        48
      48        |     /VPA      ||     -          |        -
      49        |     gnd       ||  mc68000       |        57
      50        |     E Clock   ||  mc68000       |        22
      51        |     /VMA      ||     -          |        -
      52        |     A18       ||  mc68000       |        49
      53        |     /reset    ||  mc68000       |        20
      54        |     Al9       ||  mc68000       |        50
      55        |     /HLT      ||     -          |        -
      56        |     A20       ||  mc68000       |        51
      57        |     A22       ||  mc68000       |        54
      58        |     A21       ||  mc68000       |        53
      59        |     A23       ||  mc68000       |        55
      60        |     /BR       ||     -          |        -
      61        |     gnd       ||  mc68000       |        16
      62        |     /BGACK    ||     -          |        -
      63        |     D15       ||  mc68000       |        58
      64        |     /BG       ||     -          |        -
      65        |     D14       ||  mc68000       |        59
      66        |     /DTACK    ||  mc68000       |        10
      67        |     D13       ||  mc68000       |        60
      68        |     rd_wr     ||  mc68000       |        9
      69        |     D12       ||  mc68000       |        61
      70        |     /LDS      ||  mc68000       |        8
      71        |     D11       ||  mc68000       |        62
      72        |     /UDS      ||  mc68000       |        7
      73        |     gnd       ||  mc68000       |        17
      74        |     /AS       ||  mc68000       |        6
      75        |     D0        ||  mc68000       |        5
      76        |     D10       ||  mc68000       |        63
      77        |     D1        ||  mc68000       |        4
      78        |     D9        ||  mc68000       |        64
      79        |     D2        ||  mc68000       |        3
      80        |     D8        ||  mc68000       |        65
      81        |     D3        ||  mc68000       |        2
      82        |     D7        ||  mc68000       |        66
      83        |     D4        ||  mc68000       |        1
      84        |     D6        ||  mc68000       |        67
      85        |     gnd       ||  mc68000       |        56
      86        |     D5        ||  mc68000       |        68
--------------------------------------------------------------------

Примечания:
"-" - Это значит соединять с платой не надо.
"*" - К сожалению у нас нет схемы для A600, но мы знаем, что этот
      сигнал формируется микросхемой GAYLE...
      Если вы не можете достать схемы к A600, то предлагается
      следующий метод формирования cdac:

                                     +5v  4-------
                                     ------|/s   |
      -------------        ------         3|     |5     cdac
   +5v|4         3|28Mhz---|    |----------|c   q|----------
      | Oscilator |        ------          |     |
      | 28.375mhz |       invertor        2|     |
      |           |        74F04    -------|d    |6    /cdac
      |1         2|gnd             /       |   /q|----------
      -------------               /  +5v  1|     |
                                 /   ------|/r   |
                 pin 15 mc68000 /          -------
                 ---------------     KP1554TM2 (74AC74)
                  (cpuclk)          pin 7 - gnd; pin 14 - +5v

      Естественно осцилятор на 28mhz и инвертор вы
      должны найти в своей А600. До инвертора брать
      не рекомендуется, хотя можете попробовать, если
      вам не удастся проследить сигнал с 3 ножки осцилятора.

      Смысл схемы: сигнал cdac должен быть сдвинут относительно
                   сигнала cpuclk (7.09Mhz) на 90 градусов.

"**" - Этот сигнал нужен только в версии с pld. Он должен быть
      одним из входов микросхемы gayle. В принципе схема может
      заработать и без него. :)

